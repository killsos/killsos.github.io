<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="keywords" content="javascript 前端">
<meta property="og:type" content="website">
<meta property="og:title" content="killsos">
<meta property="og:url" content="http://jsonload.com/index.html">
<meta property="og:site_name" content="killsos">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="killsos">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jsonload.com/">





  <title>killsos</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">killsos</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人情似水分高下 世事如云任卷舒</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/08/14/console-log/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/14/console-log/" itemprop="url">console.log </a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-14T15:27:40+08:00">
                2020-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="console-debug"><a href="#console-debug" class="headerlink" title="console.debug"></a>console.debug</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可以带多个字符串参数</span><br></pre></td></tr></table></figure>
<h2 id="Add-Styles-to-the-console-output"><a href="#Add-Styles-to-the-console-output" class="headerlink" title="Add Styles to the console output"></a>Add Styles to the console output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">可以通过%c指令在字符串信息中输出带有样式的内容</span><br><span class="line"></span><br><span class="line">样式将用以%c之后内容上</span><br><span class="line"></span><br><span class="line">例如</span><br><span class="line"></span><br><span class="line">console.log(</span><br><span class="line">  &quot;This is a %cstyled 🎨 %cconsole log %cin JavaScript&quot;,</span><br><span class="line">  &quot;color: orange; font-style: bold;font-size:18px;padding: 2px&quot;,</span><br><span class="line">  &quot;color: green; font-style: bold;font-size:18px;padding: 2px&quot;,</span><br><span class="line">  &quot;color: red; font-style: bold;font-size:28px; background-color: cyan;padding: 2px&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">background and its longhand equivalents.</span><br><span class="line">border and its longhand equivalents</span><br><span class="line">border-radius</span><br><span class="line">color</span><br><span class="line">font and its longhand equivalents</span><br><span class="line">line-height</span><br><span class="line">margin</span><br><span class="line">padding</span><br></pre></td></tr></table></figure>
<h2 id="dir"><a href="#dir" class="headerlink" title="dir( )"></a>dir( )</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Display objects and HTML/XML elements in an interactive format using dir and dirxml</span><br><span class="line">展示对象或者 html xml元素</span><br><span class="line"></span><br><span class="line">console.dirxml(document);</span><br></pre></td></tr></table></figure>
<h2 id="Display-data-in-tabular-form-using-table"><a href="#Display-data-in-tabular-form-using-table" class="headerlink" title="Display data in tabular form using table"></a>Display data in tabular form using table</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const developers = [&quot;Kyle 😃&quot;, &quot;John 😄&quot;, &quot;Sally 🙂&quot;];</span><br><span class="line"></span><br><span class="line">console.table(developers);</span><br></pre></td></tr></table></figure>
<h2 id="count"><a href="#count" class="headerlink" title="count( )"></a>count( )</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function counter() &#123;</span><br><span class="line">  console.count(&quot;Counter⏲️&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">counter();</span><br><span class="line"></span><br><span class="line">counter();</span><br><span class="line"></span><br><span class="line">console.countReset(&quot;Counter⏲️&quot;);</span><br><span class="line"></span><br><span class="line">counter();</span><br><span class="line"></span><br><span class="line">console.count(&quot;Other Counter⏲️&quot;);</span><br><span class="line"></span><br><span class="line">console.countReset();</span><br></pre></td></tr></table></figure>
<h2 id="Group-different-logs-using-group-groupCollapsed-and-groupEnd"><a href="#Group-different-logs-using-group-groupCollapsed-and-groupEnd" class="headerlink" title="Group different logs using group, groupCollapsed, and groupEnd"></a>Group different logs using group, groupCollapsed, and groupEnd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">group( )</span><br><span class="line"></span><br><span class="line">groupEnd( )</span><br><span class="line"></span><br><span class="line">groupCollapsed( )</span><br><span class="line"></span><br><span class="line">console.group(&quot;Outer group&quot;);</span><br><span class="line">for (let i = 0; i &lt; 50; i++) &#123;</span><br><span class="line">  console.log(&quot;Outer logs 📑&quot;);</span><br><span class="line">&#125;</span><br><span class="line">console.log(&quot;Hello 👋&quot;);</span><br><span class="line">console.group(&quot;Inner group&quot;);</span><br><span class="line">for (let i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">  console.log(&quot;Inner logs 📄&quot;);</span><br><span class="line">&#125;</span><br><span class="line">console.groupCollapsed(&quot;Child group&quot;);</span><br><span class="line">console.log(&quot;Child log here 🧒&quot;);</span><br><span class="line">console.groupEnd(&quot;Child group&quot;);</span><br><span class="line">console.groupEnd(&quot;Inner group&quot;);</span><br><span class="line">console.groupEnd(&quot;Outer group&quot;);</span><br><span class="line">console.group(&quot;Other group&quot;);</span><br><span class="line">console.log(&quot;Other log here 📝&quot;);</span><br><span class="line">console.groupEnd(&quot;Other group&quot;);</span><br></pre></td></tr></table></figure>
<h2 id="assert"><a href="#assert" class="headerlink" title="assert()"></a>assert()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.assert()</span><br></pre></td></tr></table></figure>
<h2 id="Calculate-time-taken"><a href="#Calculate-time-taken" class="headerlink" title="Calculate time taken"></a>Calculate time taken</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">time() // start timer to track time</span><br><span class="line"></span><br><span class="line">timeLog() // 输出一个当前时间值</span><br><span class="line"></span><br><span class="line">timeEnd() // end time</span><br></pre></td></tr></table></figure>
<h2 id="trace"><a href="#trace" class="headerlink" title="trace()"></a>trace()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">trace() outputs the stack trace to the console</span><br><span class="line"></span><br><span class="line">function outer() &#123;</span><br><span class="line">  function inner() &#123;</span><br><span class="line">    console.trace(&quot;Hello&quot;, &#123; name: &quot;Kyle&quot;, age: 24 &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  inner();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">outer();</span><br></pre></td></tr></table></figure>
<h2 id="Clear-the-console"><a href="#Clear-the-console" class="headerlink" title="Clear the console"></a>Clear the console</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">console.clear();</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/08/14/js-double-bangs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/14/js-double-bangs/" itemprop="url">js double bangs</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-14T15:12:55+08:00">
                2020-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="js-falsy"><a href="#js-falsy" class="headerlink" title="js falsy"></a>js falsy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot; 空字符串</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line">-0</span><br><span class="line">0n</span><br><span class="line"></span><br><span class="line">false</span><br><span class="line"></span><br><span class="line">null</span><br><span class="line">undefined</span><br><span class="line">NaN</span><br><span class="line"></span><br><span class="line">8</span><br></pre></td></tr></table></figure>
<h2 id="js-truthy"><a href="#js-truthy" class="headerlink" title="js truthy"></a>js truthy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">except for false, 0, -0, 0n, &quot;&quot;, null, undefined, and NaN)</span><br><span class="line"></span><br><span class="line">[] &#123;&#125; 是 true</span><br></pre></td></tr></table></figure>
<h2 id="logical-NOT-operator"><a href="#logical-NOT-operator" class="headerlink" title="logical NOT operator"></a>logical NOT operator</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! not operator</span><br></pre></td></tr></table></figure>
<h2 id="Convert-Logical-“not”-to-a-Double-Bang"><a href="#Convert-Logical-“not”-to-a-Double-Bang" class="headerlink" title="Convert Logical “not” to a Double Bang"></a>Convert Logical “not” to a Double Bang</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">finds the boolean value associated with an entity</span><br><span class="line">Returns that value “reversed”, or “negated”, to be more specific</span><br><span class="line"></span><br><span class="line">查找与实体关联的布尔值</span><br><span class="line"></span><br><span class="line">返回“反转”或“否定”的值，更具体地说</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/08/14/FastClick原理解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/14/FastClick原理解析/" itemprop="url">FastClick原理解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-14T13:54:07+08:00">
                2020-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FastClick原理解析</span><br><span class="line"></span><br><span class="line">在移动端开发过程中会遇到</span><br><span class="line">  手动点击 与 真正触发click事件 会存在300ms延迟</span><br><span class="line">  点击穿透问题 点击行为会穿透元素触发 非父子关系元素的事件</span><br><span class="line"></span><br><span class="line">  延迟的存在时因为浏览器想知道你是否在进行双击操作</span><br><span class="line"></span><br><span class="line">  点击穿透是因为300ms延迟的副作用</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 业务代码</span></span><br><span class="line"><span class="keyword">let</span> $test = <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>);</span><br><span class="line">$test.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'1 click'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// FastClick原理实现</span></span><br><span class="line"><span class="keyword">var</span> targetElement = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 记录点击元素</span></span><br><span class="line">  targetElement = event.target;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 阻止默认事件 屏蔽之后之后click事件</span></span><br><span class="line">  event.preventDefault();</span><br><span class="line">  <span class="comment">// 记录点击元素</span></span><br><span class="line">  targetElement = event.target;</span><br><span class="line">  <span class="keyword">var</span> touch = event.changedTouches[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">// 合成click事件 并添加可跟踪属性 forwardedTouchEvent</span></span><br><span class="line">  <span class="keyword">var</span> clickEvent = <span class="built_in">document</span>.createEvent(<span class="string">'MouseEvent'</span>);</span><br><span class="line">  clickEvent.initMouseEvent(<span class="string">'click'</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="built_in">window</span>, <span class="number">1</span> touch.screenX, touch.screenY, touch.clientX, touch.clientY,</span><br><span class="line">  <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  clickEvent.forwardedTouchEvent = <span class="literal">true</span>; <span class="comment">// 自定义的</span></span><br><span class="line"></span><br><span class="line">  targetElement.dispatch(clickEvent)  </span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原理</span></span><br><span class="line"><span class="comment">// 在body上绑定touchstart和touchend</span></span><br><span class="line"><span class="comment">// 其中 touchstart用于记录当前元素的targetElement</span></span><br><span class="line"><span class="comment">// touchend用于</span></span><br><span class="line"><span class="comment">// 阻止默认事件 屏蔽之后click事件</span></span><br><span class="line"><span class="comment">// 合并click事件 并添加可跟踪属性forwardedTouchEvent</span></span><br><span class="line"><span class="comment">// 在tatargetElement上触发click事件</span></span><br><span class="line"><span class="comment">// targetElement上触发click事件</span></span><br></pre></td></tr></table></figure>
<h2 id="点击穿透"><a href="#点击穿透" class="headerlink" title="点击穿透"></a>点击穿透</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">比如 页面上有A和B元素 B在A元素上面 例如定位z-index  </span><br><span class="line">在B上注册touchstart回调 该回调用于隐藏B元素</span><br><span class="line">当我们点击B元素 B元素被隐藏 随后A元素的click事件也被触发</span><br><span class="line">移动端上 事件执行顺序是 touchstart &gt; touchend &gt; click</span><br><span class="line">而click事件有300ms延迟 也就是touchend触发 300ms后浏览器</span><br><span class="line">再触发click事件 而此时B元素不见了 所以该事件被派发到A元素</span><br><span class="line">上 这就是穿透</span><br></pre></td></tr></table></figure>
<h2 id="其他解决方案"><a href="#其他解决方案" class="headerlink" title="其他解决方案"></a>其他解决方案</h2><h3 id="禁用缩放"><a href="#禁用缩放" class="headerlink" title="禁用缩放"></a>禁用缩放</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">当HTML文档头部包含如下meta标签时：</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;user-scalable=no&apos;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=1, maximum-scale=1&quot;&gt;</span><br><span class="line"></span><br><span class="line">让页面是不可缩放 双击缩放功能就失效了 此时浏览器可以禁用默认的双击缩放行为</span><br><span class="line">并且去掉300ms的点击延迟</span><br><span class="line"></span><br><span class="line">缺点 不能对图片进行缩放</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/08/14/JavaScript-ES2020-Features-With-Simple-Examples/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/14/JavaScript-ES2020-Features-With-Simple-Examples/" itemprop="url">JavaScript ES2020 Features With Simple Examples </a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-14T09:49:46+08:00">
                2020-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="String-protype-matchAll"><a href="#String-protype-matchAll" class="headerlink" title="String.protype.matchAll"></a>String.protype.matchAll</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个所有结果的迭代器</span></span><br><span class="line"><span class="keyword">const</span> string = <span class="string">'Magic hex number: DEASBEEF CAFE'</span></span><br><span class="line"><span class="keyword">const</span> regex = <span class="regexp">/\b\p&#123;ASCII_HEX_Dight&#125;+\b/gu</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for (const match of string.match(regex)) &#123;</span></span><br><span class="line"><span class="comment">//   console.log(match)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> match <span class="keyword">of</span> string.matchAll(regex)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(match)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Dynamic-import"><a href="#Dynamic-import" class="headerlink" title="Dynamic import"></a>Dynamic import</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> moduleSpecifier = <span class="string">'./utils.js'</span></span><br><span class="line"><span class="keyword">import</span>(moduleSpecifier).then(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>.method1()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> moduleSpecifier = <span class="string">'./utils.js'</span></span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">module</span> = <span class="keyword">await</span>  <span class="keyword">import</span>(moduleSpecifier)</span><br><span class="line">  <span class="built_in">module</span>.method1()</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="BigInt-—-Arbitrary-Precision-Integers"><a href="#BigInt-—-Arbitrary-Precision-Integers" class="headerlink" title="BigInt — Arbitrary Precision Integers"></a>BigInt — Arbitrary Precision Integers</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高精度整数 新的一种数据类型 253位</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">10</span>n; <span class="comment">// 'binint'</span></span><br><span class="line"></span><br><span class="line"><span class="number">10</span>n === BigInt(<span class="number">10</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="number">10</span>n == <span class="number">10</span>; <span class="comment">// ture</span></span><br><span class="line"></span><br><span class="line"><span class="number">20</span>n / <span class="number">10</span>n ; <span class="comment">// 2n</span></span><br><span class="line"></span><br><span class="line"><span class="number">20</span>n / <span class="number">2</span> <span class="comment">// TypeError mix BigInt and other types</span></span><br></pre></td></tr></table></figure>
<h2 id="Promise-allSettled"><a href="#Promise-allSettled" class="headerlink" title="Promise.allSettled"></a>Promise.allSettled</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.allSettled([p1, p2, p3]).then(<span class="function"><span class="params">responses</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(responses)</span><br><span class="line">  <span class="comment">// [</span></span><br><span class="line">  <span class="comment">//  &#123;status: 'fulfilled', value: ''&#125;</span></span><br><span class="line">  <span class="comment">//  &#123;status: 'rejected', reason: ''&#125;</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Standardized-globalThis-object"><a href="#Standardized-globalThis-object" class="headerlink" title="Standardized globalThis object"></a>Standardized globalThis object</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The global this was not standardized before ES10</span></span><br><span class="line"><span class="keyword">var</span> getGlobal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> self === <span class="string">'undefined'</span>) <span class="keyword">return</span> self;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">'undefined'</span>) <span class="keyword">return</span> <span class="built_in">window</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> global === <span class="string">'undefined'</span>) <span class="keyword">return</span> global;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'unable to locate global object'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="For-in-Mechanics"><a href="#For-in-Mechanics" class="headerlink" title="For-in Mechanics"></a>For-in Mechanics</h2><h2 id="Nullish-Coalescing-Operator"><a href="#Nullish-Coalescing-Operator" class="headerlink" title="Nullish Coalescing Operator"></a>Nullish Coalescing Operator</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">只对 null undefined  有效</span><br><span class="line"></span><br><span class="line">符号 \?\?</span><br></pre></td></tr></table></figure>
<h2 id="Optional-Chaining"><a href="#Optional-Chaining" class="headerlink" title="Optional Chaining"></a>Optional Chaining</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// ?. 前有后找</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/08/13/Understanding-WeakSets-in-JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/13/Understanding-WeakSets-in-JavaScript/" itemprop="url">Understanding WeakSets in JavaScript</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-13T18:02:17+08:00">
                2020-08-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">不能通过索引访问</span><br><span class="line"></span><br><span class="line">垃圾收集在外行人的术语是简单地收集和释放内存已经分配给对象，但目前没有在我们的程序的任何部分使用。</span><br><span class="line">在像C这样的编程语言中，开发人员必须使用malloc()和dealloc()函数来处理内存分配和释放</span><br><span class="line"></span><br><span class="line">原始数据类型不允许作为值存储在WeakSet中。 如果使用原始值，则将引发错误TypeError：弱集中使用的无效值。 尽管您可能已经从WeakMaps熟悉了此概念，但这里确实确实有微小的区别。 在WeakMap中，键应始终是对象，而不是值。 但是在WeakSet中，值本身应该是一个对象。 这是因为密钥等于本文开头所述的WeakSets中的值。 最终，这是在一天结束时应用的同一概念。</span><br><span class="line"></span><br><span class="line">之所以只允许对象作为值（键），是因为原始值永远不会被垃圾收集。 如果确实允许使用原始值作为键，那么您将根本无法从WeakSets中受益。</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/08/13/7-JavaScript-Utility-Functions-to-Improve-Your-Efficiency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/13/7-JavaScript-Utility-Functions-to-Improve-Your-Efficiency/" itemprop="url">7 JavaScript Utility Functions to Improve Your Efficiency </a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-13T17:20:05+08:00">
                2020-08-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Detect-Browser"><a href="#Detect-Browser" class="headerlink" title="Detect Browser"></a>Detect Browser</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">navigator.useragent</span><br><span class="line">navigator.useragent.toLower()</span><br></pre></td></tr></table></figure>
<h2 id="Detect-Function-Type"><a href="#Detect-Function-Type" class="headerlink" title="Detect Function Type"></a>Detect Function Type</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">native function</span><br><span class="line"></span><br><span class="line">functions by users</span><br><span class="line"></span><br><span class="line">.toString() // function fname() &#123;[native code]&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Convert-hyp-hens-to-camelCase"><a href="#Convert-hyp-hens-to-camelCase" class="headerlink" title="Convert hyp-hens to camelCase"></a>Convert hyp-hens to camelCase</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">将连字符转为小驼峰</span><br><span class="line">Converting hello-world style strings to helloWorld</span><br><span class="line"></span><br><span class="line">function camelize(string) &#123;</span><br><span class="line">  const camelizeRegex = /-(\w)/g;</span><br><span class="line">  return string.replace(camelizeRegex, (_, c) =&gt; c.toUpperCase() : &apos;&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Delete-HTML-tag-in-string"><a href="#Delete-HTML-tag-in-string" class="headerlink" title="Delete HTML tag in string"></a>Delete HTML tag in string</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const stripHTMLTags = str =&gt; str.replace(/&lt;[^&gt;]*&gt;/g, &apos;&apos;);</span><br></pre></td></tr></table></figure>
<h2 id="Reverse-a-String"><a href="#Reverse-a-String" class="headerlink" title="Reverse a String"></a>Reverse a String</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.split(&apos;&apos;).reverse().join(&apos;&apos;);</span><br></pre></td></tr></table></figure>
<h2 id="Format-a-number-to-a-string-with-comma"><a href="#Format-a-number-to-a-string-with-comma" class="headerlink" title="Format a number to a string with comma"></a>Format a number to a string with comma</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">111111 =&gt; 111,111</span><br><span class="line">123456789 =&gt; 123,456,789</span><br><span class="line"></span><br><span class="line">function numberToStringWithComma(number) &#123;</span><br><span class="line">  let str = String(number);</span><br><span class="line">  let s = &apos;&apos;;</span><br><span class="line">  let count = 0;</span><br><span class="line">  for (let i = str.length - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">    s = str[i] + s;</span><br><span class="line">    count++;</span><br><span class="line">    if (count % 3 === 0 &amp;&amp; i !== 0 ) &#123;</span><br><span class="line">      s = &apos;,&apos; + s;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Convert-byte-units-to-reasonable-units"><a href="#Convert-byte-units-to-reasonable-units" class="headerlink" title="Convert byte units to reasonable units"></a>Convert byte units to reasonable units</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bytesToSize(123456)</span><br><span class="line"></span><br><span class="line">npm i byte-size</span><br><span class="line">const byteSize = require(&apos;byte-size&apos;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/08/12/现代浏览器机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/12/现代浏览器机制/" itemprop="url">现代浏览器机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-12T14:26:15+08:00">
                2020-08-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Gpu"><a href="#Gpu" class="headerlink" title="Gpu"></a>Gpu</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">图形处理器（Graphics Processing Unit），也就是 GPU</span><br><span class="line"></span><br><span class="line">在进程和线程上执行程序</span><br><span class="line"></span><br><span class="line">进程可以描述为一个应用程序的执行程序。线程则是进程内部用来执行某个部分的程序。</span><br><span class="line"></span><br><span class="line">当你启动一个应用时，一个进程就被创建了。程序可能会创建一些线程帮助它完成某些工作，但这不是必须的。</span><br><span class="line"></span><br><span class="line">操作系统会划分出一部分内存给这个进程，当前应用程序的所有状态都将保存在这个私有的内存空间中。</span><br><span class="line"></span><br><span class="line">当你关闭应用时，进程也就自动蒸发掉了，操作系统会将先前被占用的内存空间释放掉</span><br><span class="line"></span><br><span class="line">进程可以让操作系统再另起一个进程去处理不同的任务。当这种情况发生时，新的进程又将占据一块内存空间</span><br><span class="line"></span><br><span class="line">当两个进程需要通信时，它们可以用一个叫做进程间通讯（Inter Process Communication）的办法解决</span><br><span class="line"></span><br><span class="line">许多应用程序都被设计成以这种方式进行工作，所以当其中一个进程挂掉时，它可以在其他进程仍然运行的时候直接重启。</span><br></pre></td></tr></table></figure>
<h2 id="浏览器架构"><a href="#浏览器架构" class="headerlink" title="浏览器架构"></a>浏览器架构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">浏览器是如何通过进程和线程建立起来的呢？</span><br><span class="line">有时会是一个进程和多个不同的线程，或是多个进程和少数线程</span><br><span class="line"></span><br><span class="line">首先是浏览器的自身进程，它负责与其他进程协作，主要负责浏览器应用的不同部分，</span><br><span class="line">如网络、内存等。</span><br><span class="line"></span><br><span class="line">至于渲染进程，浏览器会为每个窗口分配一个渲染进程。在最近的一次更新中，</span><br><span class="line">如果够用的话，Chrome 干脆给每个窗口分配了一个进程</span><br><span class="line">而现在，Chrome 在致力于给每个站点一个独立的进程，包括 iframe</span><br><span class="line"></span><br><span class="line">基本进程:</span><br><span class="line"></span><br><span class="line">1. 浏览器进程  负责 chrome 的浏览器功能，包括导航栏、书签、后退、前进按钮。当然也负责一些虽然看不到但也很重要的部分，比如网络请求和文件访问。</span><br><span class="line"></span><br><span class="line">2. 渲染进程 负责 窗口内的网站将如何呈现 每一个tab就是一个渲染进程</span><br><span class="line"></span><br><span class="line">3. 插件进程 负责 控制着网站可能用到的所有插件，比如 flash</span><br><span class="line"></span><br><span class="line">4. GPU进程 负责 处理 GPU 任务，与其他进程隔离。它被划分为不同的进程因为 GPU 会处理来自多个应用程序的请求并将其绘制在同一个平面上。</span><br><span class="line"></span><br><span class="line">将浏览器的工作拆分成不同的进程还有一个好处，就是安全。由于操作系统提供了一种限制进程“权限”的方法，因此浏览器可以将特定的功能和进程有效地隔离开。比如，Chrome 会限制用来处理用户输入的渲染进程去直接访问文件。</span><br><span class="line"></span><br><span class="line">每个进程都有各自的内存空间，因此它们常会各自拥有一份基础功能的拷贝。正因为它们之间不像同一进程中的线程那样能够共享资源，所以就需要更多的内存占用。为了节省内存，Chrome 对其自身可调用的进程在数量上做了限制。具体的限制大小在不同性能的机器上各不相同，唯一确定的是，当达到了这个上限后，Chrome 会将同站点的多个窗口交给同一个进程来管理。</span><br></pre></td></tr></table></figure>
<h2 id="Chrome-服务化-——-节省更多的内存"><a href="#Chrome-服务化-——-节省更多的内存" class="headerlink" title="Chrome 服务化 —— 节省更多的内存"></a>Chrome 服务化 —— 节省更多的内存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">浏览器进程也应用了相同的方案。Chrome 正在进行架构层面的整改，目的是将浏览器的各部分功能变成独立的服务，</span><br><span class="line">这样就能轻松地将其拆分为不同的进程，也能更加灵活地互相组合。</span><br><span class="line"></span><br><span class="line">总的来说，当 Chrome 在较高性能的设备上运行时，它会将每个服务分配至不同的进程，以此来获得更强的运行时稳定性和健壮性；</span><br><span class="line">反之，如果 Chrome 运行在一台资源受限的设备上时，Chrome 会将服务整合在一个进程中，</span><br><span class="line">以此来节省内存的占用。像这种通过整合进程资源以此来节省内存的手段，已经被用于 Android 上了。</span><br></pre></td></tr></table></figure>
<h2 id="站点隔离（Site-Isolation）"><a href="#站点隔离（Site-Isolation）" class="headerlink" title="站点隔离（Site Isolation）"></a>站点隔离（Site Isolation）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">站点隔离是 Chrome 在其 67 桌面版上新增的特性，基本原则是不同的站点各自运行在自己的沙箱环境中，独享进程，并且不允许通信。</span><br><span class="line"></span><br><span class="line">我们已经讨论过每个窗口一个进程的模型，在这个模型中，浏览器允许跨站点的 iframe 独立进程共享不同站点之间的内存空间。</span><br><span class="line"></span><br><span class="line">早先在一个渲染进程中（窗口）同时运行 a.com 和 b.com 看起来没有什么问题，因为有同源策略，</span><br><span class="line"></span><br><span class="line">确保一个站点未经同意就无法访问其他站点的数据。绕过同源策略基本上成为了所有安全攻击的指导方针。</span><br><span class="line"></span><br><span class="line">而进程间的相互隔离是将站点分开的最佳途径</span><br><span class="line"></span><br><span class="line">站点隔离已经默认为用户开启了。事实上，站点隔离并不仅仅是为站点分配不同的渲染进程这么简单，</span><br><span class="line"></span><br><span class="line">它从根本上改变了 iframe 之间的通信方式。打开运行有不同站点 iframe 的开发者工具，</span><br><span class="line"></span><br><span class="line">意味着浏览器必须做很多看不到的幕后工作，才能让这一切看起来和以前没有什么区别，</span><br><span class="line"></span><br><span class="line">即使是简简单单的 ctrl+F 在这个场景下也意味着在不同的渲染进程中查询字符串。</span><br><span class="line"></span><br><span class="line">网上有很多文章介绍浏览器的站点隔离策略，当你看完那些之后就会意识到，</span><br><span class="line"></span><br><span class="line">为什么站点隔离值得 Chrome 团队为其发布一个独立版本了。</span><br></pre></td></tr></table></figure>
<h2 id="一次简单的导航"><a href="#一次简单的导航" class="headerlink" title="一次简单的导航"></a>一次简单的导航</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">Step 1：处理用户输入</span><br><span class="line">当用户开始在地址栏输入时，</span><br><span class="line"></span><br><span class="line">UI 线程 解析输入字符串是url 。因为 Chrome 的地址栏同时还是个搜索框，所以 UI 线程需要解析用户的输入，</span><br><span class="line">才能决定该直接访问网址还是把用户的输入丢给搜索引擎处理</span><br><span class="line"></span><br><span class="line">Step 2：开始导航</span><br><span class="line"></span><br><span class="line">当用户按下回车键后，UI 线程要求网络线程去获取网站的内容。窗口的 Tab 上会开始转菊花，</span><br><span class="line">网络线程会采用一系列的协议和操作（比如 DNS）查询必要的信息并为请求建立连接</span><br><span class="line">网络线程可能会收到来自服务器的一个标记着重定向指令的头部比如 HTTP 301，</span><br><span class="line">在这种情况下，网络线程会把这件事情告诉 UI 线程，之后则会发起一次指向重定向地址的新的网络请求。</span><br><span class="line"></span><br><span class="line">Step 3：读取响应</span><br><span class="line">当响应的数据开始传送到浏览器时，网络线程会在必要的情况下检查一些来自响应的字段。</span><br><span class="line">响应数据的 Content-Type 字段会表示当前返回的是哪种类型的数据，但它也不完全靠谱，</span><br><span class="line">经常会出现丢失或者干脆不准确的情况，但也不用担心，MIME 嗅探[3]会完成缺失的工作。</span><br><span class="line">正如源码的注释中写道，这是一个可以被解释为 hack 的方案，</span><br><span class="line">如果感兴趣的话，你也可以去阅读这些注释，这样就能了解不同的浏览器是如何将实际的数据与 Content-Type 匹配了。</span><br><span class="line"></span><br><span class="line">如果响应数据是一个 HTML 文件，那么接下来的一步会是把数据传递给浏览器的渲染进程；</span><br><span class="line">但如果数据是 zip 压缩文件或其他类型的文件，意味着这将被定位成一次下载动作，</span><br><span class="line">于是浏览器会将数据转交给下载管理器去处理</span><br><span class="line"></span><br><span class="line">通常这一步也是安全检测[5]发生的时候：如果域名或响应数据和已知的恶意网站匹配时，</span><br><span class="line">网络进程会抛出一个警告，并展现一个告警的页面。另外，CORB[6] 检测也会开始工作，</span><br><span class="line">确保那些来自敏感站点的跨站响应数据不会进入到浏览器的渲染进程中</span><br><span class="line"></span><br><span class="line">Step 4：渲染进程</span><br><span class="line">网络线程以获取了全部的数据，并完成了所有需要的检查，此刻它自信的告诉 UI 线程</span><br><span class="line">接着，UI 线程会唤起一个渲染进程去渲染页面</span><br><span class="line">由于网络情况的不可控，一个请求可能会花上好几百毫秒才能把响应数据拿回来，</span><br><span class="line">所以这里浏览器默认开启了用来加速这一过程的优化。</span><br><span class="line">在 Step 2 中，当 UI 线程将需要请求的 url 告诉网络线程时，其实它本身已经知道要导航到哪个网站了，</span><br><span class="line">于是 UI 线程在把 url 传递给网络线程的同时，会尝试启动一个渲染进程。</span><br><span class="line">如果一切都按照预期正常进行的话，当网络线程拿到数据时，渲染进程就已经处于待命状态了。</span><br><span class="line">也会有例外的情况：比如导航重定向到一个另外的站点，</span><br><span class="line">那么预先启动好的渲染进程将不会被使用，这导致 UI 线程需要重新启动一个渲染进程。</span><br><span class="line"></span><br><span class="line">Step 5：触发导航</span><br><span class="line">浏览器进程通过 IPC 告知渲染进程可以出发本次导航了。与此同时，数据流也将传递给渲染进程，这样后者就能继续接收 HTML 数据。</span><br><span class="line">一旦浏览器收到了来自渲染进程的导航启动信号，这次导航也就完成了，下一步进入文档的加载阶段。</span><br><span class="line"></span><br><span class="line">到这会儿，浏览器的地址栏更新，安全指示符和站点的设置 UI 会将新页面的信息呈现出来。</span><br><span class="line">当前窗口的 session 将会更新，刚导航到的页面会被后退/前进按钮记录到窗口的页面历史中</span><br><span class="line">为了便于在关闭窗口时恢复页面，历史的会话记录会保存在本地的磁盘上</span><br><span class="line"></span><br><span class="line">Extra Step：初始加载完成</span><br><span class="line">当导航触发后，渲染进程会持续接收资源并渲染页面。我们将在下一篇文章中讨论这一步的更多细节。</span><br><span class="line">当渲染进程“完成”渲染后，它会通过 IPC 告知浏览器进程（页面的 onload 事件均已执行完毕后），UI 线程也就不再在 tab 上转菊花了。</span><br><span class="line"></span><br><span class="line">上面的“完成”两个字，之所以打了双引号，因为在实际场景中，</span><br><span class="line">它通常并不真正意味着完成，因为客户端的 JavaScript 可能在此时持续地加载资源并渲染新的视图</span><br><span class="line"></span><br><span class="line">导航到另一个网站</span><br><span class="line">一次简单的导航截至目前已经完成了。假如这时用户输入了一个不同的 url 会发生什么呢？其实也没啥，</span><br><span class="line">浏览器进程会按照上面的步骤导航到这个网站。但在这一切开始之前，</span><br><span class="line">浏览器会检查当前已经渲染好了的网站是否需要在网页卸载之前搞一点事情，这就是 beforeunload 事件。</span><br><span class="line"></span><br><span class="line">在 beforeunload 事件中，我们可以在用户即将跳转至其他页面或者关闭 Tab 的时候发起一个“确认离开当前页面？”的二次确认。</span><br><span class="line">Tab 中的所有东西都由渲染进程控制着，当然也包括开发者编写的 JavaScript，</span><br><span class="line">以当一个新的导航请求即将到来时，浏览器进程会对当前的渲染进程做最后的检查。</span><br><span class="line"></span><br><span class="line">我们应当尽量避免在 beforeunload 中添加总会执行的事件代码，这会造成更多的交互延时，毕竟它们总会在新的导航开始之前执行。只在需要的时候添加这些代码，比如提醒用户如果进入新的页面那么当前页面的数据会丢失。</span><br><span class="line"></span><br><span class="line">如果导航是在渲染进程中被创建的（比如用户点击了页面上的某一链接或者在 JavaScript 运行了 window.location.href = &apos;https://abc.cn&apos; ），则当前的渲染进程会首先检查是 beforeunload 中是否有东西需要执行。之后，它会经历与浏览器进程直接发起导航后一样的导航过程。</span><br><span class="line"></span><br><span class="line">当新的导航将发往与当前页面不同的站点时，浏览器将会创建一个新的渲染进程去处理这些新工作，旧的渲染进程则则用来在剩余的时间里处理诸如 unload 的页面事件。如果你想了解更多的话，可以看看页面生命周期概览[7]和页面生命周期 API[8]这两篇文章。</span><br><span class="line"></span><br><span class="line">## 如果有 Service Worker...</span><br><span class="line">Service Worker[9] 的引入会对页面的导航流程带来一些改变。Service Worker 是一种可以在应用代码中编写网络代理的方法；增强了开发者对于本地缓存以及何时发起网络请求的控制。如果 Service Worker 提前设置了从本地缓存中读取某一页面的数据，那么也就不需要发起网络请求了。</span><br><span class="line"></span><br><span class="line">需要明确的一点是，即使 Service Worker 提供了听起来很高端的功能，但它实质上也是运行在渲染进程中的 JavaScript 代码。那么问题来了：当用户发起一次导航时，浏览器进程是如何知道目标站点存在一个 Service Worker 的呢？</span><br><span class="line"></span><br><span class="line">导航预加载</span><br><span class="line"></span><br><span class="line">相信你可以发现，如果 Service Worker 最终决定从网络中请求数据，那么之前在浏览器进程和渲染进程之间所发生的通信都将成为导致响应延时的罪魁祸首。</span><br><span class="line"></span><br><span class="line">导航预加载[11]就是用来加速这一进程的机制：与 Service Worker 并行启动去加载资源。</span><br><span class="line"></span><br><span class="line">它将为这些请求设置一个 Header，由服务端来决定为这些请求发送不同的内容；比如，仅返回更新的数据而不是整个文档。</span><br></pre></td></tr></table></figure>
<h2 id="渲染进程"><a href="#渲染进程" class="headerlink" title="渲染进程"></a>渲染进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">渲染进程处理 Web 页面的所有内容</span><br><span class="line"></span><br><span class="line">一个浏览器窗口之内发生的所有事情，都是被渲染进程所掌握着的。前端工程师们的代码由渲染进程中的主线程处理</span><br><span class="line"></span><br><span class="line">如果使用了 web worker 或者 service worker，那其中的代码将会由 worker 线程处理</span><br><span class="line"></span><br><span class="line">Compositor 线程和 Raster 线程也运行在渲染进程中，它们的作用是高效平滑地渲染出一个页面。</span><br><span class="line"></span><br><span class="line">渲染进程最核心的工作是：将 HTML、CSS 和 JavaScript 代码变成一个可与用户交互的 Web 页面。</span><br><span class="line"></span><br><span class="line">解析文档</span><br><span class="line"></span><br><span class="line">构建 DOM 树</span><br><span class="line">当渲染进程接收到一条即将去导航的信号并开始接收 HTML 数据时，主线程就开始了自己的工作：解析 HTML 文本并将其转换为文档对象模型（Document Object Model，aka DOM）。</span><br><span class="line"></span><br><span class="line">DOM 是浏览器内部对一个页面的抽象（代表），也是开发者可以利用 JavaScript 与之相交互的数据结构和 API。</span><br><span class="line"></span><br><span class="line">浏览器按照HTML 标准[4] 去解析 HTML 文档。你或许发现了一件事情，就是即使你随便丢给浏览器一个 HTML 文档都不会报错。比如，没有结束标签的 &lt;/p&gt; 仍然是一段有效的 HTML。一段错误的标签比如：Hi! &lt;b&gt;我是&lt;i&gt;Chrome&lt;/b&gt;!&lt;/i&gt;(b 标签在 i 标签之前提前关闭了)会被当作 Hi! &lt;b&gt;I&apos;m &lt;i&gt;Chrome&lt;/i&gt;&lt;/b&gt;&lt;i&gt;!&lt;/i&gt; 去对待。这都是因为 HTML 本身才设计之初就希望优雅的解决这些错误。如果你是个好奇的小朋友，可以去看看 An Introduction to Error Handling and Strange Cases in the Parser[5] 这篇文章的相关章节。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">子资源加载</span><br><span class="line">一个网站通常会用到很多外部资源比如图片、CSS 和 JavaScript。这些文件都需要从网络或是缓存中加载。当主线程在解析 HTML 文档的时候发现了这些需要额外加载的资源，主线程会一个一个地去请求，但这样会降低解析 HTML 的效率。因此为了提速，“预加载扫描器”闪亮登场了。如果在文档中存在 img 标签或是 link 标签，预加载扫描器会“窥探”到 HTML 解析器生成的 token，并向浏览器进程中的网络线程发起请求。</span><br><span class="line"></span><br><span class="line">JavaScript 阻塞解析</span><br><span class="line">当 HTML 解析器遇到了 script 标签时，它会暂停对 HTML 的解析工作，转而去加载、解析并执行 JavaScript 代码。为什么呢？因为 JavaScript 可能改变文档的结构，比如用了 document.write() 之类的函数。这就是为什么 HTML 解析器必须在 JavaScript 执行过后才恢复对 HTML 文档的解析工作。如果你的 JavaScript 代码在执行时的事情有兴趣的话，可以看看 V8 团队的这篇文章[6]</span><br><span class="line"></span><br><span class="line">告诉浏览器你想怎样加载资源</span><br><span class="line">浏览器提供了很多不错的方法给开发者，以帮助他们用不同的姿势在页面上加载资源。</span><br><span class="line">如果你的 JavaScript 代码中没有用到诸如 document.write() 之类的代码，</span><br><span class="line">你可以在自己的 script 标签上加上 async / defer 属性，浏览器就会异步地加载并执行 JavaScript 代码并且不会阻塞对于文档的解析。</span><br><span class="line"></span><br><span class="line">需要的话，也可以用到 JavaScript 模块[7]。&lt;link rel=&quot;preload&quot;&gt; 用于加载当前页面一定会用到的资源，</span><br><span class="line">并且开发者希望浏览器能在第一时间加载这些资源。开发者可以针对不同的场景，</span><br><span class="line">赋予资源不同的加载优先级[8]，浏览器会按照既定的规则依次加载这些资源，从而起到加载优化的效果</span><br><span class="line"></span><br><span class="line">样式的计算</span><br><span class="line">只有 DOM 是无法完全知道一个页面最终会是什么样子的，因此我们还需要 CSS。</span><br><span class="line">主线程在完成对 CSS 的解析和计算后，才会为每个 DOM 节点赋予最终的样式。</span><br><span class="line">你可以在 DevTools 的 Computed 中查看到页面的相关信息。</span><br><span class="line"></span><br><span class="line">即使开发者不提供任何的 CSS，每个 DOM 节点还是会有各自的样式：&lt;h1&gt; 显示的字体比 &lt;h2&gt; 大、</span><br><span class="line">每个元素都有自己的 margin 值。这是因为浏览器本身有一个默认的样式表。</span><br><span class="line">如果你想知道 Chrome 的默认 CSS 是啥，去看看 Chrome 的源代码[9]吧。</span><br><span class="line"></span><br><span class="line">布局</span><br><span class="line">现在渲染进程知道了文档的结构和每个节点的样式，但这还不足以去渲染一个页面</span><br><span class="line"></span><br><span class="line">布局是查找元素几何形状的过程。主线程遍历 DOM 并计算样式，</span><br><span class="line">创建一个具体横纵坐标以及盒子边界大小数据的布局树（layout tree）。</span><br><span class="line"></span><br><span class="line">布局树可能与 DOM 树相似，但它只包含和页面即将呈现的节点相关的信息。</span><br><span class="line">如果某个元素设置了 display: none ，虽然它会呈现在 DOM 树中但并不会包含于布局树当中；</span><br><span class="line">如果有一个伪类元素 p::before&#123; content: &apos;Hi!&apos; &#125;， 那么它虽然不在 DOM 树中，但仍然会出现在布局树当中。</span><br><span class="line"></span><br><span class="line">注意 dom树  布局树</span><br><span class="line"></span><br><span class="line">页面布局的决策是一项很有挑战的工作。即使是最简单的页面布局，</span><br><span class="line">比如一个从上至下的块状元素集合，也需要去决定字体显示多大、在哪里换行...因为这些都会影响到段落的大小和形状，</span><br><span class="line">这些也都会影响到相邻的元素最终会显示在哪里。</span><br><span class="line"></span><br><span class="line">CSS 可以让元素悬浮在另一侧，可以将溢出的内容隐藏，还可以改变文案的阅读方向。</span><br><span class="line">相信你可以想象的到，布局阶段的任务是非常艰巨的。</span><br><span class="line">Chrome，一整个团队的工程师都致力于布局这一阶段的工作。如果你想看看他们都做了哪些工作，</span><br><span class="line">这里有一个关于 BlinkOn[10] 有趣的会议记录可以看看。</span><br><span class="line"></span><br><span class="line">布局就像是你在尽力还原一幅画：你知道大小、形状以及元素的坐标，但你还是需要决定先画哪一个。</span><br><span class="line"></span><br><span class="line">实际情况是，某个元素可能被设置了 z-index，如果按照 HTML 的元素编写顺序去“画”，就会导致错误的渲染效果</span><br><span class="line"></span><br><span class="line">在这一绘制的过程中，主线程遍历布局树从而去创建绘制记录。绘制记录是绘制进程的“笔记”，</span><br><span class="line">记下了诸如“先是背景，然后文字，接下来是矩形”这样的记录。</span><br><span class="line">如果你曾经在 canvas 上用 JavaScript 画过画，那么这个过程对你来说就很熟悉了。</span><br><span class="line"></span><br><span class="line">更新渲染的代价是很大的</span><br><span class="line">在渲染中最需要关注到的事情是，在每一步中，先前的操作都会产生新的数据。</span><br><span class="line">举个例子，如果布局树的某些东西改变了，文档中相关部分的绘制顺序也需要重新安排一遍。</span><br><span class="line"></span><br><span class="line">如果页面上有动画元素，浏览器会在每一帧都执行这些操作。大多数显示器会以每秒 60 次的频率刷新屏幕，</span><br><span class="line">当你以这样的运动速率去维持动画时，人眼对于动画的感知会是流畅的。然而，如果动画“丢帧”了，页面就会看起来很不友好。</span><br><span class="line"></span><br><span class="line">即使你的渲染操作跟上了屏幕的刷新频率，但这些计算始终是运行在主线程上的，</span><br><span class="line">这就意味着当你的应用在运行 JavaScript 时，这些都会被阻塞掉。</span><br><span class="line"></span><br><span class="line">你可以将 JavaScript 的操作分割为许多小的块并放在 requestAnimationFrame() 里执行，</span><br><span class="line">或者干脆把这些 JavaScript 丢在 Web Worker 里去执行，这样就能避免阻塞主线程。</span><br><span class="line"></span><br><span class="line">合成</span><br><span class="line">现在浏览器知道了文档的结构、每个元素的样式、页面的几何构成以及绘制的顺序，它会怎样去绘制一个页面呢？</span><br><span class="line">将这些信息转化为屏幕上的像素，这个过程叫做光栅化。</span><br><span class="line">处理这个问题有个“幼稚”的办法，就是只对可视区域的部分进行光栅化。当用户滚动页面时移动浏览器的光栅窗口，</span><br><span class="line">从而将剩余的部分渲染出来。实不相瞒，Chrome 在刚发布的时候，确实是用这种方案的。</span><br><span class="line">不过时至今日，现代浏览器的这一过程更为复杂，我们一般称之为合成。</span><br><span class="line"></span><br><span class="line">什么是合成？</span><br><span class="line">合成是一种将页面的各个部分分为多层，分别对其进行光栅化并在成为合成器线程的单独线程中作为页面进行合成的技术。</span><br><span class="line">如果发生了滚动，因为每一层都已经完成了光栅化，剩下需要做的就只是合成出一个窗口。</span><br><span class="line">可以通过移动图层并合并新帧来以相同的方式实现动画。</span><br><span class="line"></span><br><span class="line">你可以在 DevTools 的 Layers 面板[11]中查看你的页面是如何被切分成层的。</span><br><span class="line"></span><br><span class="line">分层</span><br><span class="line">为了确定每个元素各自应该在哪一层，主线程在遍历了布局树后生成了一个叫做 Layer Tree 的东西</span><br><span class="line">（不知道怎么翻译就还是保留 Layer Tree 这个名字吧）。如果页面的某一部分需要单独的层级</span><br><span class="line">（比如滑入的侧边栏目录）但却没有得到对应的层级，开发者可以用 CSS 的 will-change 属性来告知浏览器</span><br><span class="line"></span><br><span class="line">你可能想给每一个元素一个单独的渲染层，但是与每帧光栅化页面的一小部分相比，在过多数量的图层上进行合成可能会导致操作的速度变慢，</span><br><span class="line">因此衡量应用程序的渲染性能也是至关重要的一环。更多内容，</span><br><span class="line">可以阅读这篇文章：Stick to Compositor-Only Properties and Manage Layer Count[12]</span><br><span class="line"></span><br><span class="line">will-change 为web开发者提供了一种告知浏览器该元素会有哪些变化的方法，</span><br><span class="line">这样浏览器可以在元素属性真正发生变化之前提前做好对应的优化准备工作。</span><br><span class="line">这种优化可以将一部分复杂的计算工作提前准备好，使页面的反应更为快速灵敏</span><br><span class="line"></span><br><span class="line">主线程的光栅与合成</span><br><span class="line">一旦 layer tree 形成并且绘制的顺序定下来后，主线程会将这个消息提交给合成线程。然后，合成器线程将每个图层光栅化</span><br><span class="line">一个图层有可能和整个页面一样大，所以合成器线程将它们切割为很多小块，并将这些块发送给光栅线程</span><br><span class="line">光栅线程将一小块完成光栅化后将其保存在 GPU 的内存当中</span><br><span class="line"></span><br><span class="line">合成线程可以优先处理不同的光栅线程，以便可以首先对可视区域（或者可视区域附近）中的事物进行光栅化</span><br><span class="line">图层还具有用于不同分辨率的多个拼贴，以处理诸如放大动作之类的事情。</span><br><span class="line"></span><br><span class="line">光栅化后，合成器线程将收集成为“Draw Quads（绘制四边形？）”的图块信息以创建 合成帧（Compositor frame）</span><br><span class="line"></span><br><span class="line">合成帧会通过 IPC 被传递给浏览器进程。这时，来自其他 UI 线程的合成帧可能已经被用于浏览器的 UI 变化了</span><br><span class="line">合成帧被运送至 GPU，目的就是为了显示在屏幕上</span><br><span class="line">如果这时滚动页面，合成器线程又会创建新的合成帧并将之发送到 GPU</span><br><span class="line"></span><br><span class="line">合成的优势是所有的合成操作都是独立于主线程进行的。合成器线程不需要等待样式的计算或是 JavaScript 的执行。</span><br><span class="line">这就是 COA（Compositing Only Animations[13]）能加速页面性能的原因。</span><br><span class="line">如果页面的布局或者绘制需要被重新计算，这种情况下主线程就会被牵扯进来。</span><br><span class="line"></span><br><span class="line">从浏览器的角度定义输入事件</span><br><span class="line">当提到“输入事件”时，你可能会想到在文本域中打字或是鼠标的点击事件，</span><br><span class="line">但在浏览器看来，用户的任何动作都意味着“输入”。鼠标滚轮的滚动是一种输入事件，触摸或者鼠标滑过也是一种输入事件。</span><br><span class="line"></span><br><span class="line">当用户的交互行为发生时（比如触摸点击屏幕），浏览器进程会第一个感知到这个用户行为，但也仅仅是感知而已，</span><br><span class="line">因为浏览器 tab 下的内容都是由渲染进程全盘掌控着。于是浏览器进程在第一时间将用户事件的类型和坐标发送给渲染进程。</span><br><span class="line">渲染进程通过查找并调用对应的事件处理函数来处理这个用户输入事件。</span><br><span class="line"></span><br><span class="line">合成器接收到输入事件</span><br><span class="line">在上一篇文章中，我们研究了合成器如何通过光栅化图层来平滑的处理滚动。</span><br><span class="line">如果页面上没有事件监听器，合成器线程会创建一个完全独立于主线程的新的合成帧。</span><br><span class="line"></span><br><span class="line">非快速滚动区域</span><br><span class="line">因为运行 JavaScript 是主线程的任务，当一个页面被合成，合成器线程将页面上挂在了事件处理器的区域标记为“非快速滚动区域”。</span><br><span class="line">有了这个标记之后，合成器就能保证在对应的区域触发输入事件时可以向主线程传递这一事件。</span><br><span class="line">如果输入事件来自于这个区域之外，合成器则会持续合成新的帧，并不会等待主线程</span><br><span class="line"></span><br><span class="line">写事件处理器时要注意</span><br><span class="line">在 Web 开发中一个比较常见的事件处理模型就是事件委托（代理）。因为事件的冒泡机制，</span><br><span class="line">开发者可以在最顶层的元素挂载一个事件处理函数，并且基于 event target 分发不同的处理逻辑。</span><br><span class="line"></span><br><span class="line">只用写一个事件处理器就可以搞定所有的输入事件，这在工程学上是一件极具魅力的事情。</span><br><span class="line">当你从浏览器的视角审视这段代码的时候，你会发现整个页面都被标记成了“非快速滚动区域”。</span><br><span class="line">这就意味着即使你的 web app 不关心来自页面上某个位置的输入事件，</span><br><span class="line">但合成器线程仍然会基于这次触发的事件和主线程进行“交流”。</span><br><span class="line">在这种模式之下，合成器本身“平滑处理页面滚动”的能力就不复存在了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">为了减轻这种情况的发生，开发者可以给自己的事件处理器传递 passive: true 这样一个参。</span><br><span class="line">这等同于告诉浏览器开发者仍然希望在主线程中监听页面上每一次触发的输入事件，</span><br><span class="line">但也希望合成器该干啥干啥，持续合成新的帧。</span><br><span class="line"></span><br><span class="line">在你的鼠标事件监听函数中使用 passive:true 意味着页面的滚动可以按照往常纵享丝滑般地去处理，</span><br><span class="line">你会为了限制滚动的方向调用 preventDefault ，但在这之前竖直的滚动就可能已经发生了。</span><br><span class="line">你可以通过 event.cancelable 针对此种情况进行相应的优化。</span><br><span class="line"></span><br><span class="line">document.body.addEventListener(&apos;pointermove&apos;, event =&gt; &#123;</span><br><span class="line">  if (event.cancelable) &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123; passive: true &#125;);</span><br><span class="line"></span><br><span class="line">你也可以用如下 css 来帮忙消除事件处理器：</span><br><span class="line"></span><br><span class="line">#area &#123;</span><br><span class="line">  touch-action: pan-x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">当合成器线程向主线程发送了一个输入事件后，第一件事情就是通过 hit test（点击测试）</span><br><span class="line">找到对应的 event target（事件目标，还是不翻译这个词比较正宗）</span><br><span class="line">Hit test 利用渲染进程产生的绘制记录来找出在触发本次输入事件的坐标底下的真实元素</span><br><span class="line"></span><br><span class="line">减少主线程的事件处理负担</span><br><span class="line"></span><br><span class="line">主流的显示器通过每秒 60 次的频率刷新以及我们需要跟上这个节奏以实现流畅的动画效果。</span><br><span class="line">对于输入事件来说，主流的触摸屏会以每秒 60 到 120 次的频率向主线程传递触摸事件，</span><br><span class="line">大多数的鼠标事件都被以每秒 100 次的频率传递给主线程。</span><br><span class="line">输入事件的保真度是普遍高于主流屏幕的刷新能力的。</span><br><span class="line"></span><br><span class="line">如果一个持续不断的事件（比如 touchmove）在一秒内被传递给了主线程 120 次，</span><br><span class="line">这就会触发大量的 hit test 和 JavaScript 的执行，</span><br><span class="line">这么一对比，每秒 60 次的屏幕刷新速率就显得太慢了。</span><br><span class="line"></span><br><span class="line">为了减少主线程的负担，Chrome 将常见的连续事件进行了合并（比如 wheel、mousewheel、mousemove、pointermove、touchmove 等），</span><br><span class="line">并且在 requestAnimationFrame 中延缓了事件的触发时机。</span><br><span class="line"></span><br><span class="line">其他“分散触发”的事件（keydown、keyup、mouseup、touchstart、touchend 等）仍保持立即触发的策略。</span><br><span class="line"></span><br><span class="line">通过 getCoalescedEvents 获取帧内事件</span><br><span class="line"></span><br><span class="line">对于大多数的 web app 来说，合成事件是为了更好的用户体验。假如你在开发一款绘画的应用程序，</span><br><span class="line">如果你根据 touchmove 的坐标来放置路径，大概率是会丢失掉中间的坐标的，你也就无法画一条平滑的线了。</span><br><span class="line">这种情况下，你就可以用 getCoalescedEvents 这个方法来获取更多关于合成事件的信息</span><br><span class="line"></span><br><span class="line">window.addEventListener(&apos;pointermove&apos;, event =&gt; &#123;</span><br><span class="line">  const evnets = event.getCoalescedEvents();</span><br><span class="line">  for (let event of events) &#123;</span><br><span class="line">    const x = event.pageX;</span><br><span class="line">    const y = event.pageY;</span><br><span class="line">    // 用这些坐标画线，稳</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">如果你之前从来没有想过为什么官方推荐在你的事件处理函数中添加 passive 参数，</span><br><span class="line">或者不知道为什么在 script 标签上添加 async 属性，我希望这个系列能为你阐明为什么浏览器需要这些东西来提供更快、更流畅的用户体验。</span><br><span class="line"></span><br><span class="line">Lighthouse 用起来</span><br><span class="line">如果你想让自己的代码变得更加“浏览器友好”却不知道从哪里开始，不妨试试 Lighthouse[3] 吧。Lighthouse 是一个可以对网站进行审核检查的工具，会为开发者提供一份包含网站得分以及优化方案的详尽报告。</span><br><span class="line"></span><br><span class="line">学习如何度量性能</span><br><span class="line">不同的网站对于性能的需求可能不同，因此找到合适的度量方法以及优化方案是至关重要的。Chrome 的开发者工具团队有话说：通过 Chrome Devtools 优化网站性能[4]。</span><br><span class="line"></span><br><span class="line">给网站添加 Feature Policy</span><br><span class="line">如果你想更进一步，Feature Policy 了解一下？Feature Policy 是一个新的 web 特性，它可以在开发者构建 web app 时提供“保护”。启用 feature policy 可以确保你的 web app 具备某些行为，并在一定程度上避免开发者犯错。举个例子，如果你希望保证你的 app 不会阻塞解析，你可以在同步脚本策略之下运行你的 app。当 sync-script:none 打开时，会阻塞解析的 JavaScript 都会被阻止执行。这一策略会防止任何“脚本阻塞解析”的发生，浏览器就再也不用担心解析被阻塞这件事情了。</span><br><span class="line"></span><br><span class="line">通常来说就是滚动当前页面（还可能是缩放页面），如果它的默认行为被阻止了，页面就必须静止不动。但浏览器无法预先知道一个监听器会不会调用 preventDefault()，它能做的只有等监听器执行完后再去执行默认行为，而监听器执行是要耗时的，有些甚至耗时很明显，这样就会导致页面卡顿。视频里也说了，即便监听器是个空函数，也会产生一定的卡顿，毕竟空函数的执行也会耗时。</span><br><span class="line"></span><br><span class="line">视频里还说了，有 80% 的滚动事件监听器是不会阻止默认行为的，也就是说大部分情况下，浏览器是白等了。所以，passive 监听器诞生了，passive 的意思是“顺从的”，表示它不会对事件的默认行为说 no，浏览器知道了一个监听器是 passive 的，它就可以在两个线程里同时执行监听器中的 JavaScript 代码和浏览器的默认行为了。</span><br><span class="line"></span><br><span class="line">https://developers.google.com/web/updates/2018/09/inside-browser-part4</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/07/26/How-to-Configure-VS-Code-Like-a-Pro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/26/How-to-Configure-VS-Code-Like-a-Pro/" itemprop="url">How to Configure VS Code Like a Pro</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-26T11:00:48+08:00">
                2020-07-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Why-Do-We-Even-Need-a-Workspace"><a href="#Why-Do-We-Even-Need-a-Workspace" class="headerlink" title="Why Do We Even Need a Workspace?"></a>Why Do We Even Need a Workspace?</h2><p>为了在基于项目的级别而不是全局（用户）级别应用任何设置或配置，您将需要有一个工作区。</p>
<p>有了工作区，您可以定制工作环境的各个方面，以满足和满足您正在处理的项目的特定需求。</p>
<p>在这里，我正在谈论扩展，任务，代码片段，甚至是文本编辑器的外观。 这正是我所要介绍的内容，我将向您展示如何在自己的工作空间中进行设置和配置。</p>
<h2 id="如何设置工作区"><a href="#如何设置工作区" class="headerlink" title="如何设置工作区"></a>如何设置工作区</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">保存</span><br><span class="line">1. 文件  2. 将工作区另存为</span><br><span class="line"></span><br><span class="line">打开</span><br><span class="line"></span><br><span class="line">1. 文件  2. 打开工作区</span><br><span class="line"></span><br><span class="line">工作区看上去是空文件 也没有什么</span><br><span class="line">但是通过工作区可以快速安装 自己喜欢的插件</span><br><span class="line">通过 Peacock 这个插件 给vs实例添加不同颜色</span><br><span class="line"></span><br><span class="line">打开命令面板 cmd + shift +  p  输入 peacock</span><br><span class="line"></span><br><span class="line">在工作区中.vscode/settings.json</span><br><span class="line"></span><br><span class="line">在workbench对象中，您可以进一步定制VS代码中的许多其他元素和部分(例如终端部分)</span><br></pre></td></tr></table></figure>
<h2 id="如何一个多文件工作区"><a href="#如何一个多文件工作区" class="headerlink" title="如何一个多文件工作区"></a>如何一个多文件工作区</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">实际上，多文件夹工作区只是一个常规工作区，在原始项目的文件夹中添加了其他文件夹（项目</span><br><span class="line">您可以在当前工作空间中添加任意数量的项目。 您可以让前端和后端项目共享一个工作区</span><br><span class="line">或你可想在自己一个仓库中有一个工作区中对多个React项目进行配置</span><br><span class="line">您在多文件夹工作空间中可以拥有的设置和功能与普通工作空间完全相同</span><br><span class="line"></span><br><span class="line">1. 文件  2. 将文件夹添加到工作区</span><br></pre></td></tr></table></figure>
<h2 id="通过工作区公开和分享扩展"><a href="#通过工作区公开和分享扩展" class="headerlink" title="## 通过工作区公开和分享扩展"></a>## 通过工作区公开和分享扩展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">***.code-workspace 文件中</span><br><span class="line"></span><br><span class="line">extensions字段中 recommrecommendations字段中    </span><br><span class="line">添加自己喜欢的插件</span><br><span class="line"></span><br><span class="line">一旦其他人打开这个工作区 就会提示安装推荐的插件</span><br></pre></td></tr></table></figure>
<h2 id="如何在工作空间-多文件夹-工作空间设置和运行自动化任务"><a href="#如何在工作空间-多文件夹-工作空间设置和运行自动化任务" class="headerlink" title="如何在工作空间/多文件夹 工作空间设置和运行自动化任务"></a>如何在工作空间/多文件夹 工作空间设置和运行自动化任务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">我们可以轻松地将VS Code配置为一次单击或每次打开工作区时执行此命令链</span><br><span class="line">具体取决于我们的需求</span><br><span class="line"></span><br><span class="line">在.vscode文件夹中task.json设置</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &apos;version&apos;,</span><br><span class="line">  &apos;tasks&apos;; [</span><br><span class="line">    &#123;</span><br><span class="line">      label,</span><br><span class="line">      command,</span><br><span class="line">      type: &apos;shell&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">执行任务 终端 run task  选择</span><br><span class="line"></span><br><span class="line">我想指出的是，如果您在多文件夹工作区中工作，则可以在彼此独立的每个文件夹（项目）中同时运行任务。 您只需要在每个项目中都有一个.vscode文件夹，并在其中包含命令的tasks.json文件即可。</span><br><span class="line"></span><br><span class="line">每当我们从工作区打开我们的项目并真正实现它的自动化时，我们都可以轻松地将VS Code配置为运行此类任务。 该过程还涉及两个步骤</span><br><span class="line"></span><br><span class="line">1. 在一个任务对象添加runOptions字段 对象为&#123;runOn: &apos;folderOpen&apos;&#125;</span><br><span class="line"></span><br><span class="line">2. we need to open the command palette, type “Manage Automatic Tasks in Folder,” and then allow the option.</span><br></pre></td></tr></table></figure>
<h2 id="如何在工作区中创建自定义片段"><a href="#如何在工作区中创建自定义片段" class="headerlink" title="如何在工作区中创建自定义片段"></a>如何在工作区中创建自定义片段</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">代码段是一种节省时间的好方法，您无需一直输入模板或样板代码。</span><br><span class="line">当然，可以选择安装片段扩展，但是我真的更喜欢根据自己的喜好和需求定制片段。</span><br><span class="line"></span><br><span class="line">因此，为了创建代码段，您应该在VS Code中导航到</span><br><span class="line"></span><br><span class="line">代码&gt;首选项&gt;用户代码段。 然后，您应该会看到一个下拉列表，</span><br><span class="line">其中包含当前列出的摘录以及选项“ New Global Snippets File…”</span><br><span class="line"></span><br><span class="line"> 和“新的摘要文件”作为“您的工作区名称”。</span><br><span class="line"></span><br><span class="line"> 仓库地址</span><br><span class="line"></span><br><span class="line"> https://github.com/Squiff88/vscodeSetup</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/07/20/搭建一个灰度发布环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/20/搭建一个灰度发布环境/" itemprop="url">搭建一个灰度发布环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-20T11:29:22+08:00">
                2020-07-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="start"><a href="#start" class="headerlink" title="start"></a>start</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">灰度发布，又称金丝雀发布</span><br><span class="line"></span><br><span class="line">集成灰度发布的流水线在DevOps中是一个非常重要的工具和高效的实践</span><br></pre></td></tr></table></figure>
<h2 id="01-服务器准备"><a href="#01-服务器准备" class="headerlink" title="01 服务器准备"></a>01 服务器准备</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取服务器</span><br><span class="line"></span><br><span class="line">上面提到，灰度发布是通过少量的用户试点来验证新功能有没有问题。</span><br><span class="line">所以要保证有两批用户能在同一时间体验到不同的功能。</span><br><span class="line">这就要求我们准备两台服务器，分别部署不同的代码版本。</span><br><span class="line"></span><br><span class="line">如果你已经有了一台服务器，也可以通过在不同端口部署服务的方式来模拟两台服务器。</span><br><span class="line">如果你还一台服务器都没有，那么可以参考这个过程购买两台云服务器，</span><br><span class="line">如果是按需购买，完成本文的Demo，大概要花费20块钱。</span><br><span class="line"></span><br><span class="line">https://github.com/TerminatorSd/canaryUI/blob/master/HuaWeiCloudServer.md</span><br></pre></td></tr></table></figure>
<h3 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">1. git</span><br><span class="line">首先，确保你的服务器上已经安装了git，如果没有的话使用以下命令进行安装，</span><br><span class="line">安装好了以后生成ssh 公钥，放到你的github 里，后面拉取代码的时候会用到</span><br><span class="line"></span><br><span class="line">yum install git</span><br><span class="line"></span><br><span class="line">2. nginx</span><br><span class="line"></span><br><span class="line">安装nginx</span><br><span class="line"></span><br><span class="line">sudo yum install nginx</span><br><span class="line"></span><br><span class="line">在终端输入nginx -t检查一下是否安装成功</span><br><span class="line"></span><br><span class="line">如果安装成功，它会显示Nginx 配置文件的状态，以及位置</span><br><span class="line"></span><br><span class="line">此时nginx还没有启动，在终端中输入nginx 或nginx \-s reload 命令即可启动</span><br><span class="line"></span><br><span class="line">此时看到的nginx相关进程如下，表明已经启动成功</span><br><span class="line"></span><br><span class="line">在浏览器里访问你的服务器公网IP，如果能看到下面的页面说明Nginx 可以正常工作</span><br><span class="line"></span><br><span class="line">3. Jenkins</span><br><span class="line"></span><br><span class="line">  安装</span><br><span class="line"></span><br><span class="line"> Jenkins稳定版本list  http://pkg.jenkins-ci.org/redhat-stable/</span><br><span class="line"></span><br><span class="line"> // 科学上网会快一些，记得留意网站上java和jenkins版本匹配信息，别下错了</span><br><span class="line"></span><br><span class="line"> wget http://pkg.jenkins-ci.org/redhat-stable/jenkins-2.204.5-1.1.noarch.rpm</span><br><span class="line"></span><br><span class="line"> rpm -ivh jenkins-2.204.5-1.1.noarch.rpm</span><br><span class="line"></span><br><span class="line"> 修改Jenkins端口，不冲突可不修改</span><br><span class="line"></span><br><span class="line"> // line 56 JENKINS_PORT</span><br><span class="line"> vi /etc/sysconfig/jenkins</span><br><span class="line"></span><br><span class="line"> 启动</span><br><span class="line"></span><br><span class="line"> 启动jenkins</span><br><span class="line"></span><br><span class="line">    service jenkins start/stop/restart</span><br><span class="line"></span><br><span class="line">  // 密码位置</span><br><span class="line"></span><br><span class="line">    /var/lib/jenkins/secrets/initialAdminPassword</span><br><span class="line"></span><br><span class="line">  访问</span><br><span class="line"></span><br><span class="line">    访问服务器的8080端口，输入从上述位置获取的密码，点击继续</span><br><span class="line"></span><br><span class="line">  创建一个账户然后登录</span><br></pre></td></tr></table></figure>
<h2 id="02-代码准备"><a href="#02-代码准备" class="headerlink" title="02 代码准备"></a>02 代码准备</h2><h3 id="准备两份代码"><a href="#准备两份代码" class="headerlink" title="准备两份代码"></a>准备两份代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">因为要做灰度部署，所以需要准备两份不一样的代码，以验证我们实施的灰度操作是否生效</span><br><span class="line">这里选择使用Angular 的Angular-CLI 来创建代码</span><br><span class="line"></span><br><span class="line">创建的项目并不简洁，但是胜在操作简单。我们一次性把两份代码准备好，简化开发侧工作</span><br><span class="line"></span><br><span class="line">// 安装angular-cli，前提是已经安装了node，如果没有node真的要去自行百度了...</span><br><span class="line">npm install -g @angular/cli</span><br><span class="line">// 快速创建一个新项目，一路回车</span><br><span class="line">ng new canaryDemocd canaryDemo</span><br><span class="line">// 运行完这个命令后访问http://localhost:4200 查看页面信息</span><br><span class="line">ng serve</span><br><span class="line"></span><br><span class="line">访问localhost 的4200 端口查看页面，然后把项目根目录下src 中的index.html 的title 改成A-CanaryDemo，</span><br><span class="line">可以看到页面会进行实时地刷新。</span><br><span class="line"></span><br><span class="line">在这个例子中，我们用title 来标识灰度发布过程中两边不同的服务需要部署的代码</span><br><span class="line"></span><br><span class="line">接下来，我们进行两次打包，两次打包的title 分别为A-CanaryDemo 和 B-CanaryDemo</span><br><span class="line">把这两个文件夹放好备用，作为一会灰度发布的新老代码。</span><br><span class="line"></span><br><span class="line">ng build --prod</span><br></pre></td></tr></table></figure>
<h3 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在上述完成Nginx 的安装操作时，我们访问服务器的IP 看到的是Nginx 的页面，</span><br><span class="line">现在我们想访问到自己的页面，首先把上面打包得到的A-CanaryDemo 发送到两台服务器上任意位置</span><br><span class="line">里我们把它放到/var/canaryDemo</span><br><span class="line"></span><br><span class="line">// 将A-CanaryDemo 文件夹复制到你的公网服务器上，xx部分是你的服务器公网ip</span><br><span class="line">scp -r ./dist/A-CanaryDemo root@xx.xx.xx.xx:/var/canaryDemo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">去服务器上/var 的位置上看一下，是否已经有了这个文件，如果有了的话，接着到下一步</span><br><span class="line">即修改Nginx 配置把访问该服务器IP 的请求转发到我们刚刚上传上来的页面上</span><br><span class="line">上面提到过可以通过nginx -t 这个命令来查看Nginx 配置文件的位置</span><br><span class="line">这一步，我们要去编辑那个文件</span><br><span class="line"></span><br><span class="line">vi /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">修改47-50行添加下图相关的内容，即将访问到该服务器IP 的流量转发到/var/canaryDemo 下的index.html</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">  root /var/canaryDemo;</span><br><span class="line">  index index.html</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line">这时候去访问我们服务器的IP 地址可以看到页面已经变成了刚刚我们在本地改的页面，而且title 确实是A-CanaryDemo。</span><br><span class="line">两台服务器都操作完成后，两边都可以访问到title 为A-CanaryDemo 的页面。</span><br><span class="line">此时的状态相当于生产环境已经在提供稳定服务的两台机器</span><br></pre></td></tr></table></figure>
<h2 id="03-定义灰度策略"><a href="#03-定义灰度策略" class="headerlink" title="03 定义灰度策略"></a>03 定义灰度策略</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">接下来，我们要开始进行灰度发布的部分，在进行相关操作之前，</span><br><span class="line">我们需要定义一个灰度策略，即满足什么情况下的流量会走到灰度边，而其他流量走向正常边。</span><br><span class="line">这里为了简单起见，我们使用名字为canary 的cookie 来区分，</span><br><span class="line"></span><br><span class="line">如果检测到这个cookie 的值为devui，就访问灰度边机器，否则就访问正常边机器。</span><br><span class="line"></span><br><span class="line">按照此规则配置Nginx 结果如下，此处分别使用11.11.11.11和22.22.22.22代表两台服务器的IP地址</span><br></pre></td></tr></table></figure>
<h3 id="nignx"><a href="#nignx" class="headerlink" title="nignx"></a>nignx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Canary Deployment</span></span><br><span class="line">map <span class="variable">$COOKIE_canary</span> <span class="variable">$group</span> &#123;</span><br><span class="line">  <span class="comment"># canary account</span></span><br><span class="line">  ~*devui$ server_canary;</span><br><span class="line">  default server_default;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream server_canary &#123;</span><br><span class="line">  <span class="comment"># 两台机器的IP，第一台设置端口号8000是为了防止nginx转发出现死循环导致页面报错</span></span><br><span class="line">  server 11.11.11.11:8000 weight=1 max_fails=1 fail_timeout=30s;</span><br><span class="line">  server 22.22.22.22 weight=1 max_fails=1 fail_timeout=30s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream server_default &#123;</span><br><span class="line">  server 11.11.11.11:8000 weight=2 max_fails=1 fail_timeout=30s;</span><br><span class="line">  server 22.22.22.22 weight=2 max_fails=1 fail_timeout=30s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相应地，要配置8000端口的转发规则，8000端口默认不开启访问，需要去云服务器控制台安全组新增8000</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen 8000;</span><br><span class="line">  server_name _;</span><br><span class="line">  root /var/canaryDemo;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Load configuration files for the default server block.</span></span><br><span class="line">  include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    root /var/canaryDemo;</span><br><span class="line">    index index.html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80 default_server;</span><br><span class="line">  listen [::]:80 default_server;</span><br><span class="line">  server_name _;</span><br><span class="line">  <span class="comment"># root /usr/share/nginx/html;</span></span><br><span class="line">  root /var/canaryDemo;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Load configuration files for the default server block.</span></span><br><span class="line">  include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass http://<span class="variable">$group</span>;</span><br><span class="line">    <span class="comment"># root /var/canaryDemo;</span></span><br><span class="line">    <span class="comment"># index index.html;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 404 /404.html;</span><br><span class="line">    location = /40x.html &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 500 502 503 504 /50x.html;</span><br><span class="line">  location = /50x.h</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">此时，灰度流量和正常流量都会随机分配到AB两边的机器。下面，我们通过建立Jenkins 任务执行Nginx 文件修改的方式实现灰度发布</span><br></pre></td></tr></table></figure>
<h2 id="04-实现灰度发布"><a href="#04-实现灰度发布" class="headerlink" title="04 实现灰度发布"></a>04 实现灰度发布</h2><h3 id="流程梳理"><a href="#流程梳理" class="headerlink" title="流程梳理"></a>流程梳理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">在创建用于实现灰度发布的Jenkins任务之前我们先梳理一下要达到灰度发布的目标需要哪几个任务，</span><br><span class="line">以及每个任务负责完成什么事情。</span><br><span class="line"></span><br><span class="line">灰度发布一般遵循这样的流程（假设我们有AB两台服务器用于提供生产环境的服务，我们称之为AB边）：</span><br><span class="line"></span><br><span class="line">（1）新代码部署到A边</span><br><span class="line"></span><br><span class="line">（2）符合灰度策略的小部分流量切到A边，剩余大部分流量仍去往B边</span><br><span class="line"></span><br><span class="line">（3）手动验证A边功能是否正常可用</span><br><span class="line"></span><br><span class="line">（4）验证无误后，大部分流量转到A边，灰度流量去往B边</span><br><span class="line"></span><br><span class="line">（5）手动验证B边功能是否正常可用</span><br><span class="line"></span><br><span class="line">（6）验证无误后，流量像往常一样均分到AB边</span><br></pre></td></tr></table></figure>
<h3 id="任务拆解"><a href="#任务拆解" class="headerlink" title="任务拆解"></a>任务拆解</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">通过上述的拆解，我们得出灰度发布的6个步骤，其中（3）和（5）是需要手动验证的环节</span><br><span class="line"></span><br><span class="line">以我们以这两个任务为分割点，建立三个Jenkins 任务（Jenkins 任务建立在A 边机器上）如下：</span><br><span class="line"></span><br><span class="line">（1）Canary_A（灰度测试A），这个任务又包含两个部分，更新A边的代码，然后修改流量分发策略使得灰度流量到达A，其他流量到达B</span><br><span class="line"></span><br><span class="line">（2）Canary_AB（上线A灰度测试B），更新B边代码，灰度流量达到B，其他流量到达A</span><br><span class="line"></span><br><span class="line">（3）Canary_B（上线B），所有流量均分到AB</span><br></pre></td></tr></table></figure>
<h3 id="创建任务"><a href="#创建任务" class="headerlink" title="创建任务"></a>创建任务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">先按照任务拆解部分的设定创建三个FreeStyle 类型的Jenkins 任务，记得使用英文名字，中文名字后面建文件夹比较麻烦。</span><br><span class="line"></span><br><span class="line">任务详情信息可以不填，直接保存就好，下一步我们再来配置每个任务的具体信息</span><br></pre></td></tr></table></figure>
<h3 id="配置任务"><a href="#配置任务" class="headerlink" title="配置任务"></a>配置任务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">现在已经创建好了三个任务，先点击进入每一个任务进行一次空的构建（否则后面可能导致修改后的构建任务无法启动）</span><br><span class="line"></span><br><span class="line">然后我们来对每个任务进行详细的配置</span><br><span class="line"></span><br><span class="line">现代前端项目都要进行构建打包这一步。但是廉价的云服务器在完成构建方面有些力不从心，CPU 经常爆表</span><br><span class="line"></span><br><span class="line">所以我们在这里把打包出得出的生产包纳入git 管理，每次的代码更新会同步最新的生产包到github</span><br><span class="line"></span><br><span class="line">因此Jenkins 任务把生产包拉下来，放在指定位置即可完成一次新代码的部署。</span><br><span class="line"></span><br><span class="line">这一步操作，其实我们在之前就已经完成了，我们在上面打了两份tilte 不一样的生产包，此时可以派上用场了。</span><br><span class="line"></span><br><span class="line">首先来配置灰度测试A，这个任务内容上面也基本讲清楚了</span><br><span class="line"></span><br><span class="line">首先要关联该任务到远程的github 仓库（需要手动创建一个，存放上面打包的B-CanaryDemo，并命名为dist）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">让它知道可以去哪里拉取最新代码</span><br><span class="line"></span><br><span class="line">执行一次构建任务（在git fetch 那一步耗时不稳定，有时比较久），然后点击本次构建进去查看Console Output</span><br><span class="line"></span><br><span class="line">可以确定执行Jenkins 任务的位置是位于服务器上的/var/lib/jenkins/workspace/Canary_A</span><br><span class="line"></span><br><span class="line">继续编辑灰度测试A 任务，添加build shell，也就是每次任务执行时要执行的命令：</span><br><span class="line"></span><br><span class="line">（1）先拉取最新的代码</span><br><span class="line"></span><br><span class="line">（2）把代码根目录下的dist目录复制到部署代码的位置，这里我们指定的位置是/var/canaryDemo</span><br><span class="line"></span><br><span class="line">（3）修改Nginx 配置使灰度流量到达A边</span><br><span class="line"></span><br><span class="line">就步骤（3）而言，修改灰度流量的方式其实就是选择性注释Nginx 配置文件中的内容，注释方式如下即可实现灰度测试A。</span><br><span class="line"></span><br><span class="line">upstream server_canary &#123;</span><br><span class="line">  # 灰度流量访问A 边</span><br><span class="line">  server 11.11.11.11:8080 weight=1 max_fails=1 fail_timeout=30s;</span><br><span class="line">  # server 22.22.22.22 weight=1 max_fails=1 fail_timeout=30s;</span><br><span class="line">&#125;</span><br><span class="line">upstream server_default &#123;</span><br><span class="line">  # 正常流量访问B 边，为了在修改文件的时候把这段的配置和上面的server_canary 区分开，我们把这里的weight 设为2</span><br><span class="line">  # server 11.11.11.11:8080 weight=2 max_fails=1 fail_timeout=30s;</span><br><span class="line">  server 22.22.22.22 weight=2 max_fails=1 fail_timeout=30s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">这一步填写的shell 命令在使用jenkins 用户执行时可能会遇到权限问题，可以先用root 用户登录，把/var 目录的归属改为jenkins 用户，/etc/nginx/ngix.conf也需要新增可写权限。由此，最终得到的shell 命令如下：</span><br><span class="line"></span><br><span class="line">git pull</span><br><span class="line">rm -rf /var/canaryDemo</span><br><span class="line">scp -r dist /var/canaryDemo</span><br><span class="line">sed -i &apos;s/server 22.22.22.22 weight=1/# server 22.22.22.22 weight=1/&apos; /etc/nginx/nginx.conf</span><br><span class="line">sed -i &apos;s/server 11.11.11.11:8000 weight=2/# server 11.11.11.11:8000 weight=2/&apos; /etc/nginx/nginx.conf</span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line">灰度测试A 任务内容配置完成，接下来依次配置上线A 灰度测试B 和上线B。</span><br><span class="line"></span><br><span class="line">灰度测试B 的要执行的任务是把最新的代码拉到A 边（因为我们的Jenkins 任务都是建立在A 边的），复制dist 下的代码到B 边Nginx 指定访问位置，然后修改A 边Nginx 配置，使灰度流量到达B 边。</span><br><span class="line"></span><br><span class="line">git pull</span><br><span class="line">rm -rf canaryDemo</span><br><span class="line">mv dist canaryDemo</span><br><span class="line">scp -r canaryDemo root@xx.xx.xx.xx:/var</span><br><span class="line">sed -i &apos;s/# server 22.22.22.22 weight=1/server 22.22.22.22 weight=1/&apos; /etc/nginx/nginx.conf</span><br><span class="line">sed -i &apos;s/# server 11.11.11.11:8000 weight=2/server 11.11.11.11:8000 weight=2/&apos; /etc/nginx/nginx.conf</span><br><span class="line">sed -i &apos;s/server 22.22.22.22 weight=2/# server 22.22.22.22 weight=2/&apos; /etc/nginx/nginx.conf</span><br><span class="line">sed -i &apos;s/server 11.11.11.11:8000 weight=1/# server 11.11.11.11:8000 weight=1/&apos; /etc/nginx/nginx.conf</span><br><span class="line">nginx -s reload</span><br><span class="line">这一步的任务内容涉及到从A 边服务器向B 边服务器发送代码，这个过程一般来说需要输入B 边服务器的密码。我们想要做到免密发送，因此要通过把A 边机器~/.ssh/id_rsa.pub 中的内容添加到B 边服务器~/.ssh/authorized_keys 中使得A 获得免密像B 发送文件的权限。</span><br><span class="line"></span><br><span class="line">上线B 则是通过取消对A 边Nginx 配置的注释使所有流量均分到AB 边.</span><br><span class="line"></span><br><span class="line">sed -i &apos;s/# server 22.22.22.22 weight=2/server 22.22.22.22 weight=2/&apos; /etc/nginx/nginx.conf</span><br><span class="line">sed -i &apos;s/# server 11.11.11.11:8000 weight=1/server 11.11.11.11:8000 weight=1/&apos; /etc/nginx/nginx.conf</span><br><span class="line">nginx -s reload</span><br><span class="line">至此，我们就从零到一搭建了一个灰度发布环境。在代码更新后，通过手动执行Jenkins 任务的方式实现灰度部署和手工测试，保证新功能平滑上线。</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/07/20/npm-快速开发技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/20/npm-快速开发技巧/" itemprop="url">npm 快速开发技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-20T10:41:12+08:00">
                2020-07-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、学习基本快捷方式"><a href="#1、学习基本快捷方式" class="headerlink" title="1、学习基本快捷方式"></a>1、学习基本快捷方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">安装  —  常规：npm install，简写：npm i</span><br><span class="line">测试  —  常规：npm test，简写：npm t</span><br><span class="line">帮助  —  常规：npm --help，简写：npm -h</span><br><span class="line">全局标志 —  常规： --global，简写：-g</span><br><span class="line">保存为开发依赖 - 常规： - save-dev，简写：-D</span><br><span class="line">npm init 默认值 - 常规：npm init --yes 或 npm init --force，简写：npm init -y 或 npm init -f</span><br><span class="line">要安装一个包而不保存它，可以使用 ——no-save标志。</span><br><span class="line">安装包信息将加入到optionalDependencies（可选阶段的依赖）- 常规：--save-optional， 简写：-O</span><br><span class="line">精确安装指定模块版本 - 常规：--save-optional， 简写：-O</span><br></pre></td></tr></table></figure>
<h3 id="根的快捷方式"><a href="#根的快捷方式" class="headerlink" title="根的快捷方式"></a>根的快捷方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">. 符号通常用于表示应用程序的根目录</span><br><span class="line"></span><br><span class="line">npm术语中的应用程序入口点，即package.json中指定为“main”的值</span><br><span class="line">&#123;</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">这个快捷方式也可以用于像npx create-react-app . 这样的命令</span><br><span class="line"></span><br><span class="line">因此，可以运行npx create-react-app .</span><br><span class="line"></span><br><span class="line">而不是使用 npx create-react-app my-app 创建一个新的my-app目录。</span><br></pre></td></tr></table></figure>
<h3 id="2、设置默认npm-init属性"><a href="#2、设置默认npm-init属性" class="headerlink" title="2、设置默认npm init属性"></a>2、设置默认npm init属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">字段设置默认值</span><br><span class="line">npm config set init.author.name &quot;Joe Bloggs&quot;</span><br><span class="line">npm config set init.author.email &quot;JoebLoggs@gmail.com&quot;</span><br><span class="line">npm config set init.author.url &quot;Joebloggs.com&quot;</span><br><span class="line">npm config set init.license &quot;MIT&quot;</span><br><span class="line"></span><br><span class="line">要检查是否正确添加了这些属性，在终端输入 npm config edit查看配置文件信息</span><br><span class="line">当然也j可以通过直接在打开的配置文件编辑信息</span><br><span class="line">如果要编辑全局npm设置，使用npm config edit -g</span><br><span class="line"></span><br><span class="line">要重新初始化默认设置，可以使用以下脚本。第一行用空字符串替换配置文件，第二行用默认设置重新填充配置文件</span><br><span class="line">echo &quot;&quot; &gt; $(npm config get userconfig)</span><br><span class="line">npm config edit</span><br><span class="line"></span><br><span class="line">上面的脚本将重置用户默认值，下面的脚本将重置全局默认值</span><br><span class="line">echo &quot;&quot; &gt; $(npm config get globalconfig)</span><br><span class="line">npm config --global edit</span><br></pre></td></tr></table></figure>
<h3 id="3、让脚本跨平台兼容"><a href="#3、让脚本跨平台兼容" class="headerlink" title="3、让脚本跨平台兼容"></a>3、让脚本跨平台兼容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">最好的是cross-env。使用npm i -D cross-env将其作为开发依赖项安装</span><br><span class="line">然后在任何环境变量之前包括关键字cross-env</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;build&quot;: &quot;cross-env NODE_ENV=production webpack --config build/wepack.config.js&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cross-env是 实现跨平台兼容性的最无缝的方法</span><br><span class="line"></span><br><span class="line">rimraf 可以安装在全球运行跨平台脚本</span><br><span class="line">ShellJS 是Unix shell命令在Node.js API上的可移植实现</span><br></pre></td></tr></table></figure>
<h3 id="4、并行运行脚本"><a href="#4、并行运行脚本" class="headerlink" title="4、并行运行脚本"></a>4、并行运行脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">可以使用&amp;&amp;来依次运行两个或多个进程</span><br><span class="line">但是并行运行脚本呢?为此，我们可以从各种npm包中进行选择。</span><br><span class="line"></span><br><span class="line">concurrent 和 npm-run-all 是最流行的解决方案</span><br><span class="line"></span><br><span class="line">首先通过 npm i -D concurrently 安装开发依赖</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;start&quot;: &quot;concurrently \&quot;command1 arg\&quot; \&quot;command2 arg\&quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、在不同的目录中运行脚本"><a href="#5、在不同的目录中运行脚本" class="headerlink" title="5、在不同的目录中运行脚本"></a>5、在不同的目录中运行脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">有时，在不同的文件夹中拥有一个包含多个package.json文件的应用程序。</span><br><span class="line">从根目录访问这些脚本会很方便，而不是每次要运行脚本时导航到不同的文件夹，有两种方法可以执行此操作</span><br><span class="line"></span><br><span class="line">第一种是手动 cd 并运行对应的命令</span><br><span class="line">cd folder &amp;&amp; npm start &amp;&amp; cd ..</span><br><span class="line"></span><br><span class="line">第二种更优雅的解决方案，即使用--prefix标志指定路径:</span><br><span class="line">npm start --prefix path/to/your/folder</span><br><span class="line"></span><br><span class="line">下面是一个工作应用程序中此解决方案的示例，我们希望在前端(在客户机目录中)和后端(在服务器目录中)运行 npm start</span><br><span class="line"></span><br><span class="line">&quot;start&quot;: &quot;concurrently \&quot;(npm start --prefix client)\&quot; \&quot;(npm start --prefix server)\&quot;&quot;,</span><br><span class="line"></span><br><span class="line">通常，在开发全堆栈应用程序期间，咱们可能希望同时启动服务器和客户端。wait-on 节点模块提供了一种方便的方法来确保进程只在某些进程就绪时发生:在我们的例子中，我们有一个特定的端口。</span><br><span class="line">例如，这是我在使用react前端的Electron项目中使用的dev脚本。同时使用，脚本并行加载表示层和Electron窗口。但是，使用wait-on，只有在 http://localhost:3000 启动好，才会打开Electron窗口。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;dev&quot;: &quot;concurrently \&quot;cross-env BROWSER=none npm run start\&quot; \&quot;wait-on http://localhost:3000 &amp;&amp; electron .\&quot;&quot;,</span><br><span class="line"></span><br><span class="line">此外，react默认情况下会打开一个浏览器窗口，但对于 Electron 开发来说，这是不必要的。咱们可以通过传递环境变量BROWSER=none来禁用此行为</span><br></pre></td></tr></table></figure>
<h3 id="7、列出并选择可用脚本"><a href="#7、列出并选择可用脚本" class="headerlink" title="7、列出并选择可用脚本"></a>7、列出并选择可用脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">列出package.json文件中可用的脚本很简单：只需转到项目的根目录并在终端中输入npm run。</span><br><span class="line"></span><br><span class="line">但是有一种更方便的方法可以获得脚本列表，可以立即运行该列表:为此，全局安装 NTL (npm任务列表)模块:</span><br><span class="line"></span><br><span class="line">  npm i -g ntl</span><br><span class="line"></span><br><span class="line">然后在项目文件夹中运行ntl命令，可以获得一个可用脚本列表，并可以选择其中一个运行</span><br></pre></td></tr></table></figure>
<h3 id="8、运行前后脚本"><a href="#8、运行前后脚本" class="headerlink" title="8、运行前后脚本"></a>8、运行前后脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">你可能熟悉prebuild和postbuild这样的脚本，它们允许你定义在构建脚本之前或之后运行的代码</span><br><span class="line"></span><br><span class="line">但事实上，pre和post可以在任何脚本之前添加，包括自定义脚本</span><br><span class="line"></span><br><span class="line">这不仅使你的代码更干净，而且还允许你单独运行pre和post脚本</span><br></pre></td></tr></table></figure>
<h3 id="9、控制应用程序版本"><a href="#9、控制应用程序版本" class="headerlink" title="9、控制应用程序版本"></a>9、控制应用程序版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">npm 提供了一些有用的快捷方式来完成这一点</span><br><span class="line">要增加版本</span><br><span class="line"></span><br><span class="line">请在运行 npm version加上major，minor或patch`</span><br><span class="line"></span><br><span class="line">// 1.0.0</span><br><span class="line">npm version patch</span><br><span class="line">// 1.0.1</span><br><span class="line">npm version minor</span><br><span class="line">// 1.1.0</span><br><span class="line">npm version major</span><br><span class="line">// 2.0.0</span><br><span class="line"></span><br><span class="line">根据更新应用程序的频率，可以通过在每次部署时增加版本号来节省时间，使用以下脚本:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;predeploy&quot;: &quot;npm version patch&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10、从命令行编辑-package-json"><a href="#10、从命令行编辑-package-json" class="headerlink" title="10、从命令行编辑 package.json"></a>10、从命令行编辑 package.json</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">package.json是一个常规的json文件，因此可以使用工具库json从命令行进行编辑。这在修改package.json提供另外一种新的方式，允许w你q创建超出默认值的快捷方式。全局安装：</span><br><span class="line">npm install -g json</span><br><span class="line"></span><br><span class="line">然后，可以使用它来使用-I进行就地编辑。例如，要添加值为“bar”的新脚本“foo”，这样写：</span><br><span class="line"></span><br><span class="line">json -I -f package.json -e &apos;this.scripts.foo=&quot;bar&quot;&apos;</span><br></pre></td></tr></table></figure>
<h3 id="11、-自动设置和打开你的github库"><a href="#11、-自动设置和打开你的github库" class="headerlink" title="11、 自动设置和打开你的github库"></a>11、 自动设置和打开你的github库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如果package.json文件中有“repository”，则可以通过输入 npm repo在默认浏览器中打开它</span><br><span class="line"></span><br><span class="line">如果你的项目已经连接到远程存储库，并且已经在命令行上安装了git，那您可以使用这个命令找到你的连接存储库</span><br><span class="line"></span><br><span class="line">git config --get remote.origin.url</span><br><span class="line"></span><br><span class="line">更好的是，如果你按照上面的提示并安装了json模块，可以使用下面的脚本自动将正确的存储库添加到 package.json</span><br><span class="line"></span><br><span class="line">json -I -f package.json -e &quot;this.repository=\&quot;$(git config --get remote.o</span><br></pre></td></tr></table></figure>
<h3 id="12、自定义npm-init脚本"><a href="#12、自定义npm-init脚本" class="headerlink" title="12、自定义npm init脚本"></a>12、自定义npm init脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">让我们更进一步，使用我们自己的npm init脚本，它接受GitHub存储库URL并自动推送我们的第一个提交</span><br><span class="line">在本技巧中，我们将讨论如何创建自定义npm init脚本。在下一个(也是最后一个)技巧中，我们将合并git</span><br><span class="line"></span><br><span class="line">可以通过重定向到主目录中的.npm-init.js文件来编辑npm init脚本</span><br><span class="line">（在Windows上，通常是 c/Users/&lt;用户名&gt;，在 Mac 上，它是/Users/&lt;用户名&gt;）</span><br><span class="line"></span><br><span class="line">让我们首先在我们的主目录中创建一个.nmm-init.js文件</span><br><span class="line"></span><br><span class="line">为了确保npm init被指向正确的文件，可以运行:</span><br><span class="line"></span><br><span class="line">npm config set init-module ~\.npm-init.js</span><br><span class="line"></span><br><span class="line">在集成git之前，这里有一个简单的.npm-init.js文件，它模拟了默认npm init的问题。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  name: prompt(&apos;package name&apos;, basename || package.name),</span><br><span class="line">  version: prompt(&apos;version&apos;, &apos;0.0.0&apos;),</span><br><span class="line">  decription: prompt(&apos;description&apos;, &apos;&apos;),</span><br><span class="line">  main: prompt(&apos;entry point&apos;, &apos;index.js&apos;),</span><br><span class="line">  repository: prompt(&apos;git repository&apos;, &apos;&apos;),</span><br><span class="line">  keywords: prompt(function (s) &#123; return s.split(/\s+/) &#125;),</span><br><span class="line">  author: prompt(&apos;author&apos;, &apos;Joe Bloggs &lt;joe.bloggs@gmail.com&gt; (joebloggs.com)&apos;),</span><br><span class="line">  license: prompt(&apos;license&apos;, &apos;ISC&apos;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">每个问题都遵循nameInPackage模式:prompt(&apos;nameInPrompt&apos;,&apos;defaultValue&apos;)。要在缺省情况下设置值而不带问题，只需删除prompt方法。</span><br></pre></td></tr></table></figure>
<h3 id="13、使用自定义npm-init脚本将你的第一个-Commit-提交到-GitHub"><a href="#13、使用自定义npm-init脚本将你的第一个-Commit-提交到-GitHub" class="headerlink" title="13、使用自定义npm init脚本将你的第一个 Commit 提交到 GitHub"></a>13、使用自定义npm init脚本将你的第一个 Commit 提交到 GitHub</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">为了将git命令合并到.npm-init.js文件中，需要一种方法来控制命令行。为此，我们可以使用child_process 模块</span><br><span class="line"></span><br><span class="line">在文件的顶部引入它，因为我们只需要execSync函数，所以可以使用析构赋值语法自己获取它：</span><br><span class="line"></span><br><span class="line">const &#123; execSync &#125; = require(&apos;child_process&apos;);</span><br><span class="line"></span><br><span class="line">我还创建了一个helper函数，它将函数的结果打印到控制台：</span><br><span class="line"></span><br><span class="line">function run(func) &#123;</span><br><span class="line">  console.log(execSync(func).toString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">最后，我们将提示输入GitHub存储库URL，如果提供，我们将生README.md文件，并启动我们的第一次提交</span><br><span class="line"></span><br><span class="line">repository: prompt(&apos;github repository url&apos;, &apos;&apos;, function (url) &#123;</span><br><span class="line">  if (url) &#123;</span><br><span class="line">    run(&apos;touch README.md&apos;);</span><br><span class="line">    run(&apos;git init&apos;);</span><br><span class="line">    run(&apos;git add README.md&apos;);</span><br><span class="line">    run(&apos;git commit -m &quot;first commit&quot;&apos;);</span><br><span class="line">    run(`git remote add origin $&#123;url&#125;`);</span><br><span class="line">    run(&apos;git push -u origin master&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">  return url;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">总的来说，.npm-init.js文件大概如下：</span><br><span class="line"></span><br><span class="line">const &#123; execSync &#125; = require(&apos;child_process&apos;);</span><br><span class="line"></span><br><span class="line">function run(func) &#123;</span><br><span class="line">  console.log(execSync(func).toString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  name: prompt(&apos;package name&apos;, basename || package.name),</span><br><span class="line">  version: prompt(&apos;version&apos;, &apos;0.0.0&apos;),</span><br><span class="line">  decription: prompt(&apos;description&apos;, &apos;&apos;),</span><br><span class="line">  main: prompt(&apos;entry point&apos;, &apos;index.js&apos;),</span><br><span class="line">  keywords: prompt(function (s) &#123; return s.split(/\s+/) &#125;),</span><br><span class="line">  author: prompt(&apos;author&apos;, &apos;Joe Bloggs &lt;joe.bloggs@gmail.com&gt; (joebloggs.com)&apos;),</span><br><span class="line">  license: prompt(&apos;license&apos;, &apos;ISC&apos;),</span><br><span class="line">  repository: prompt(&apos;github repository url&apos;, &apos;&apos;, function (url) &#123;</span><br><span class="line">    if (url) &#123;</span><br><span class="line">      run(&apos;touch README.md&apos;);</span><br><span class="line">      run(&apos;git init&apos;);</span><br><span class="line">      run(&apos;git add README.md&apos;);</span><br><span class="line">      run(&apos;git commit -m &quot;first commit&quot;&apos;);</span><br><span class="line">      run(`git remote add origin $&#123;url&#125;`);</span><br><span class="line">      run(&apos;git push -u origin master&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    return url;</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">package.json文件：</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;Custom npm init&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class="line">  &quot;decription&quot;: &quot;A test project, to demonstrate a custom npm init script.&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;Joe Bloggs &lt;joe.bloggs@gmail.com&gt; (joebloggs.com)&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;repository&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;git&quot;,</span><br><span class="line">    &quot;url&quot;: &quot;git+https://github.com/123/custom.git&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;bugs&quot;: &#123;</span><br><span class="line">    &quot;url&quot;: &quot;https://github.com/123/issues&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;homepage&quot;: &quot;https://github.com/123/custom#readme&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">killsos.ql@gmail.com</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">137</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">killsos.ql@gmail.com</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
