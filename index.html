<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="killsos">
<meta property="og:url" content="http://jsonload.com/index.html">
<meta property="og:site_name" content="killsos">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="killsos">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jsonload.com/">





  <title>killsos</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">killsos</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人情似水分高下 世事如云任卷舒</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/01/06/Timing-breakdown-phases-explained/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/06/Timing-breakdown-phases-explained/" itemprop="url">Timing breakdown phases explained</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-06T16:23:21+08:00">
                2020-01-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Queueing"><a href="#Queueing" class="headerlink" title="Queueing."></a>Queueing.</h2><p>The browser queues requests when:</p>
<ul>
<li><p>There are higher priority requests. 更高优先级的请求</p>
</li>
<li><p>There are already six TCP connections open for this origin, which is the limit. Applies to HTTP/1.0 and HTTP/1.1 only. 6个HTTP/1.0 和 HTTP/1.1</p>
</li>
<li><p>The browser is briefly allocating space in the disk cache 浏览器分配本地磁盘空间</p>
</li>
</ul>
<h2 id="Stalled"><a href="#Stalled" class="headerlink" title="Stalled."></a>Stalled.</h2><ul>
<li>The request could be stalled for any of the reasons described in Queueing. 被延迟的原因</li>
</ul>
<h2 id="DNS-Lookup"><a href="#DNS-Lookup" class="headerlink" title="DNS Lookup."></a>DNS Lookup.</h2><ul>
<li>The browser is resolving the request’s IP address. DNS解析时间</li>
</ul>
<h2 id="Proxy-negotiation"><a href="#Proxy-negotiation" class="headerlink" title="Proxy negotiation."></a>Proxy negotiation.</h2><ul>
<li>The browser is negotiating the request with a proxy server. 浏览器将请求发送代理服务器</li>
</ul>
<h2 id="Request-sent"><a href="#Request-sent" class="headerlink" title="Request sent."></a>Request sent.</h2><ul>
<li>The request is being sent. 请求被发送</li>
</ul>
<h2 id="ServiceWorker-Preparation"><a href="#ServiceWorker-Preparation" class="headerlink" title="ServiceWorker Preparation."></a>ServiceWorker Preparation.</h2><ul>
<li>The browser is starting up the service worker. 浏览器正在启动服务程序</li>
</ul>
<h2 id="Request-to-ServiceWorker"><a href="#Request-to-ServiceWorker" class="headerlink" title="Request to ServiceWorker."></a>Request to ServiceWorker.</h2><ul>
<li>The request is being sent to the service worker. 请求发送给服务程序</li>
</ul>
<h2 id="Waiting-TTFB"><a href="#Waiting-TTFB" class="headerlink" title="Waiting (TTFB)."></a>Waiting (TTFB).</h2><ul>
<li>The browser is waiting for the first byte of a response.  接收到第一个字节</li>
<li>TTFB stands for Time To First Byte.</li>
<li>This timing includes 1 round trip of latency and the time the server took to prepare the response. 一个来回延迟</li>
</ul>
<h2 id="Content-Download"><a href="#Content-Download" class="headerlink" title="Content Download."></a>Content Download.</h2><ul>
<li>The browser is receiving the response. 浏览器接受数据时间</li>
</ul>
<h2 id="Receiving-Push"><a href="#Receiving-Push" class="headerlink" title="Receiving Push."></a>Receiving Push.</h2><ul>
<li>The browser is receiving data for this response via HTTP/2 Server Push. 通过http2push方式接受的数据</li>
</ul>
<h2 id="Reading-Push"><a href="#Reading-Push" class="headerlink" title="Reading Push."></a>Reading Push.</h2><p>The browser is reading the local data previously received.  读取本地数据</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/01/06/dragimage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/06/dragimage/" itemprop="url">dragimage</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-06T08:53:05+08:00">
                2020-01-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  #drop-region &#123;</span><br><span class="line">	background-color: #fff;</span><br><span class="line">	border-radius:<span class="number">20</span>px;</span><br><span class="line">	box-shadow:<span class="number">0</span> <span class="number">0</span> <span class="number">35</span>px rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.05</span>);</span><br><span class="line">	width:<span class="number">400</span>px;</span><br><span class="line">	padding:<span class="number">60</span>px <span class="number">40</span>px;</span><br><span class="line">	text-align: center;</span><br><span class="line">	cursor:pointer;</span><br><span class="line">	transition:<span class="number">.3</span>s;</span><br><span class="line">&#125;</span><br><span class="line">#drop-region:hover &#123;</span><br><span class="line">	box-shadow:<span class="number">0</span> <span class="number">0</span> <span class="number">45</span>px rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#image-preview &#123;</span><br><span class="line">	margin-top:<span class="number">20</span>px;</span><br><span class="line">&#125;</span><br><span class="line">#image-preview .image-view &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">	position:relative;</span><br><span class="line">	margin-right: <span class="number">13</span>px;</span><br><span class="line">	margin-bottom: <span class="number">13</span>px;</span><br><span class="line">&#125;</span><br><span class="line">#image-preview .image-view img &#123;</span><br><span class="line">    max-width: <span class="number">100</span>px;</span><br><span class="line">    max-height: <span class="number">100</span>px;</span><br><span class="line">&#125;</span><br><span class="line">#image-preview .overlay &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    width: <span class="number">100</span>%;</span><br><span class="line">    height: <span class="number">100</span>%;</span><br><span class="line">    top: <span class="number">0</span>;</span><br><span class="line">    right: <span class="number">0</span>;</span><br><span class="line">    z-index: <span class="number">2</span>;</span><br><span class="line">    background: rgba(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;body style="padding:100px;background-color:#fafafa;font-family: 'Segoe UI', sans-serif;"&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;div id="drop-region"&gt;</span></span><br><span class="line"><span class="regexp">	&lt;div class="drop-message"&gt;</span></span><br><span class="line"><span class="regexp">		Drag &amp; Drop images or click to upload</span></span><br><span class="line"><span class="regexp">	&lt;/</span>div&gt;</span><br><span class="line">	&lt;div id=<span class="string">"image-preview"</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">let dropRegion = document.getElementById("drop-region"), /</span><span class="regexp">/ where files are dropped + file selector is opened</span></span><br><span class="line"><span class="regexp">	imagePreviewRegion = document.getElementById("image-preview"); 	/</span><span class="regexp">/ where images are previewed</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ open file selector when clicked on the drop region</span></span><br><span class="line"><span class="regexp">let fakeInput = document.createElement("input");</span></span><br><span class="line"><span class="regexp">fakeInput.type = "file";</span></span><br><span class="line"><span class="regexp">fakeInput.accept = "image/</span>*<span class="string">";</span></span><br><span class="line"><span class="string">fakeInput.multiple = true;</span></span><br><span class="line"><span class="string">dropRegion.addEventListener('click', function() &#123;</span></span><br><span class="line"><span class="string">	fakeInput.click();</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fakeInput.addEventListener("</span>change<span class="string">", function() &#123;</span></span><br><span class="line"><span class="string">	let files = fakeInput.files;</span></span><br><span class="line"><span class="string">	handleFiles(files);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function preventDefault(e) &#123;</span></span><br><span class="line"><span class="string">	e.preventDefault();</span></span><br><span class="line"><span class="string">  	e.stopPropagation();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">dropRegion.addEventListener('dragenter', preventDefault, false)</span></span><br><span class="line"><span class="string">dropRegion.addEventListener('dragleave', preventDefault, false)</span></span><br><span class="line"><span class="string">dropRegion.addEventListener('dragover', preventDefault, false)</span></span><br><span class="line"><span class="string">dropRegion.addEventListener('drop', preventDefault, false)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function handleDrop(e) &#123;</span></span><br><span class="line"><span class="string">	let dt = e.dataTransfer,</span></span><br><span class="line"><span class="string">		files = dt.files;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	if (files.length) &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		handleFiles(files);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	&#125; else &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		// check for img</span></span><br><span class="line"><span class="string">		let html = dt.getData('text/html'),</span></span><br><span class="line"><span class="string">	        match = html &amp;&amp; /\bsrc="</span>?([^<span class="string">"\s]+)"</span>?\s*<span class="regexp">/.exec(html),</span></span><br><span class="line"><span class="regexp">	        url = match &amp;&amp; match[1];</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">	    if (url) &#123;</span></span><br><span class="line"><span class="regexp">	        uploadImageFromURL(url);</span></span><br><span class="line"><span class="regexp">	        return;</span></span><br><span class="line"><span class="regexp">	    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">	function uploadImageFromURL(url) &#123;</span></span><br><span class="line"><span class="regexp">		var img = new Image;</span></span><br><span class="line"><span class="regexp">        var c = document.createElement("canvas");</span></span><br><span class="line"><span class="regexp">        var ctx = c.getContext("2d");</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        img.onload = function() &#123;</span></span><br><span class="line"><span class="regexp">            c.width = this.naturalWidth;     /</span><span class="regexp">/ update canvas size to match image</span></span><br><span class="line"><span class="regexp">            c.height = this.naturalHeight;</span></span><br><span class="line"><span class="regexp">            ctx.drawImage(this, 0, 0);       /</span><span class="regexp">/ draw in image</span></span><br><span class="line"><span class="regexp">            c.toBlob(function(blob) &#123;        /</span><span class="regexp">/ get content as PNG blob</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">            	/</span><span class="regexp">/ call our main function</span></span><br><span class="line"><span class="regexp">                handleFiles( [blob] );</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">            &#125;, "image/</span>png<span class="string">");</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string">        img.onerror = function() &#123;</span></span><br><span class="line"><span class="string">            alert("</span><span class="built_in">Error</span> <span class="keyword">in</span> uploading<span class="string">");</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        img.crossOrigin = "</span><span class="string">";              // if from different origin</span></span><br><span class="line"><span class="string">        img.src = url;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">dropRegion.addEventListener('drop', handleDrop, false);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function handleFiles(files) &#123;</span></span><br><span class="line"><span class="string">	for (var i = 0, len = files.length; i &lt; len; i++) &#123;</span></span><br><span class="line"><span class="string">		if (validateImage(files[i]))</span></span><br><span class="line"><span class="string">			previewAnduploadImage(files[i]);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function validateImage(image) &#123;</span></span><br><span class="line"><span class="string">	// check the type</span></span><br><span class="line"><span class="string">	var validTypes = ['image/jpeg', 'image/png', 'image/gif'];</span></span><br><span class="line"><span class="string">	if (validTypes.indexOf( image.type ) === -1) &#123;</span></span><br><span class="line"><span class="string">		alert("</span>Invalid File Type<span class="string">");</span></span><br><span class="line"><span class="string">		return false;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// check the size</span></span><br><span class="line"><span class="string">	var maxSizeInBytes = 10 * 10e6; // 10MB</span></span><br><span class="line"><span class="string">	if (image.size &gt; maxSizeInBytes) &#123;</span></span><br><span class="line"><span class="string">		alert("</span>File too large<span class="string">");</span></span><br><span class="line"><span class="string">		return false;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	return true;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function previewAnduploadImage(image) &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// container</span></span><br><span class="line"><span class="string">	var imgView = document.createElement("</span>div<span class="string">");</span></span><br><span class="line"><span class="string">	imgView.className = "</span>image-view<span class="string">";</span></span><br><span class="line"><span class="string">	imagePreviewRegion.appendChild(imgView);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// previewing image</span></span><br><span class="line"><span class="string">	var img = document.createElement("</span>img<span class="string">");</span></span><br><span class="line"><span class="string">	imgView.appendChild(img);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// progress overlay</span></span><br><span class="line"><span class="string">	var overlay = document.createElement("</span>div<span class="string">");</span></span><br><span class="line"><span class="string">	overlay.className = "</span>overlay<span class="string">";</span></span><br><span class="line"><span class="string">	imgView.appendChild(overlay);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// read the image...</span></span><br><span class="line"><span class="string">	var reader = new FileReader();</span></span><br><span class="line"><span class="string">	reader.onload = function(e) &#123;</span></span><br><span class="line"><span class="string">		img.src = e.target.result;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	reader.readAsDataURL(image);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// create FormData</span></span><br><span class="line"><span class="string">	var formData = new FormData();</span></span><br><span class="line"><span class="string">	formData.append('image', image);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// upload the image</span></span><br><span class="line"><span class="string">	var uploadLocation = 'https://api.imgbb.com/1/upload';</span></span><br><span class="line"><span class="string">	formData.append('key', 'bb63bee9d9846c8d5b7947bcdb4b3573');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	var ajax = new XMLHttpRequest();</span></span><br><span class="line"><span class="string">	ajax.open("</span>POST<span class="string">", uploadLocation, true);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	ajax.onreadystatechange = function(e) &#123;</span></span><br><span class="line"><span class="string">		if (ajax.readyState === 4) &#123;</span></span><br><span class="line"><span class="string">			if (ajax.status === 200) &#123;</span></span><br><span class="line"><span class="string">				// done!</span></span><br><span class="line"><span class="string">			&#125; else &#123;</span></span><br><span class="line"><span class="string">				// error!</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	ajax.upload.onprogress = function(e) &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		// change progress</span></span><br><span class="line"><span class="string">		// (reduce the width of overlay)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		var perc = (e.loaded / e.total * 100) || 100,</span></span><br><span class="line"><span class="string">			width = 100 - perc;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		overlay.style.width = width;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	ajax.send(formData);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2019/12/13/ES7-ES8-ES9-ES10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/13/ES7-ES8-ES9-ES10/" itemprop="url">ES7-ES8-ES9-ES10</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-13T17:46:07+08:00">
                2019-12-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>Array.prototype.includes()方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="string">'8'</span>, <span class="literal">NaN</span>, <span class="number">-0</span>]</span><br><span class="line">arr.includes(<span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line">arr.includes(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// false 该方法的第二个参数表示搜索的起始位置，默认为0</span></span><br><span class="line">arr.includes(<span class="string">'1'</span>) <span class="comment">// false</span></span><br><span class="line">arr.includes(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br><span class="line">arr.includes(+<span class="number">0</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">indexOf()</span><br><span class="line"></span><br><span class="line">find() 和 findIndex()</span><br><span class="line"></span><br><span class="line">数组实例的find方法，用于找出第一个符合条件的数组成员。另外，这两个方法都可以发现<span class="literal">NaN</span>，弥补了数组的indexOf方法的不足。</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>求幂运算符 **</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(2**10);// 输出1024</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Async/Await<br>await 后面一定是Promise 对象，如果不是会自动包装成Promise对象  </li>
</ol>
<p>根据MDN定义，async是一个通过异步执行并隐式返回Promise作为结果的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">async function foo () &#123;</span><br><span class="line">  return &apos;123&apos;</span><br><span class="line">&#125;</span><br><span class="line">foo().then(val =&gt; &#123;</span><br><span class="line">  console.log(val) // 123</span><br><span class="line">&#125;)</span><br><span class="line">上述代码，我们可以看到调用async 声明的foo 函数返回了一个Promise对象，等价于下面代码：</span><br><span class="line"></span><br><span class="line">async function foo () &#123;</span><br><span class="line">  return Promise.resolve(&apos;123&apos;)</span><br><span class="line">&#125;</span><br><span class="line">foo().then(val =&gt; &#123;</span><br><span class="line">  console.log(val) // 123</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Object.values()，Object.entries()</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ES5 引入了Object.keys方法，返回一个数组，成员是参数对象自身的（不含继承的）所有可遍历（enumerable）属性的键名。</span><br><span class="line">ES8引入了跟Object.keys配套的Object.values和Object.entries，作为遍历一个对象的补充手段，供for...of循环使用。</span><br><span class="line">Object.values方法返回一个数组，成员是参数对象自身的（不含继承的）所有可遍历（enumerable）属性的键值</span><br><span class="line"></span><br><span class="line">需要注意的是，如果属性名为数值的属性，是按照数值大小，从小到大遍历的，因此返回的顺序是b、c、a</span><br><span class="line"></span><br><span class="line">Object.entries()方法返回一个数组，成员是参数对象自身的（不含继承的）所有可遍历（enumerable）属性的键值对数组</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>String padding</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String.prototype.padStart 和 String.prototype.padEnd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">String.padStart(targetLength,[padString])</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>Object.getOwnPropertyDescriptors()</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ES5的Object.getOwnPropertyDescriptor()方法会返回某个对象属性的描述对象（descriptor）</span><br><span class="line"></span><br><span class="line">ES8 引入了Object.getOwnPropertyDescriptors()方法，返回指定对象所有自身属性（非继承属性）的描述对象</span><br><span class="line"></span><br><span class="line">该方法的引入目的，主要是为了解决Object.assign()无法正确拷贝get属性和set属性的问题</span><br><span class="line"></span><br><span class="line">Object.assign方法总是拷贝一个属性的值，而不会拷贝它背后的赋值方法或取值方法。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这时Object.getOwnPropertyDescriptors()方法配合Object.defineProperties()方法，就可以实现正确拷贝。</span><br><span class="line"></span><br><span class="line">const source = &#123;</span><br><span class="line">  set foo (value) &#123;</span><br><span class="line">    console.log(value)</span><br><span class="line">  &#125;,</span><br><span class="line">  get bar () &#123;</span><br><span class="line">    return &apos;123&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const target2 = &#123;&#125;</span><br><span class="line">Object.defineProperties(target2, Object.getOwnPropertyDescriptors(source))</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>for await of<br>for of方法能够遍历具有Symbol.iterator接口的同步迭代器数据，但是不能遍历异步迭代器。<br>ES9新增的for await of可以用来遍历具有Symbol.asyncIterator方法的数据结构，也就是异步迭代器，<br>且会等待前一个成员的状态改变后才会遍历到下一个成员，相当于async函数内部的await  </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// for of遍历</span><br><span class="line">function Gen (time) &#123;</span><br><span class="line">  return new Promise(function (resolve, reject) &#123;</span><br><span class="line">    setTimeout(function () &#123;</span><br><span class="line">      resolve(time)</span><br><span class="line">    &#125;, time)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">async function test () &#123;</span><br><span class="line">  let arr = [Gen(2000), Gen(100), Gen(3000)]</span><br><span class="line">  for await (let item of arr) &#123;</span><br><span class="line">    console.log(Date.now(), item)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br><span class="line">// 1575536194608 2000</span><br><span class="line">// 1575536194608 100</span><br><span class="line">// 1575536195608 3000</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>Object Rest Spread</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const input = &#123;</span><br><span class="line">  a: 1,</span><br><span class="line">  b: 2,</span><br><span class="line">  c: 1</span><br><span class="line">&#125;</span><br><span class="line">const output = &#123;</span><br><span class="line">  ...input,</span><br><span class="line">  c: 3</span><br><span class="line">&#125;</span><br><span class="line">console.log(output) // &#123;a: 1, b: 2, c: 3&#125;</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>Promise.prototype.finally()</li>
</ol>
<h2 id="10-新的正则表达式特性"><a href="#10-新的正则表达式特性" class="headerlink" title="10. 新的正则表达式特性"></a>10. 新的正则表达式特性</h2><ol>
<li>s(dotAll)flag</li>
</ol>
<p>正则表达式中，点（.）是一个特殊字符，代表任意的单个字符，但是有两个例外。<br>一个是四个字节的 UTF-16 字符，这个可以用u修饰符解决；<br>另一个是行终止符,如换行符(\n)或回车符(\r),这个可以通过ES9的s(dotAll)flag，<br>在原正则表达式基础上添加s表示:  </p>
<p>console.log(/foo.bar/.test(‘foo\nbar’)) // false<br>console.log(/foo.bar/s.test(‘foo\nbar’)) // true  </p>
<p>那如何判断当前正则是否使用了 dotAll 模式呢？  </p>
<p>const re = /foo.bar/s // Or, <code>const re = new RegExp(&#39;foo.bar&#39;, &#39;s&#39;);</code>.  </p>
<p>console.log(re.test(‘foo\nbar’)) // true  </p>
<p>console.log(re.dotAll) // true  </p>
<p>console.log(re.flags) // ‘s’</p>
<ol start="2">
<li>命名捕获组<br>在一些正则表达式模式中，使用数字进行匹配可能会令人混淆。例如，使用正则表达式/(\d{4})-(\d{2})-(\d{2})/来匹配日期。<br>因为美式英语中的日期表示法和英式英语中的日期表示法不同，所以很难区分哪一组表示日期，哪一组表示月份:  </li>
</ol>
<p>const re = /(\d{4})-(\d{2})-(\d{2})/;<br>const match= re.exec(‘2019-01-01’);<br>console.log(match[0]);    // → 2019-01-01<br>console.log(match[1]);    // → 2019<br>console.log(match[2]);    // → 01<br>console.log(match[3]);    // → 01<br>ES9引入了命名捕获组，允许为每一个组匹配指定一个名字，既便于阅读代码，又便于引用。  </p>
<p>const re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;<br>const match = re.exec(‘2019-01-01’);<br>console.log(match.groups);          // → {year: “2019”, month: “01”, day: “01”}<br>console.log(match.groups.year);     // → 2019<br>console.log(match.groups.month);    // → 01<br>console.log(match.groups.day);      // → 01</day></month></year></p>
<p>上面代码中，“命名捕获组”在圆括号内部，模式的头部添加“问号 + 尖括号 + 组名”（?），然后就可以在exec方法返回结果的groups属性上引用该组名。</p>
<p>命名捕获组也可以使用在replace()方法中，例如将日期转换为美国的 MM-DD-YYYY 格式：</p>
<p>const re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/<br>const usDate = ‘2018-04-30’.replace(re, ‘$<month>-$<day>-$<year>‘)<br>console.log(usDate) // 04-30-2018</year></day></month></day></month></year></p>
<ol start="3">
<li>Lookbehind 后行断言</li>
</ol>
<p>JavaScript 语言的正则表达式，只支持先行断言，不支持后行断言，先行断言我们可以简单理解为”先遇到一个条件，再判断后面是否满足”，如下面例子：   </p>
<p>let test = ‘hello world’<br>console.log(test.match(/hello(?=\sworld)/))<br>// [“hello”, index: 0, input: “hello world”, groups: undefined]<br>但有时我们想判断前面是 world 的 hello，这个代码是实现不了的。在 ES9 就支持这个后行断言了：</p>
<p>let test = ‘world hello’<br>console.log(test.match(/(?&lt;=world\s)hello/))<br>// [“hello”, index: 6, input: “world hello”, groups: undefined]<br>(?&lt;…)是后行断言的符号，(?..)是先行断言的符号，然后结合 =(等于)、!(不等)、\1(捕获匹配)。</p>
<ol start="4">
<li>Unicode属性转义<br>ES2018 引入了一种新的类的写法\p{…}和\P{…}，允许正则表达式匹配符合 Unicode 某种属性的所有字符。<br>比如你可以使用\p{Number}来匹配所有的Unicode数字，例如，假设你想匹配的Unicode字符㉛字符串:  </li>
</ol>
<p>const str = ‘㉛’;<br>console.log(/\d/u.test(str));    // → false<br>console.log(/\p{Number}/u.test(str));     // → true<br>同样的，你可以使用\p{Alphabetic}来匹配所有的Unicode单词字符:</p>
<p>const str = ‘ض’;<br>console.log(/\p{Alphabetic}/u.test(str));     // → true<br>// the \w shorthand cannot match ض<br>console.log(/\w/u.test(str));    // → false<br>同样有一个负向的Unicode属性转义模板 \P{…}</p>
<p>console.log(/\P{Number}/u.test(‘㉛’));    // → false<br>console.log(/\P{Number}/u.test(‘ض’));    // → true<br>console.log(/\P{Alphabetic}/u.test(‘㉛’));    // → true<br>console.log(/\P{Alphabetic}/u.test(‘ض’));    // → false<br>除了字母和数字之外，Unicode属性转义中还可以使用其他一些属性</p>
<h2 id="11-Array-prototype-flat"><a href="#11-Array-prototype-flat" class="headerlink" title="11.  Array.prototype.flat()"></a>11.  Array.prototype.flat()</h2><p>flat() 方法会按照一个可指定的深度递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回  </p>
<p>newArray = arr.flat(depth)<br>// depth是指定要提取嵌套数组的结构深度，默认值为 1      </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const numbers1 = [1, 2, [3, 4, [5, 6]]]</span><br><span class="line">console.log(numbers1.flat())// [1, 2, 3, 4, [5, 6]]</span><br><span class="line">const numbers2 = [1, 2, [3, 4, [5, 6]]]</span><br><span class="line">console.log(numbers2.flat(2))// [1, 2, 3, 4, 5, 6]</span><br></pre></td></tr></table></figure>
<h2 id="12-Array-prototype-flatMap"><a href="#12-Array-prototype-flatMap" class="headerlink" title="12. Array.prototype.flatMap()"></a>12. Array.prototype.flatMap()</h2><p>首先使用映射函数映射每个元素，然后将结果压缩成一个新数组。<br>从方法的名字上也可以看出来它包含两部分功能一个是 map，一个是 flat（深度为1）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let arr = [1, 2, 3]</span><br><span class="line">console.log(arr.map(item =&gt; [item * 2]).flat()) // [2, 4, 6]</span><br><span class="line">console.log(arr.flatMap(item =&gt; [item * 2])) // [2, 4, 6]</span><br><span class="line"></span><br><span class="line">实际上flatMap是综合了map和flat的操作，所以它也只能打平一层。</span><br></pre></td></tr></table></figure>
<h2 id="13-Object-fromEntries"><a href="#13-Object-fromEntries" class="headerlink" title="13. Object.fromEntries()"></a>13. Object.fromEntries()</h2><p>Object.fromEntries 这个新的API实现了与 Object.entries 相反的操作。这使得根据对象的 entries 很容易得到 object。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const object = &#123; x: 23, y:24 &#125;;</span><br><span class="line">const entries = Object.entries(object); // [[&apos;x&apos;, 23], [&apos;y&apos;, 24]]</span><br><span class="line">const result = Object.fromEntries(entries); // &#123; x: 23, y: 24 &#125;</span><br></pre></td></tr></table></figure>
<h2 id="14-String-trimStart-和-String-trimEnd"><a href="#14-String-trimStart-和-String-trimEnd" class="headerlink" title="14. String.trimStart 和 String.trimEnd"></a>14. String.trimStart 和 String.trimEnd</h2><h2 id="15-String-prototype-matchAll"><a href="#15-String-prototype-matchAll" class="headerlink" title="15. String.prototype.matchAll"></a>15. String.prototype.matchAll</h2><p>现在通过ES9的String.prototype.matchAll方法，可以一次性取出所有匹配  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function collectGroup1 (regExp, str) &#123;</span><br><span class="line">  let results = []</span><br><span class="line">  for (const match of str.matchAll(regExp)) &#123;</span><br><span class="line">    results.push(match[1])</span><br><span class="line">  &#125;</span><br><span class="line">  return results</span><br><span class="line">&#125;</span><br><span class="line">console.log(collectGroup1(/&quot;([^&quot;]*)&quot;/g, `&quot;foo&quot; and &quot;bar&quot; and &quot;baz&quot;`))</span><br><span class="line">// [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="16-try…catch"><a href="#16-try…catch" class="headerlink" title="16. try…catch"></a>16. try…catch</h2><p>在ES10中，try-catch语句中的参数变为了一个可选项。以前我们写catch语句时，必须传递一个异常参数。<br>这就意味着，即便我们在catch里面根本不需要用到这个异常参数也必须将其传递进去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">这里 err 是必须的参数，在 ES10 可以省略这个参数：</span><br><span class="line"></span><br><span class="line">// ES10</span><br><span class="line">try &#123;</span><br><span class="line">  console.log(&apos;Foobar&apos;)</span><br><span class="line">&#125; catch &#123;</span><br><span class="line">  console.error(&apos;Bar&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="17-BigInt"><a href="#17-BigInt" class="headerlink" title="17. BigInt"></a>17. BigInt</h2><p>JS中Number采用IEEE 754中双精度浮点数 采用64位(8字节)存储一个浮点数  </p>
<p>0 - 51位 存储 尾数  采用二级制 科学记号  mantissa   52   </p>
<p>52 - 62位 存储 指数  exponent    11</p>
<p>63位 符号位 sign bit   1  </p>
<p><img src="../images/fp.png" alt="双精度浮点数"></p>
<p>格式：符号位+指数位+尾数位<br>符号位S：第 1 位是正负数符号位（sign），0代表正数，1代表负数  </p>
<p>指数位E：中间的 11 位存储指数（exponent），用来表示次方数  </p>
<p>科学计数法中指数E是可以为负数的，在表示负的指数时IEEE754标准引入了一个偏移量1023(3ff)<br>在存储指数时加上该偏移量把负数E转成正数。这就导致11位的指数能够表示指数的范围是[-1023, 1024]</p>
<p>尾数位M：最后的 52 位是尾数（mantissa），超出的部分自动进一舍零，没有填满的部分自动补0<br>如10进制数400.12，用10进制科学计数法表示为：4.0012*10^2,。其中”0012”就是尾数部分。</p>
<p><img src="../images/fp1.png" alt="双精度浮点数"></p>
<p>注意以上的公式遵循科学计数法的规范，在十进制是为0&lt;M&lt;10，到二进行就是0&lt;M&lt;2。也就是说整数部分只能是1，<br>所以可以被舍去，只保留后面的小数部分。如 4.5 转换成二进制就是 100.1，科学计数法表示是 1.001*2^2，<br>舍去1后 M = 001。E是一个无符号整数，因为长度是11位，取值范围是 0~2047。但是科学计数法中的指数是可以为负数的，<br>所以再减去一个中间数 1023，[0,1022]表示为负，[1024,2047] 表示为正。如4.5 的指数E = 1025，尾数M为 001。  </p>
<p>单精度浮点数 32位  1符号位 sign bit +  8指数位 exponent + 23尾数位mantissa</p>
<p>现在ES10引入了一种新的数据类型 BigInt（大整数），来解决这个问题。BigInt 只用来表示整数，没有位数的限制，任何位数的整数都可以精确表示<br>创建 BigInt 类型的值也非常简单，只需要在数字后面加上 n 即可。例如，123 变为 123n。<br>也可以使用全局方法 BigInt(value) 转化，入参 value 为数字或数字字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> aNumber = <span class="number">111</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aBigInt = BigInt(aNumber);</span><br><span class="line"></span><br><span class="line">aBigInt === <span class="number">111</span>n <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> aBigInt === <span class="string">'bigint'</span> <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">111</span> <span class="comment">// "number"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">111</span>n <span class="comment">// "bigint"</span></span><br></pre></td></tr></table></figure>
<p>如果算上 BigInt，JavaScript 中原始类型就从 6 个变为了 7 个。</p>
<p>Boolean<br>Null<br>Undefined<br>Number<br>String<br>Symbol (new in ECMAScript 2015)<br>BigInt (new in ECMAScript 2019)</p>
<p>再加上一个 引用类型 Object</p>
<h2 id="18-Symbol-prototype-description"><a href="#18-Symbol-prototype-description" class="headerlink" title="18. Symbol.prototype.description"></a>18. Symbol.prototype.description</h2><p>我们知道，Symbol 的描述只被存储在内部的 [[Description]]，没有直接对外暴露<br>我们只有调用 Symbol 的 toString() 时才可以读取这个属性：</p>
<p>Symbol(‘desc’).description;  // “desc”<br>Symbol(‘’).description;      // “”<br>Symbol().description;        // undefined</p>
<h2 id="19-Function-prototype-toString"><a href="#19-Function-prototype-toString" class="headerlink" title="19.Function.prototype.toString()"></a>19.Function.prototype.toString()</h2><p>ES2019中，Function.toString()发生了变化。之前执行这个方法时，得到的字符串是去空白符号的。而现在，得到的字符串呈现出原本源码的样子</p>
<p>function sum(a, b) {<br>  return a + b;<br>}<br>console.log(sum.toString());<br>// function sum(a, b) {<br>//  return a + b;<br>// }</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2019/12/13/面试题01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/13/面试题01/" itemprop="url">面试题01</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-13T17:35:27+08:00">
                2019-12-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-如何判断左右小括号是否全部匹配。如"><a href="#1-如何判断左右小括号是否全部匹配。如" class="headerlink" title="1. 如何判断左右小括号是否全部匹配。如 ( ( ))()((((()))))"></a>1. 如何判断左右小括号是否全部匹配。如 ( ( ))()((((()))))</h2><p>思路：利用栈，先进后出的特性  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> judgeBracketsMatch = <span class="function">(<span class="params">s</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> result = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; s.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i] === <span class="string">'('</span>)&#123;</span><br><span class="line">                result.push(s[i])</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(s[i] === <span class="string">')'</span>)&#123;</span><br><span class="line">                result.pop()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(result.length)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-下面代码中的-a-在什么情况下会打印1？"><a href="#2-下面代码中的-a-在什么情况下会打印1？" class="headerlink" title="2. 下面代码中的 a 在什么情况下会打印1？"></a>2. 下面代码中的 a 在什么情况下会打印1？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = ?</span><br><span class="line"><span class="keyword">if</span>(a == <span class="number">1</span> &amp;&amp; a == <span class="number">2</span> &amp;&amp; a == <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">思路：重写 valueOf 方法 参考答案：</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line"> value: <span class="number">0</span>,</span><br><span class="line"> valueOf()&#123;</span><br><span class="line">  <span class="keyword">return</span> ++<span class="keyword">this</span>.value</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a == <span class="number">1</span> &amp;&amp; a == <span class="number">2</span> &amp;&amp; a == <span class="number">3</span>) &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-如何理解回流和重绘"><a href="#3-如何理解回流和重绘" class="headerlink" title="3. 如何理解回流和重绘"></a>3. 如何理解回流和重绘</h2><p>回流：当我们对 DOM 的修改引发了 DOM 几何尺寸的变化（比如修改元素的宽、高或隐藏元素等）时，浏览器需要重新计算元素的几何属性<br>（其他元素的几何属性和位置也会因此受到影响），然后再将计算的结果绘制出来。这个过程就是回流（也叫重排）。</p>
<p>重绘：当我们对 DOM 的修改导致了样式的变化、却并未影响其几何属性（比如修改了颜色或背景色）时，浏览器不需重新计算元素的几何属性、<br>直接为该元素绘制新的样式（跳过了上图所示的回流环节）。这个过程叫做重绘。由此我们可以看出，重绘不一定导致回流，回流一定会导致重绘。</p>
<h2 id="4-常见的会导致回流的元素："><a href="#4-常见的会导致回流的元素：" class="headerlink" title="4. 常见的会导致回流的元素："></a>4. 常见的会导致回流的元素：</h2><ol>
<li>常见的几何属性有 width、height、padding、margin、left、top、border 等等。<br>最容易被忽略的操作：获取一些需要通过即时计算得到的属性,当你要用到像这样的属性：<br>offsetTop、offsetLeft、 offsetWidth、offsetHeight、scrollTop、scrollLeft、scrollWidth、scrollHeight、<br>clientTop、clientLeft、clientWidth、clientHeight 时，浏览器为了获取这些值，也会进行回流。<br>当我们调用了 getComputedStyle 方法，或者 IE 里的 currentStyle 时，也会触发回流。原理是一样的，都为求一个“即时性”和“准确性”。  </li>
</ol>
<ol start="2">
<li><p>避免方式：<br>避免逐条改变样式，使用类名去合并样式<br>将 DOM “离线”,使用DocumentFragment<br>提升为合成层,如使用will-change<br>#divId {<br>will-change: transform;<br>}</p>
</li>
<li><p>优点</p>
</li>
</ol>
<p>合成层的位图，会交由 GPU 合成，比 CPU 处理要快<br>当需要 repaint 时，只需要 repaint 本身，不会影响到其他的层<br>对于 transform 和 opacity 效果，不会触发 layout 和 paint</p>
<ol start="4">
<li>注意：<br>部分浏览器缓存了一个 flush 队列，把我们触发的回流与重绘任务都塞进去，待到队列里的任务多起来、或者达到了一定的时间间隔，或者“不得已”的时候，<br>再将这些任务一口气出队。但是当我们访问一些即使属性时，浏览器会为了获得此时此刻的、最准确的属性值，而提前将 flush 队列的任务出队。</li>
</ol>
<h2 id="5-实现一个LazyMan，可以按照以下方式调用"><a href="#5-实现一个LazyMan，可以按照以下方式调用" class="headerlink" title="5. 实现一个LazyMan，可以按照以下方式调用"></a>5. 实现一个LazyMan，可以按照以下方式调用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">实现一个LazyMan，可以按照以下方式调用:</span><br><span class="line">LazyMan(<span class="string">'Hank'</span>)输出:</span><br><span class="line">Hi! This is Hank!</span><br><span class="line">LazyMan(<span class="string">'Hank'</span>).sleep(<span class="number">10</span>).eat(<span class="string">'dinner'</span>)输出</span><br><span class="line">Hi! This is Hank!</span><br><span class="line"><span class="comment">//等待10秒..</span></span><br><span class="line">Wake up after <span class="number">10</span></span><br><span class="line">Eat dinner~</span><br><span class="line">LazyMan(<span class="string">'Hank'</span>).sleep(<span class="number">10</span>).eat(<span class="string">'dinner'</span>).eat(<span class="string">'supper'</span>)输出</span><br><span class="line">Hi This is Hank!</span><br><span class="line">Eat dinner~</span><br><span class="line">Eat supper~</span><br><span class="line">LazyMan(<span class="string">'Hank'</span>).sleepFirst(<span class="number">5</span>).eat(<span class="string">'supper'</span>)输出</span><br><span class="line"><span class="comment">//等待5秒</span></span><br><span class="line">Wake up after <span class="number">5</span></span><br><span class="line">Hi This is Hank!</span><br><span class="line">Eat supper~</span><br><span class="line">以此类推</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LazyMan</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="keyword">this</span> <span class="keyword">instanceof</span> LazyMan))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LazyMan(name)</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">const</span> cb = <span class="function">(<span class="params">next</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Hi This is <span class="subst">$&#123;name&#125;</span>!`</span>)</span><br><span class="line">      next()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.cbs = [cb];</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.next()</span><br><span class="line">  &#125;,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">LazyMan.prototype.eat = <span class="function"><span class="keyword">function</span> (<span class="params">food</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> cb = <span class="function">(<span class="params">next</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`Eat <span class="subst">$&#123;food&#125;</span>~`</span>)</span><br><span class="line">        next()</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">this</span>.cbs.push(cb);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line">LazyMan.prototype.sleepFirst = <span class="function"><span class="keyword">function</span> (<span class="params">time</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> cb = <span class="function">(<span class="params">next</span>)=&gt;</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            next()</span><br><span class="line">        &#125;,time*<span class="number">1000</span>) </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">this</span>.cbs.unshift(cb);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line">LazyMan.prototype.sleep = <span class="function"><span class="keyword">function</span>(<span class="params">time</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> cb = <span class="function">(<span class="params">next</span>)=&gt;</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            next()</span><br><span class="line">        &#125;,time*<span class="number">1000</span>) </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">this</span>.cbs.push(cb);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line">LazyMan.prototype.next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.cbs.length &lt;= <span class="number">0</span>)<span class="keyword">return</span></span><br><span class="line">    <span class="keyword">const</span> first = <span class="keyword">this</span>.cbs.shift()</span><br><span class="line">    first(<span class="keyword">this</span>.next.bind(<span class="keyword">this</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2019/12/12/web性能时间片timeslicing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/12/web性能时间片timeslicing/" itemprop="url">web性能时间片timeslicing</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-12T10:19:17+08:00">
                2019-12-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-perface"><a href="#1-perface" class="headerlink" title="1. perface"></a>1. perface</h2><p>从用户的输入，再到显示器在视觉上给用户的输出，这一过程如果超过100ms，那么用户会察觉到网页的卡顿，所以为了解决这个问题<br>每个任务不能超过50ms，W3C性能工作组在LongTask规范中也将超过50ms的任务定义为长任务</p>
<h2 id="FPS"><a href="#FPS" class="headerlink" title="FPS"></a>FPS</h2><pre><code>60HZ = 每秒刷新60次

FPS(Frames Per Second) = 60

(1 秒 = 1000 毫秒) / 60 帧 = 16.7 毫秒/帧
</code></pre><p>所以为了避免长任务，一种方案是使用Web Worker，将长任务放在Worker线程中执行，缺点是无法访问DOM，而另一种方案是使用时间切片。</p>
<h2 id="什么是时间切片"><a href="#什么是时间切片" class="headerlink" title="什么是时间切片"></a>什么是时间切片</h2><p>时间切片的核心思想是：如果任务不能在50毫秒内执行完，那么为了不阻塞主线程，这个任务应该让出主线程的控制权，使浏览器可以处理其他任务。<br>让出控制权意味着停止执行当前任务，让浏览器去执行其他任务，随后再回来继续执行没有执行完的任务。  </p>
<p>所以时间切片的目的是不阻塞主线程，而实现目的的技术手段是将一个长任务拆分成很多个不超过50ms的小任务分散在宏任务队列中执行。  </p>
<p>上图可以看到主线程中有一个长任务，这个任务会阻塞主线程。使用时间切片将它切割成很多个小任务后，如下图所示。</p>
<p>可以看到现在的主线程有很多密密麻麻的小任务，我们将它放大后如下图所示。</p>
<p>可以看到每个小任务中间是有空隙的，代表着任务执行了一小段时间后，将让出主线程的控制权，让浏览器执行其他的任务。</p>
<p>使用时间切片的缺点是，任务运行的总时间变长了，这是因为它每处理完一个小任务后，主线程会空闲出来，并且在下一个小任务开始处理之前有一小段延迟。</p>
<p>但是为了避免卡死浏览器，这种取舍是很有必要的。</p>
<p>使用时间切片的缺点是，任务运行的总时间变长了，这是因为它每处理完一个小任务后，主线程会空闲出来，并且在下一个小任务开始处理之前有一小段延迟。</p>
<p>但是为了避免卡死浏览器，这种取舍是很有必要的。</p>
<h2 id="如何使用时间切片"><a href="#如何使用时间切片" class="headerlink" title="如何使用时间切片"></a>如何使用时间切片</h2><pre><code>时间切片是一种概念，也可以理解为一种技术方案，它不是某个API的名字，也不是某个工具的名字。

事实上，时间切片充分利用了“异步”，在早期，可以使用定时器来实现，例如：

btn.onclick = function () {
    someThing(); // 执行了50毫秒
    setTimeout(function () {
        otherThing(); // 执行了50毫秒
    });
};

上面代码当按钮被点击时，本应执行100毫秒的任务现在被拆分成了两个50毫秒的任务。

在实际应用中，我们可以进行一些封装，封装后的使用效果类似下面这样：

btn.onclick = ts([someThing, otherThing], function () {
    console.log(&apos;done~&apos;);
});

当然，关于ts这个函数的API的设计并不是本文的重点，这里想说明的是，在早期可以利用定时器来实现“时间切片”。

ES6带来了迭代器的概念，并提供了生成器Generator函数用来生成迭代器对象，虽然Generator函数最正统的用法是生成迭代器对象，但这不妨我们利用它的特性做一些其他的事情。

Generator函数提供了yield关键字，这个关键字可以让函数暂停执行。然后通过迭代器对象的next方法让函数继续执行。

利用这个特性，我们可以设计出更方便使用的时间切片，例如：

btn.onclick = ts(function* () {
    someThing(); // 执行了50毫秒
    yield;
    otherThing(); // 执行了50毫秒
});

可以看到，我们只需要使用yield这个关键字就可以将本应执行100毫秒的任务拆分成了两个50毫秒的任务。

我们甚至可以将yield关键字放在循环里：

btn.onclick = ts(function* () {
    while (true) {
        someThing(); // 执行了50毫秒
        yield;
    }
});
上面代码我们写了一个死循环，但依然不会阻塞主线程，浏览器也不会卡死
</code></pre><h2 id="基于生成器的ts实现原理"><a href="#基于生成器的ts实现原理" class="headerlink" title="基于生成器的ts实现原理"></a>基于生成器的ts实现原理</h2><p>通过前面的例子，我们会发现基于Generator的时间切片非常好用，但其实ts函数的实现原理非常简单，一个最简单的ts函数只需要九行代码。</p>
<pre><code>function ts (gen) {
if (typeof gen === &apos;function&apos;) gen = gen()
if (!gen || typeof gen.next !== &apos;function&apos;) return
return function next() {
    const res = gen.next()
    if (res.done) return
    setTimeout(next)
}
}
</code></pre><p>代码虽然全部只有9行，关键代码只有3、4行，但这几行代码充分利用了事件循环机制以及Generator函数的特性。  </p>
<p>创造出这样的代码我还是很开心的。  </p>
<p>上面代码核心思想是：通过yield关键字可以将任务暂停执行，从而让出主线程的控制权；通过定时器可以将“未完成的任务”重新放在任务队列中继续执行。</p>
<p>避免把任务分解的过于零碎<br>使用yield来切割任务非常方便，但如果切割的粒度特别细，反而效率不高。假设我们的任务执行100ms，最好的方式是切割成两个执行50ms的任务，<br>而不是切割成100个执行1ms的任务。假设被切割的任务之间的间隔为4ms，那么切割成100个执行1ms的任务的总执行时间为：</p>
<p>(1 + 4) * 100 = 500ms<br>如果切割成两个执行时间为50ms的任务，那么总执行时间为：</p>
<p>(50 + 4) * 2 = 108ms<br>可以看到，在不影响用户体验的情况下，下面的总执行时间要比前面的少了4.6倍。</p>
<p>保证切割的任务刚好接近50ms，可以在用户使用yield时自行评估，也可以在ts函数中根据任务的执行时间判断是否应该一次性执行多个任务。</p>
<p>我们将ts函数稍微改进一下：</p>
<pre><code>function ts (gen) {
if (typeof gen === &apos;function&apos;) gen = gen()
if (!gen || typeof gen.next !== &apos;function&apos;) return
    return function next() {
        const start = performance.now()
        let res = null
        do {
        res = gen.next()
        } while(!res.done &amp;&amp; performance.now() - start &lt; 25);

        if (res.done) return
        setTimeout(next)
    }
}
</code></pre><p>现在我们测试下：</p>
<pre><code>ts(function* () {
const start = performance.now()
while (performance.now() - start &lt; 1000) {
    console.log(11)
    yield
}
console.log(&apos;done!&apos;)
})();
</code></pre><p>这段代码在之前的版本中，在我的电脑上可以打印出 215 次 11，在后面的版本中可以打印出 6300 次 11，说明在总时间相同的情况下，可以执行更多的任务。</p>
<p>再看另一个例子：</p>
<pre><code>ts(function* () {
for (let i = 0; i &lt; 10000; i++) {
    console.log(11)
    yield
}
console.log(&apos;done!&apos;)
})();
</code></pre><p>在我的电脑上，这段代码在之前的版本中，被切割成一万个小任务，总执行时间为 46秒，在之后的版本中，被切割成 52 个小任务，总执行时间为 1.5秒。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2019/12/12/web性能测试优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/12/web性能测试优化/" itemprop="url">web性能测试优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-12T09:44:59+08:00">
                2019-12-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-lighthouse"><a href="#1-lighthouse" class="headerlink" title="1. lighthouse"></a>1. lighthouse</h2><pre><code>npm i -g lighthouse
</code></pre><h2 id="2-FP、FCP、FMP与LCP"><a href="#2-FP、FCP、FMP与LCP" class="headerlink" title="2. FP、FCP、FMP与LCP"></a>2. FP、FCP、FMP与LCP</h2><pre><code>FP（全称“First Paint”，翻译为“首次绘制”） 是时间线上的第一个“时间点”

它代表浏览器第一次向屏幕传输像素的时间，也就是页面在屏幕上首次发生视觉变化的时间

FP不包含默认背景绘制，但包含非默认的背景绘制


FCP（全称“First Contentful Paint”，翻译为“首次内容绘制”）
它代表浏览器第一次向屏幕绘制 “内容”

注意：只有首次绘制文本、图片（包含背景图）、非白色的canvas或SVG时才被算作FCP

FP与FCP这两个指标之间的主要区别是：FP是当浏览器开始绘制内容到屏幕上的时候

只要在视觉上开始发生变化，无论是什么内容触发的视觉变化，在这一刻，这个时间点，叫做FP

相比之下，FCP指的是浏览器首次绘制来自DOM的内容。例如：文本，图片，SVG，canvas元素等，这个时间点叫FCP。

FP和FCP可能是相同的时间，也可能是先FP后FCP
</code></pre><h2 id="FMP"><a href="#FMP" class="headerlink" title="FMP"></a>FMP</h2><pre><code>FMP（全称“First Meaningful Paint”，翻译为“首次有效绘制”） 表示页面的“主要内容”开始出现在屏幕上的时间点。它是我们测量用户加载体验的主要指标。

FMP本质上是通过一个算法来猜测某个时间点可能是FMP，所以有时候不准
</code></pre><h2 id="LCP"><a href="#LCP" class="headerlink" title="LCP"></a>LCP</h2><pre><code>LCP（全称“Largest Contentful Paint”） 表示可视区“内容”最大的可见元素开始出现在屏幕上的时间点
了解和测量网站真实的性能其实非常困难，像load和DOMContentLoaded不会告诉我们用户什么时候可以在屏幕上看到内容
而FP和FCP又只能捕获整个渲染过程的最开始，FMP更好一点，但是它的算法比较复杂，而且前面说了，有时候不准
根据W3C Web性能工作组的讨论和Google的研究，发现测量页面主要内容的可见时间有一种更精准且简单的方法是查看什么时候渲染最大元素
</code></pre><h2 id="TTI"><a href="#TTI" class="headerlink" title="TTI"></a>TTI</h2><pre><code>TTI（全称“Time to Interactive”，翻译为“可交互时间”） 表示网页第一次 完全达到可交互状态 的时间点。可交互状态指的是页面上的UI组件是可以交互的

（可以响应按钮的点击或在文本框输入文字等），不仅如此，此时主线程已经达到“流畅”的程度，主线程的任务均不超过50毫秒。

TTI很重要，因为TTI可以让我们了解我们的产品需要多久可以真正达到“可用”的状态
</code></pre><h2 id="TTFB"><a href="#TTFB" class="headerlink" title="TTFB"></a>TTFB</h2><pre><code>TTFB（全称“Time to First Byte”） 表示浏览器接收第一个字节的时间
</code></pre><h2 id="FCI"><a href="#FCI" class="headerlink" title="FCI"></a>FCI</h2><pre><code>全称“First CPU Idle”） 是对TTI的一种补充，TTI可以告诉我们页面什么时候完全达到可用，但是我们不知道浏览器第一次可以响应用户输入是什么时候。
我们不知道网页的“最小可交互时间”是多少，最小可交互时间是说网页的首屏已经达到了可交互的状态了，但整个页面可能还没达到。
从名字也可以看出这个指标的意思，第一次CPU空闲，主线程空闲就代表可以接收用户的响应了。
更通俗的理解TTI与FCI的区别：FCI代表浏览器真正的第一次可以响应用户的输入，而TTI代表浏览器已经可以持续性的响应用户的输入
</code></pre><h2 id="FID"><a href="#FID" class="headerlink" title="FID"></a>FID</h2><pre><code>全称“First Input Delay”，翻译为“首次输入延迟”） 顾名思义，FID指的是用户首次与产品进行交互时，我们产品可以在多长时间给出反馈
TTI可以告诉我们网页什么时候可以开始流畅地响应用户的交互，但是如果用户在TTI的时间内，没有与网页产生交互，那么TTI其实是影响不到用户的
TTI是不需要用户参与的指标，但如果我们真的想知道TTI对用户的影响，我们需要FID。不同的用户可能会在TTI之前开始与网页产生交互
也可能在TTI之后才与网页产生交互。所以对于不同的用户它的FID是不同的。如果在TTI之前用户就已经与网页产生了交互
那么它的FID时间就比较长，而如果在TTI之后才第一次与网页产生交互，那么他的FID时间就短。

捕获FID比较简单，我们只需要在网页的head标签里注册一个事件（click、mousedown、keydown、touchstart、pointerdown）
然后在事件响应函数中使用当前时间减去事件对象被创建的时间即可

performance.now() - event.timeStamp
</code></pre><h2 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a>DCL</h2><pre><code>DCL 表示DomContentloaded事件触发的时间。
L 表示onLoad事件触发的时间。
DomContentloaded事件与onLoad事件的区别是，浏览器解析HTML这个操作完成后立刻触发DomContentloaded事件
而只有页面所有资源都加载完毕后（比如图片，CSS），才会触发onLoad事件
</code></pre><h2 id="Speed-Index"><a href="#Speed-Index" class="headerlink" title="Speed Index"></a>Speed Index</h2><pre><code>表示显示页面可见部分的平均时间（注意，是真正的可见，用户可以立马看见的，屏幕外的部分不算），数值越小说明速度越快
它主要用于测量页面内容在视觉上填充的速度。通常会使用这个指标来进行性能的比较。比如优化前和优化后
我们的产品与竞品的性能比较等。但是只能用于 粗略 的比较，不同的产品侧重点完全不同
所以还是需要根据自己产品所侧重的方向，并结合其他指标来进行更详细的对比
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2019/12/12/图片懒加载小结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/12/图片懒加载小结/" itemprop="url">图片懒加载小结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-12T09:14:31+08:00">
                2019-12-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-如何判断图片出现在当前视口"><a href="#1-如何判断图片出现在当前视口" class="headerlink" title="1. 如何判断图片出现在当前视口"></a>1. 如何判断图片出现在当前视口</h2><p>监听window.scroll事件  通过clientTop，offsetTop，clientHeight 以及 scrollTop 都是一些元素高度的属性 判断是否出现当前视口</p>
<pre><code>&lt;img data-src=&quot;imgurl.jpg&quot;&gt;
首先设置一个临时属性 data-src，加载时再使用 src 代替 data-src
</code></pre><h2 id="2-如何判断图片出现在了当前视口"><a href="#2-如何判断图片出现在了当前视口" class="headerlink" title="2. 如何判断图片出现在了当前视口"></a>2. 如何判断图片出现在了当前视口</h2><pre><code>Element.getBoundingClientRect() 方法返回元素的大小及其相对于视口的位置

// clientHeight 代表当前视口的高度
img.getBoundingClientRect().top &lt; document.documentElement.clientHeight

监听 window.scroll 事件也优化  通过节流提高性能 一般使用 lodash.throttle 
</code></pre><h2 id="3-如何判断图片出现在了当前视口"><a href="#3-如何判断图片出现在了当前视口" class="headerlink" title="3. 如何判断图片出现在了当前视口"></a>3. 如何判断图片出现在了当前视口</h2><pre><code>最新API IntersectionObserver 能够监听元素是否到了当前视口的事件，一步到位

事件回调的参数是 IntersectionObserverEntry 的集合，代表关于是否在可见视口的一系列值
其中，entry.isIntersecting 代表目标元素可见

const observer = new IntersectionObserver((changes) =&gt; {
// changes: 目标元素集合
changes.forEach((change) =&gt; {
    // intersectionRatio
    if (change.isIntersecting) {
    const img = change.target
    img.src = img.dataset.src
    observer.unobserve(img)
    }
})
})

observer.observe(img);

IntersectionObserver 除了给图片做懒加载外，还可以对单页应用资源做预加载

如在 next.js v9 中，会对视口内的资源做预加载，可以参考 next 9 production optimizations
</code></pre><h2 id="4-loading-”lazy”"><a href="#4-loading-”lazy”" class="headerlink" title="4. loading=”lazy”"></a>4. loading=”lazy”</h2><pre><code>&lt;img src=&quot;celebration.jpg&quot; loading=&quot;lazy&quot; alt=&quot;...&quot; /&gt;
&lt;iframe src=&quot;video-player.html&quot; loading=&quot;lazy&quot;&gt;&lt;/iframe&gt;

lazy还可以用在 iframe
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2019/12/05/js两大基石/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/05/js两大基石/" itemprop="url">js两大基石</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-05T15:22:39+08:00">
                2019-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基石"><a href="#基石" class="headerlink" title="基石"></a>基石</h2><ol>
<li><p>原型继承</p>
<pre><code>对象没有类 原型委托
</code></pre></li>
<li><p>函数式编程</p>
<pre><code>通过lambdas 和 闭包
</code></pre></li>
</ol>
<h2 id="创建对象方法"><a href="#创建对象方法" class="headerlink" title="创建对象方法"></a>创建对象方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj1= &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = <span class="built_in">Object</span>.create(prototype, &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj3 = <span class="built_in">Object</span>.assign()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj4 = <span class="built_in">Object</span>.create()</span><br></pre></td></tr></table></figure>
<h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><pre><code>1. The `new` keyword is used to invoke a constructor. What it actually does is:

2. Create a new instance

3. Bind `this` to the new instance

4. Reference the new object’s delegate [[Prototype]] to the object referenced by the constructor function’s `prototype` property.

5. Reference the new object’s .constructor property to the constructor that was invoked.
Names the object type after the constructor, which you’ll notice mostly in the debugging console. You’ll see `[Object Foo]`, for example, instead of `[Object object]`.

6. Allows `instanceof` to check whether or not an object’s prototype reference is the same object referenced by the .prototype property of the constructor.
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2019/12/04/闭包最终一击/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/04/闭包最终一击/" itemprop="url">闭包最终一击</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-04T14:49:18+08:00">
                2019-12-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="执行上下文"><a href="#执行上下文" class="headerlink" title="执行上下文"></a>执行上下文</h2><pre><code>1. 全局代码  默认环境执行

2. 函数代码  生成一个函数上下文

3. let const花括号  块级作用域
</code></pre><h2 id="函数执行上下文"><a href="#函数执行上下文" class="headerlink" title="函数执行上下文"></a>函数执行上下文</h2><pre><code>1. js执行一个函数 首先创建一个新执行上下文  用于执行函数内部代码的局部上下文

2. 局部上下文会有自己变量集合 同时这些变量对上下文也是局部的

3. 新创建的执行上下文会处在调用栈最顶层

4. 调用栈可以认为是保存程序执行的上下文的机器

如果函数执行中遇到 return 或者 } 就认为函数结束了

函数结束之后会发生下面的步骤:

    1. 函数的局部执行上下文会被从调用栈抛出

    2. 函数将返回值返给调用执行上文

    3. 调用执行上下文也是一个执行上下文只是函数调用者 可能是全局上下文或局部上下文

    4. 调用执行上下文来处理这个返回值

    5. 如果没有返回值 默认是undefined

    6. 局部执行上下文会被销毁

    7. 局部执行上下文的结果是 局部执行上下文中声明局部变量也会被销毁

    8. 这些变量将不会被找到了 这也是为何被称之为 局部变量
</code></pre><h2 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h2><pre><code>1: let a = 3
2: function addTwo(x) {
3:   let ret = x + 2
4:   return ret
5: }
6: let b = addTwo(a)
7: console.log(b)


第一个行 创建全局变量a  并且赋值为3

第2行至第5行 在全局执行上下文中声明一个全局变量 addTwo 
并且一个函数赋值给addTwo

addTwo函数内代码没有被执行

第6行 在全局执行上下文创建一个变量b 值为undefined

这时候遇见一个赋值操作符 准备将一个新值赋给变量b

再进一步是一个函数调用  函数调用如果有return返回值给b 如果没有就是undefined

现在我们看函数addTwo调用中过程

注意javascript函数调用过程的参数 字面量是值传递方式 对象是引用方式传值

在执行函数执行过程第一步先创建新的局部执行上下文 我们起一个addTwo execution contex的名字 这个执行上下文压入到调用栈中 

函数addTwo执行的局部执行上下文创建后第一件事情是 查看函数的参数
在addTwo函数中有一个参数x 并且值为3 

接着addTwo执行上下文会查找var声明变量和函数声明 进行预解析

变量ret用let关键字声明的 所以不会预解析

执行到第3行时候 首先声明了变量ret 并且初始值为undefined 在局部执行上线文中

接着在局部执行上下文中查找变量x 并且查找到了 其值为3

第二个操作数是2  运算之后为5 赋值给变量ret

第4行是返回变量ret 在局部执行上下文查找ret 找到之后 返回其值 5

addTwo函数将5返回之后 addTwo就执行完毕了

函数addTwo执行完毕之后 变量x 和 ret 也会消失 不再存在 

对应创建创建的局部执行上下文也会销毁 同时会被调用栈

addTwo局部执行上下文会将返回值 返给 调用执行上下文

此时调用执行上下文是全局执行上下文 因为addTwo被调用是从全局执行上文中调用的

这是再继续执行就是 将addTwo局部执行上下文的返回值 赋值给变量b
</code></pre><h2 id="词法作用域-lexical-scope"><a href="#词法作用域-lexical-scope" class="headerlink" title="词法作用域 lexical scope"></a>词法作用域 lexical scope</h2><p>理解词法作用域 我们看下面的例子</p>
<pre><code>1: let val1 = 2
2: function multiplyThis(n) {
3:   let ret = n * val1
4:   return ret
5: }
6: let multiplied = multiplyThis(6)
7: console.log(&apos;example of scope:&apos;, multiplied)

在这里主要局部执行上下文中变量和全局执行上下文中变量是如何查找的

如果在局部执行上下文中没有发现的变量 可以在调用执行上下文中继续查找

然后不断向上查找 一直到全局执行上下文

1. 全局执行上下文声明变量x 并赋值2

2. 2-5行声明一个新变量 multiThis 并且赋值一个函数

3. 在全局执行上下文中声明变量multiplied

4. 找到全局执行上下文中变量multiThis 执行这个函数变量 赋值参数为6

5. 函数调用 会 生成一个新执行上下文 并且这是一个局部执行上下文

6. 在局部执行上下文声明一个变量n 并赋值6

7. 声明变量ret 

8. 执行乘法运算 n是局部执行上下文中的变量可以找到 val1在局部执行上下文没有
然后去调用执行上下文继续查找 一直到全局执行上下文

9. multiplyThis执行完毕后 销毁局部执行上下文和局部变量 ret n

10. 将返回值 返回给 调用执行上下文

函数有权访问调用执行上下文中变量的现象叫做 词法作用域 ## 这是原作者的看法
我认为词法作用域 一个函数访问权限取决于函数定义 而不是执行的时候

词法作用域 是根据 函数声明的位置 决定 函数访问父级作用域的现象

而不是函数执行位置来决定
</code></pre><h2 id="函数返回函数"><a href="#函数返回函数" class="headerlink" title="函数返回函数"></a>函数返回函数</h2><pre><code>1: let val = 7
2: function createAdder() {
3:   function addNumbers(a, b) {
4:     let ret = a + b
5:     return ret
6:   }
7:   return addNumbers
8: }
9: let adder = createAdder()
10: let sum = adder(val, 8)
11: console.log(&apos;example of function returning a function: &apos;, sum)

1. 在全局执行上下文中声明变量 val 并且赋值给7

2. 在全局执行上下文中声明一个变量createAdder 并且将一个函数赋值这个变量

3. 第9行 在全局变量声明变量adder 临时赋值undefined给这个变量adder

4. 接着执行函数createAdder 这时候去全局执行上下文寻找变量createAdder 然后调用

5. 函数调用 一个新的局部执行上下文被创建 然后在局部执行上下文创建局部变量 v8将新局部执行上下文压入调用栈

6. 接着是函数声明  创建一个局部变量addNumbers在局部执行上下文中 addNumbers仅存在局部执行上下文中
   addNumbers存储一个函数

7. 第7行返回变量addNumbers存储的值  一个函数可以返回任何 也包含函数 
   createAdder函数执行完毕后 与其对应的执行上下文 也会被从调用栈中移除

8. 第10行中 在全局上下文中创建一个新变量 sum 临时赋值为undefined

...
</code></pre><h2 id="closure"><a href="#closure" class="headerlink" title="closure"></a>closure</h2><pre><code>理解闭包 首先能懂两个概念 词法作用域 和  执行上下文

函数 与对其状态-即词法环境lexical environment的引用共同构成闭包（closure）

也就是说，闭包可以让你从内部函数访问外部函数作用域。

在JavaScript，函数在每次创建时生成闭包

总结 闭包 是 对函数与对其词法作用域的引用

1: function createCounter() {
2:   let counter = 0
3:   const myFunction = function() {
4:     counter = counter + 1
5:     return counter
6:   }
7:   return myFunction
8: }
9: const increment = createCounter()
10: const c1 = increment()
11: const c2 = increment()
12: const c3 = increment()
13: console.log(&apos;example increment&apos;, c1, c2, c3)

1. 全局作用域中创建一个函数变量createCounter

2. 全局作用域中创建一个常量 increment 初始值undefined

3. 执行createCounter函数 创建一个局部执行上下文 返回一个函数给变量increment

4. 在创建新的局部执行上下文中 声明一个新变量counter 赋值0

5. 接着声明一个常量myFunction 并将一个函数赋值给常量myFunction

6. 将常量myFunction的值 一个函数 赋值给 变量increment

7. 同时局部作用域中 myFunction 和 counter 被销毁 // 原作者的idea

8. 第10行 创建一个变量c1  寻找increment函数变量 并执行

9. increment函数执行 会创建一个新局部执行上下文  寻找变量counter 在当前局部执行上下文

10. 在这个局部执行上下文中没有声明任何变量  全局执上下文也没有counter这个变量

11. 这时候该闭包亮相了  闭包中包含变量counter 并且初始值为0

...
</code></pre><h2 id="重要的闭包"><a href="#重要的闭包" class="headerlink" title="重要的闭包"></a>重要的闭包</h2><pre><code>let c = 4
const addX = x =&gt; n =&gt; n + x
const addThree = addX(3)
let d = addThree(c)
console.log(&apos;example partial application&apos;, d)
</code></pre><h2 id="自己总结"><a href="#自己总结" class="headerlink" title="自己总结"></a>自己总结</h2><pre><code>闭包 是词法声明位置的词法作用域和调用作用域共同的引用
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2019/12/04/13-npm-tricks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/04/13-npm-tricks/" itemprop="url">13-npm-tricks</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-04T13:47:10+08:00">
                2019-12-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-基本快捷键"><a href="#1-基本快捷键" class="headerlink" title="1. 基本快捷键"></a>1. 基本快捷键</h2><pre><code>初始化  npm i

测试   npm t

帮助   npm -h 

全局   npm -g

开发依赖  npm -D 

初始化默认 npm init -y / npm init -f 

安装默认是 npm install --save -S 

--no-save
</code></pre><h2 id="2-少用快捷键"><a href="#2-少用快捷键" class="headerlink" title="2. 少用快捷键"></a>2. 少用快捷键</h2><pre><code>可选保存    --save-optional . Shortcut: -O

保存精确版本 --save-exact. Shortcut: -E
</code></pre><h2 id="3-The-Root-Shortcut"><a href="#3-The-Root-Shortcut" class="headerlink" title="3. The Root Shortcut"></a>3. The Root Shortcut</h2><pre><code>package.json main字段保存是 入口文件
</code></pre><h2 id="4-设置npm-init-默认值"><a href="#4-设置npm-init-默认值" class="headerlink" title="4. 设置npm init 默认值"></a>4. 设置npm init 默认值</h2><pre><code>npm config set init.author.name  &quot;Joe Bloggs&quot;
npm config set init.author.email &quot;joebloggs@gmail.com&quot;
npm config set init.author.url   &quot;joebloggs.com&quot;
npm config set init.license      &quot;MIT&quot;

npm config edit

npm config edit    -g
</code></pre><h2 id="5-跨平台兼容的脚本"><a href="#5-跨平台兼容的脚本" class="headerlink" title="5. 跨平台兼容的脚本"></a>5. 跨平台兼容的脚本</h2><pre><code>通过 cross-env 包

npm i -D cross-env

{
    &quot;scripts&quot;: {
        &quot;build&quot;: &quot;cross-env NODE_ENV=production webpack --config build/webpack.config.js&quot;
    }
}

rimraf can be installed globally to run cross-platform scripts
The UNIX command rm -rf for node.

ShellJS is a portable implementation of Unix shell commands on top of the Node.js API
</code></pre><h2 id="6-并行运行脚本"><a href="#6-并行运行脚本" class="headerlink" title="6. 并行运行脚本"></a>6. 并行运行脚本</h2><pre><code>1. &amp;&amp;  

2. concurrently 

3. npm-run-all 

npm i -D concurrently
{
    &quot;start&quot;: &quot;concurrently \&quot;command1 arg\&quot; \&quot;command2 arg\&quot;&quot;
}
</code></pre><h2 id="7-运行脚本在不同文件夹"><a href="#7-运行脚本在不同文件夹" class="headerlink" title="7. 运行脚本在不同文件夹"></a>7. 运行脚本在不同文件夹</h2><pre><code>有时候, 在一个app有多个package.json在不同文件夹中
如果在根目录下访问这些ackage.json中的脚本 而不是通过指定路径的方式
就是很方便 下面这种两种方法可以解决

1. cd folder &amp;&amp; npm start &amp;&amp; cd ..

2. 优雅方式是用 --prefix

    npm start --prefix path/to/your/folder

    如果同时启动前后端文件夹中脚本

    &quot;start&quot;: &quot;concurrently \&quot;(npm start --prefix client)\&quot; \&quot;(npm start --prefix server)\&quot;&quot;
</code></pre><h2 id="8-端口准备完毕后运行脚本"><a href="#8-端口准备完毕后运行脚本" class="headerlink" title="8. 端口准备完毕后运行脚本"></a>8. 端口准备完毕后运行脚本</h2><pre><code>Electron打开页面 等待react工程启动完毕后

&quot;dev&quot;: &quot;concurrently \&quot;cross-env BROWSER=none npm run start\&quot; \&quot;wait-on http://localhost:3000 &amp;&amp; electron .\&quot;&quot;

另外，React默认会打开一个浏览器窗口，但是对于Electron子开发而言，这是不必要的。 我们可以通过传递环境变量BROWSER=none来禁用此行为，该变量前面带有cross-env以实现跨平台兼容性
</code></pre><h2 id="9-列出并选择可选的脚本"><a href="#9-列出并选择可选的脚本" class="headerlink" title="9. 列出并选择可选的脚本"></a>9. 列出并选择可选的脚本</h2><pre><code>安装 npm i -g ntl

ntl 会列出package.json中的脚本
</code></pre><h2 id="10-Run-Pre-and-Post-Scripts"><a href="#10-Run-Pre-and-Post-Scripts" class="headerlink" title="10. Run Pre and Post Scripts"></a>10. Run Pre and Post Scripts</h2><pre><code>prebuild and postbuildwhich allow you to define code to run either before or after your build script

in fact pre and post can be added before any script, including custom ones
</code></pre><h2 id="11-Control-Your-App’s-Version"><a href="#11-Control-Your-App’s-Version" class="headerlink" title="11. Control Your App’s Version"></a>11. Control Your App’s Version</h2><pre><code>npm version plus major , minor or patch

// 1.0.0 当前版本

npm version patch
// 1.0.1

npm version minor
// 1.1.0

npm version major
// 2.0.0

{
    &quot;predeploy&quot;: &quot;npm version patch&quot;
}
</code></pre><h2 id="12-Edit-package-json-from-the-Command-Line"><a href="#12-Edit-package-json-from-the-Command-Line" class="headerlink" title="12. Edit package.json from the Command Line"></a>12. Edit package.json from the Command Line</h2><pre><code>npm install -g json

json -I -f package.json -e &apos;this.scripts.foo=&quot;bar&quot;&apos;
</code></pre><h2 id="13-Set-and-Open-Your-Repository-Automatically"><a href="#13-Set-and-Open-Your-Repository-Automatically" class="headerlink" title="13. Set and Open Your Repository Automatically"></a>13. Set and Open Your Repository Automatically</h2><pre><code>获取远程仓库地址

    git config --get remote.origin.url

package.json中添加仓库地址

json -I -f package.json -e &quot;this.repository=\&quot;$(git config --get remote.origin.url)\&quot;&quot;
</code></pre><h2 id="13-Create-a-Custom-npm-init-Script"><a href="#13-Create-a-Custom-npm-init-Script" class="headerlink" title="13. Create a Custom npm init Script"></a>13. Create a Custom npm init Script</h2><pre><code>npm config set init-module ~\.npm-init.js

.npm-init.js

    module.exports = {
        name: prompt(&apos;package name&apos;, basename || package.name),
        version: prompt(&apos;version&apos;, &apos;0.0.0&apos;),
        decription: prompt(&apos;description&apos;, &apos;&apos;),  
        main: prompt(&apos;entry point&apos;, &apos;index.js&apos;),
        repository: prompt(&apos;git repository&apos;, &apos;&apos;),
        keywords: prompt(function (s) { return s.split(/\s+/) }),
        author: prompt(&apos;author&apos;, &apos;Joe Bloggs &lt;joe.bloggs@gmail.com&gt; (joebloggs.com)&apos;),
        license: prompt(&apos;license&apos;, &apos;ISC&apos;)
    }
</code></pre><h2 id="14-Push-Your-First-Commit-to-GitHub-with-a-Custom-npm-init-Script"><a href="#14-Push-Your-First-Commit-to-GitHub-with-a-Custom-npm-init-Script" class="headerlink" title="14. Push Your First Commit to GitHub with a Custom npm init Script"></a>14. Push Your First Commit to GitHub with a Custom npm init Script</h2><pre><code>const { execSync } = require(&apos;child_process&apos;);

function run(func) {
    console.log(execSync(func).toString())
}

repository: prompt(&apos;github repository url&apos;, &apos;&apos;, function (url) {
    if (url) {
        run(&apos;touch README.md&apos;);
        run(&apos;git init&apos;);
        run(&apos;git add README.md&apos;);
        run(&apos;git commit -m &quot;first commit&quot;&apos;);
        run(`git remote add origin ${url}`);
        run(&apos;git push -u origin master&apos;);
    }
    return url;
})
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">killsos.ql@gmail.com</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">52</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">killsos.ql@gmail.com</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
