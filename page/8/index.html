<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="keywords" content="javascript 前端">
<meta property="og:type" content="website">
<meta property="og:title" content="killsos">
<meta property="og:url" content="http://jsonload.com/page/8/index.html">
<meta property="og:site_name" content="killsos">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="killsos">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jsonload.com/page/8/">





  <title>killsos</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">killsos</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人情似水分高下 世事如云任卷舒</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/13/DOM变化的监听检测/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/13/DOM变化的监听检测/" itemprop="url">DOM变化的监听检测</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-13T08:48:09+08:00">
                2020-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-自定义元素声明周期与DOM变化检测"><a href="#1-自定义元素声明周期与DOM变化检测" class="headerlink" title="1. 自定义元素声明周期与DOM变化检测"></a>1. 自定义元素声明周期与DOM变化检测</h2><p>使用ES6的基础创建自定义元素（Custom Elements）的时候，是可以使用其内置的生命周期，对DOM变化进行实时更新的  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTMLEllElement</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 指定观察的属性，这样attributeChangedCallback才会起作用</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">get</span> observedAttributes() &#123; <span class="keyword">return</span> [<span class="string">'rows'</span>]; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下面4个方法为常用生命周期</span></span><br><span class="line">  connectedCallback() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'自定义元素加入页面'</span>);</span><br><span class="line">    <span class="comment">// 执行渲染更新</span></span><br><span class="line">    <span class="keyword">this</span>._updateRendering();</span><br><span class="line">  &#125;</span><br><span class="line">  disconnectedCallback() &#123;</span><br><span class="line">    <span class="comment">// 本例子该生命周期未使用，占位示意</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'自定义元素从页面移除'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  adoptedCallback() &#123;</span><br><span class="line">    <span class="comment">// 本例子该生命周期未使用，占位示意</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'自定义元素转移到新页面'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  attributeChangedCallback(name, oldValue, newValue) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'自定义元素属性发生变化'</span>);</span><br><span class="line">    <span class="keyword">this</span>._rows = newValue;</span><br><span class="line">    <span class="comment">// 执行渲染更新</span></span><br><span class="line">    <span class="keyword">this</span>._updateRendering();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 设置直接get/set rows属性的方法</span></span><br><span class="line">  <span class="keyword">get</span> rows() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._rows;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> rows(v) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setAttribute(<span class="string">'rows'</span>, v);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _updateRendering() &#123;</span><br><span class="line">    <span class="comment">// 根据变化的属性，改变组件的UI</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义x-ell标签元素为多行打点元素</span></span><br><span class="line">customElements.define(<span class="string">'x-ell'</span>, HTMLEllElement);</span><br><span class="line"></span><br><span class="line">&lt;x-ell rows=<span class="string">"2"</span>&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>connectedCallback<br>每次自定义元素连接到文档中的时候会触发。每次移动节点时也会发生，并且可能在元素的内容完全解析之前发生。<br>注意，元素如果和文档失去连接也可能触发connectedCallback，所以最好先使用Node.isConnected（IE不支持）确认下。  </p>
</li>
<li><p>disconnectedCallback<br>每次自定义元素和文档连接中断的时候触发。  </p>
</li>
</ul>
<ul>
<li><p>adoptedCallback<br>每次自定义元素移动到新的文档时候触发。  </p>
</li>
<li><p>attributeChangedCallback  </p>
</li>
</ul>
<p>每次自定义元素的属性增删改的时候会触发，不过需要先在在静态get observedAttributes方法中指定要注意更改的属性。<br>例如上面的案例就是在observedAttributes静态方法中返回了[‘rows’]，</p>
<p>于是当rows属性发生变化时候会触发attributeChangedCallback这个生命周期</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">x-ell &#123;</span><br><span class="line">  display: block;</span><br><span class="line">  width: <span class="number">200</span>px;</span><br><span class="line">&#125;</span><br><span class="line">HTML代码：</span><br><span class="line">&lt;x-ell rows=<span class="string">"2"</span>&gt;对于现代浏览器，例如webkit内核的浏...组合如下。&lt;<span class="regexp">/x-ell&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;&lt;button onClick="document.querySelector('x-ell').rows = '3';"&gt;点击设置rows为3&lt;/</span>button&gt;&lt;/p&gt;</span><br><span class="line">JS代码：</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTMLEllElement</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 指定观察的属性，这样attributeChangedCallback才会起作用</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">get</span> observedAttributes() &#123; <span class="keyword">return</span> [<span class="string">'rows'</span>]; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// constructor中首先第一件事情就是调用 super</span></span><br><span class="line">    <span class="comment">// super指代了整个prototype或者__proto__指向的对象</span></span><br><span class="line">    <span class="comment">// 这一步免不了的</span></span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建shadow元素，实际上，从本例要实现的效果讲，</span></span><br><span class="line">    <span class="comment">// 直接元素上设置也可以，就是HTML丑了点，CSS要放在外部</span></span><br><span class="line">    <span class="comment">// 且目前火狐并不支持shadow dom可以不用</span></span><br><span class="line">    <span class="keyword">var</span> shadow = <span class="keyword">this</span>.attachShadow(&#123;</span><br><span class="line">        <span class="comment">// open外部可访问（通过element.shadowRoot），closed则不能</span></span><br><span class="line">        mode: <span class="string">'open'</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文本内容移动到shadow dom元素中</span></span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">    div.innerHTML = <span class="keyword">this</span>.innerHTML;</span><br><span class="line">    <span class="keyword">this</span>.innerHTML = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> style = <span class="built_in">document</span>.createElement(<span class="string">'style'</span>);</span><br><span class="line">    shadow.appendChild(style);</span><br><span class="line">    shadow.appendChild(div);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下面4个方法为常用生命周期</span></span><br><span class="line">  connectedCallback() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'自定义元素加入页面'</span>);</span><br><span class="line">    <span class="comment">// 执行渲染更新</span></span><br><span class="line">    <span class="keyword">this</span>._updateRendering();</span><br><span class="line">  &#125;</span><br><span class="line">  disconnectedCallback() &#123;</span><br><span class="line">    <span class="comment">// 本例子该生命周期未使用，占位示意</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'自定义元素从页面移除'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  adoptedCallback() &#123;</span><br><span class="line">    <span class="comment">// 本例子该生命周期未使用，占位示意</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'自定义元素转移到新页面'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  attributeChangedCallback(name, oldValue, newValue) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'自定义元素属性发生变化'</span>);</span><br><span class="line">    <span class="keyword">this</span>._rows = newValue;</span><br><span class="line">    <span class="comment">// 执行渲染更新</span></span><br><span class="line">    <span class="keyword">this</span>._updateRendering();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> rows() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._rows;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> rows(v) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setAttribute(<span class="string">'rows'</span>, v);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _updateRendering() &#123;</span><br><span class="line">    <span class="comment">// 根据变化的属性，改变组件的UI</span></span><br><span class="line">    <span class="keyword">var</span> shadow = <span class="keyword">this</span>.shadowRoot;</span><br><span class="line">    <span class="keyword">var</span> childNodes = shadow.childNodes;</span><br><span class="line">    <span class="keyword">var</span> rows = <span class="keyword">this</span>._rows;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; childNodes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (childNodes[i].nodeName === <span class="string">'STYLE'</span>) &#123;</span><br><span class="line">        childNodes[i].textContent = <span class="string">`div &#123;</span></span><br><span class="line"><span class="string">          display: -webkit-box;</span></span><br><span class="line"><span class="string">          -webkit-line-clamp: <span class="subst">$&#123;rows&#125;</span>;</span></span><br><span class="line"><span class="string">          -webkit-box-orient: vertical;</span></span><br><span class="line"><span class="string">          overflow: hidden;</span></span><br><span class="line"><span class="string">        &#125;`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义x-ell标签元素为多行打点元素</span></span><br><span class="line">customElements.define(<span class="string">'x-ell'</span>, HTMLEllElement);</span><br></pre></td></tr></table></figure>
<h2 id="2-MutationObserver与DOM变化检测"><a href="#2-MutationObserver与DOM变化检测" class="headerlink" title="2. MutationObserver与DOM变化检测"></a>2. MutationObserver与DOM变化检测</h2><p>Custom Elements自定义元素IE并不支持，如果我们想要兼容到IE11浏览器的话，<br>需要求助其他方法，则使用MutationObserver   </p>
<p>Mutation Observer是在DOM level 4中定义的新API  </p>
<p>该API执行逻辑是先观察，再执行，是一个异步的过程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[].slice.call(<span class="built_in">document</span>.querySelectorAll(<span class="string">'x-ell'</span>)).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">ell</span>) </span>&#123;</span><br><span class="line">    ell.render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> rows = <span class="keyword">this</span>.rows;</span><br><span class="line">        <span class="comment">// 基于rows打点实现……</span></span><br><span class="line">        <span class="comment">// 这里代码不是本文重点，略！有兴趣可以参阅demo页面</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新定义rows属性</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(ell, <span class="string">'rows'</span>, &#123;</span><br><span class="line">        writeable: <span class="literal">true</span>,</span><br><span class="line">        enumerable: <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">get</span>: function () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.getAttribute(<span class="string">'rows'</span>);    </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span>: function (rows) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setAttribute(<span class="string">'rows'</span>, rows);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打点显示</span></span><br><span class="line">    ell.render();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造观察ell元素的实例</span></span><br><span class="line">    <span class="keyword">var</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span> (<span class="params">mutationsList</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// mutationsList参数是个MutationRecord对象数组，描述了每个发生的变化</span></span><br><span class="line">        mutationsList.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">mutation</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> target = mutation.target;</span><br><span class="line">            <span class="keyword">if</span> (!target || !target.render) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 变化的类型</span></span><br><span class="line">            <span class="keyword">switch</span>(mutation.type) &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">'characterData'</span>:</span><br><span class="line">                <span class="comment">// 文本内容变化</span></span><br><span class="line">                target.render();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">'attributes'</span>:</span><br><span class="line">                <span class="comment">// rows属性值发生了变化</span></span><br><span class="line">                target.render();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始观察ell元素并制定观察内容</span></span><br><span class="line">    observer.observe(ell, &#123;</span><br><span class="line">        attributes: <span class="literal">true</span>,</span><br><span class="line">        subtree: <span class="literal">true</span>,</span><br><span class="line">        characterData: <span class="literal">true</span>,</span><br><span class="line">        attributeFilter: [<span class="string">'rows'</span>]    </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>observer.observe(node, options)  </p>
<p>node指观察的节点</p>
<p>options是一个MutationObserverInit对象，属性值、类型以及描述</p>
<p>属性    类型    描述<br>childList    Boolean    观察子节点的变动<br>attributes    Boolean    观察属性的变动<br>characterData    Boolean    观察节点内容或节点文本的变动<br>subtree    Boolean    观察所有后代节点的变动<br>attributeOldValue    Boolean    当观察到attributes变动时，是否记录变动前的属性值<br>characterDataOldValue    Boolean    当观察到characterData变动时，是否记录变动前的属性值  文本内容变化<br>attributeFilter    Array    指定需要观察的特定属性（比如[‘src’, ‘rows’]），不在此数组中的属性变化时将被忽略  </p>
<p>new MutationObserver(callback)</p>
<p>new MutationObserver(function (mutationsList, mutationObserver) {})<br>其中，mutationsList是一个MutationRecord对象数组，mutationObserver就是返回的MutationObserver实例本身，</p>
<p>可以用来清空MutationRecord或者中断观察，不过实际开发用到的不多</p>
<p>MutationRecord对象<br>mutationsList是一个MutationRecord对象数组，包含所有观察的数据  </p>
<p>我们可以使用forEach遍历mutationsList，例如：   </p>
<p>mutationsList.forEach(function(mutation) {<br>    // 此时mutation就是一个MutationRecord对象<br>});</p>
<p>属性    类型    描述<br>type    String    根据变动类型的不同，值可能为attributes，characterData或者childList<br>target    Node    发生变动的DOM节点，可能是删除节点的父元素<br>addedNodes    NodeList    被添加的节点，如果没有则是null<br>removedNodes    NodeList    被删除的节点，如果没有则是null<br>previousSibling    Node    被添加或被删除的节点的前一个兄弟节点，如果没有则是null<br>nextSibling    Node    被添加或被删除的节点的后一个兄弟节点，如果没有则是null<br>attributeName    String    发生变更的属性的名称，如果没有则是null<br>attributeNamespace    String    发生变更的属性的命名空间，在SVG元素操作时比较有用，如果没有则是null<br>oldValue    String    如果type为attributes，则返回该属性变化之前的属性值；<br>如果type为characterData，则返回该节点变化之前的文本数据；如果type为childList，则返回null  </p>
<p>MutationObserver实例的其他方法<br>var observer = new MutationObserver(callback)</p>
<p>observer.observe(node, options)</p>
<p>observer.takeRecords()</p>
<p>返回观察者回调函数检测到但尚未处理的所有匹配的DOM更改的列表，使变化队列为空<br>最常见的使用情况是在断开观察者连接之前立即获取所有挂起的变化记录，以便在停止观察者时处理任何挂起的变化</p>
<p>observer.disconnect()</p>
<p>MutationObserver性能要更高。Mutation Events是同步执行的，它的每次调用，  </p>
<p>都需要从事件队列中取出事件，执行，然后事件队列中移除，期间需要移动队列元素。  </p>
<p>如果事件触发的较为频繁的话，每一次都需要执行上面的这些步骤，那么浏览器会被拖慢。   </p>
<p>而MutationObserver所有监听操作以及相应处理都是在其他脚本执行完成之后异步执行的，  </p>
<p>并且是所以变动触发之后，将变得记录在数组中，统一进行回调的，也就是说，  </p>
<p>当你使用observer监听多个DOM变化时，并且这若干个DOM发生了变化，  </p>
<p>那么observer会将变化记录到变化数组中，等待一起都结束了，  </p>
<p>然后一次性的从变化数组中执行其对应的回调函数。</p>
<p>因此，如果你的浏览器不需要兼容IE9，IE10浏览器，推荐使用MutationObserver实现DOM变化的检测  </p>
<h2 id="3-Mutation-events与DOM变化检测"><a href="#3-Mutation-events与DOM变化检测" class="headerlink" title="3. Mutation events与DOM变化检测"></a>3. Mutation events与DOM变化检测</h2><p>如果你的项目需要兼容IE9，IE10浏览器，同时想要实现对DOM变化的检测，则可以试试Mutation events   </p>
<p>DOMAttrModified   Chrome/Safari不支持<br>DOMAttributeNameChanged<br>DOMCharacterDataModified<br>DOMElementNameChanged<br>DOMNodeInserted<br>DOMNodeInsertedIntoDocument   IE不支持<br>DOMNodeRemoved<br>DOMNodeRemovedFromDocument   IE不支持<br>DOMSubtreeModified  </p>
<p>DOMAttrModified    DOM属性发生修改<br>DOMAttributeNameChanged    DOM属性名发生变化<br>DOMCharacterDataModified    DOM文本数据发生修改<br>DOMElementNameChanged    DOM元素名发生变化<br>DOMNodeInserted    DOM节点插入<br>DOMNodeRemoved    DOM节点删除<br>DOMSubtreeModified    DOM子元素修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">element.addEventListener(<span class="string">"DOMNodeInserted"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// event.target就是依次插入的DOM节点</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">[].slice.call(<span class="built_in">document</span>.querySelectorAll(<span class="string">'x-ell'</span>)).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">ell</span>) </span>&#123;</span><br><span class="line">    ell.render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> rows = <span class="keyword">this</span>.rows;</span><br><span class="line">        <span class="comment">// 基于rows打点实现……</span></span><br><span class="line">        <span class="comment">// 这里代码不是本文重点，略！有兴趣可以参阅demo页面</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新定义rows属性</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(ell, <span class="string">'rows'</span>, &#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打点显示</span></span><br><span class="line">    ell.render();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始观察ell元素</span></span><br><span class="line">    ell.addEventListener(<span class="string">'DOMCharacterDataModified'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.render();    </span><br><span class="line">    &#125;);</span><br><span class="line">    ell.addEventListener(<span class="string">'DOMAttrModified'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.render();    </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果我们想要检测到DOM元素尺寸变化，在过去是没有专门的API的，多借助window对象上绑定resize事件  </p>
<p>但是DOM元素的尺寸变化，有时候窗体的尺寸没有变化也会触发。还有的时候窗体的尺寸变化了，  </p>
<p>但是DOM元素的尺寸并没有变化，window对象上绑定的resize事件就有些浪费</p>
<h2 id="4-ResizeObserver"><a href="#4-ResizeObserver" class="headerlink" title="4. ResizeObserver"></a>4. ResizeObserver</h2><p>专门用来观察DOM元素的尺寸是否发生了变化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ro = <span class="keyword">new</span> ResizeObserver( <span class="function"><span class="params">entries</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">    <span class="keyword">const</span> cr = entry.contentRect;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Element:'</span>, entry.target);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Element size: <span class="subst">$&#123;cr.width&#125;</span>px x <span class="subst">$&#123;cr.height&#125;</span>px`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Element padding: <span class="subst">$&#123;cr.top&#125;</span>px ; <span class="subst">$&#123;cr.left&#125;</span>px`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察一个或多个元素</span></span><br><span class="line">ro.observe(ele);</span><br></pre></td></tr></table></figure>
<p>contentRect指的是什么？   </p>
<p>entry.contentRect返回的是一个DOMRect对象，例如的属性包括：</p>
<p>{<br>    x: 0<br>    y: 0<br>    width: 296<br>    height: 100<br>    top: 0<br>    right: 296<br>    bottom: 100<br>    left: 0<br>}</p>
<p>这表明contentRect返回是content box，也就是内容区域的尺寸  </p>
<p><img src="../images/content-box.png" alt="content box"></p>
<p>同时也从侧面说明了，如果一个元素的content box的尺寸没有发生变化，  </p>
<p>那么也是不会触发ResizeObserver观察执行的，哪怕你改变了元素的padding值，  </p>
<p>或者改变了元素的border-width边框尺寸，都不会认为是DOM元素尺寸变化了   </p>
<p>例如：</p>
<p>div {<br>    width: 200px; height:100px;<br>}  </p>
<p>则上面这个div元素设置padding:10px，是没有不会触发ResizeObserver执行的   </p>
<p>Firefox中另外两个对象<br>Firefox浏览器中，entry还包括下面两个属性值，borderBoxSize对象和contentBoxSize对象。</p>
<p>entry.borderBoxSize<br>entry.contentBoxSize<br>都返回ResizeObserverSize对象，该对象展开为：    </p>
<p> {<br>    inlineSize: 271,<br>    blockSize: 41<br>}<br>其中inlineSize表示内联元素排列方向上的尺寸，等同于CSS逻辑属性inline-size，   </p>
<p>在默认文档流下表示宽度；blockSize表示块级元素排列方向上的尺寸，block</p>
<p>等同于CSS逻辑属性block-size，在默认文档流下表示高度   </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/05/JavaScript-Error-Objects/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/JavaScript-Error-Objects/" itemprop="url">JavaScript Error Objects</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-05T16:44:11+08:00">
                2020-03-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Error-Object"><a href="#Error-Object" class="headerlink" title="Error Object"></a>Error Object</h2><p>6种Error</p>
<p>  EvalError, RangeError, ReferenceError, TypeError, SyntaxError, URIError  </p>
<p>  These all error types are inherited from Object -&gt; Error -&gt; RangeError   </p>
<ol>
<li><p>属性</p>
<p>name  message  stack</p>
</li>
</ol>
<p>a. Generic Error</p>
<p>try{<br>    throw new Error(‘Some Error Occurred!’)<br>}<br>catch(e){<br>    console.error(‘Error Occurred. ‘ + e.name + ‘: ‘ + e.message)<br>}</p>
<p>b. Handling Specific Error Types</p>
<p>try{<br>    someFunction()<br>}<br>catch(e){<br>    if(e instanceof EvalError) {<br>    console.error(e.name + ‘: ‘ + e.message)<br>  }<br>  else if(e instanceof RangeError) {<br>    console.error(e.name + ‘: ‘ + e.message)<br>  }<br>  // … something else<br>}</p>
<p>c. Custom Error Types</p>
<p>class CustomError extends Error {<br>    constructor(description, …params) {</p>
<p>// Passing arguments (including vendor specific ones) to parent constructor<br>    super(…params)</p>
<p>// Maintains proper error stack trace(available only on JS V8 engine)<br>    if(Error.captureStackTrace){<br>      Error.captureStackTrace(this, CustomError)<br>    }</p>
<p>this.name = ‘CustomError_MyError’<br>    // Custom debugging information<br>    this.description = description<br>    this.date = new Date()<br>  }<br>}</p>
<p>try{<br>  throw new CustomError(‘Custom Error’, ‘Some Error Occurred’)<br>}<br>catch(e){<br>  console.error(e.name)           //CustomError_MyError<br>  console.error(e.description)    //Custom Error<br>  console.error(e.message)        //Some Error Occurred<br>  console.error(e.stack)          //stacktrace<br>}</p>
<ol>
<li>EvalError</li>
</ol>
<p>It indicates an error in the global function eval() has occured.</p>
<p>new EvalError([message[, fileName[, lineNumber]]])</p>
<p>try{<br>  throw new EvalError(‘Eval Error Occurred’);<br>}<br>catch(e){<br>  console.log(e instanceof EvalError); // true<br>  console.log(e.message);    // “Eval Error Occurred”<br>  console.log(e.name);       // “EvalError”<br>  console.log(e.stack);      // “EvalError: Eval Error Occurred…”<br>}</p>
<ol start="2">
<li>RangeError</li>
</ol>
<p>we pass a value that is not an allowed string, as per<br>String.prototype.normalize()<br>String.prototype.normalize(“-1”)</p>
<p>Using Array constructor to create an array of illegal length<br>// RangeError: Invalid array length<br>var arr = new Array(-1);</p>
<p>Numeric methods like</p>
<p>Number.prototype.toExponential(),</p>
<p>Number.prototype.toFixed(), or</p>
<p>Number.prototype.toPrecision() receive invalid values.</p>
<ol start="3">
<li>ReferenceError</li>
</ol>
<p>当我们尝试取消引用无效的引用或引用不存在的变量时，它指示错误。</p>
<ol start="4">
<li>SyntaxError</li>
</ol>
<ol start="5">
<li><p>TypeError</p>
</li>
<li><p>URIError<br>It occurs when global URI handling function was not being used in the correct way.</p>
</li>
</ol>
<p>encodeURIComponent() or decodeURIComponent() functions.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/05/代码中命名/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/代码中命名/" itemprop="url">代码中命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-05T14:42:33+08:00">
                2020-03-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-Intention-Revealing-Names"><a href="#1-Intention-Revealing-Names" class="headerlink" title="1. Intention Revealing Names"></a>1. Intention Revealing Names</h2><p>名字揭示目的  见名知意</p>
<h2 id="2-avoid-Misleading-Names"><a href="#2-avoid-Misleading-Names" class="headerlink" title="2. avoid Misleading Names"></a>2. avoid Misleading Names</h2><p>避免误导性名称</p>
<h2 id="3-Meaning-Distinctions"><a href="#3-Meaning-Distinctions" class="headerlink" title="3. Meaning Distinctions"></a>3. Meaning Distinctions</h2><p>意义的区别</p>
<h2 id="3-Pronounceable-Names"><a href="#3-Pronounceable-Names" class="headerlink" title="3. Pronounceable Names"></a>3. Pronounceable Names</h2><h2 id="4-Searchable-Names"><a href="#4-Searchable-Names" class="headerlink" title="4. Searchable Names"></a>4. Searchable Names</h2><h2 id="5-Stick-to-Plain-English-Letters-and-Digits"><a href="#5-Stick-to-Plain-English-Letters-and-Digits" class="headerlink" title="5. Stick to Plain English Letters and Digits"></a>5. Stick to Plain English Letters and Digits</h2><p>坚持使用简单的英文字母和数字</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/05/Deep-dive-into-ES6-Symbols/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/Deep-dive-into-ES6-Symbols/" itemprop="url">Deep dive into ES6 Symbols</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-05T11:03:34+08:00">
                2020-03-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Symbol-类型"><a href="#Symbol-类型" class="headerlink" title="Symbol 类型"></a>Symbol 类型</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="string">'symbol'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Symbol</span>() == <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="comment">// False</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Symbol</span>(<span class="string">'abacaba'</span>) == <span class="built_in">Symbol</span>(<span class="string">'abacaba'</span>)</span><br><span class="line"><span class="comment">// False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// But</span></span><br><span class="line"><span class="keyword">const</span> s = <span class="built_in">Symbol</span>(<span class="string">'sym'</span>);</span><br><span class="line">s == s</span><br><span class="line"><span class="comment">// True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sym1 = <span class="built_in">Symbol</span>.for(<span class="string">'some-key'</span>); <span class="comment">// Symbol is created in global registry</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Elsewhere in project:</span></span><br><span class="line"><span class="keyword">const</span> sym2 = <span class="built_in">Symbol</span>.for(<span class="string">'some-key'</span>); <span class="comment">// Symbol is retrieved from global registry</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// They are the same symbol:</span></span><br><span class="line"><span class="built_in">console</span>.log(sym1 === sym2); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You can even access the key property:</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Symbol</span>.keyFor(sym1)); <span class="comment">// some-key</span></span><br></pre></td></tr></table></figure>
<p>symbol 是 基本数据类型   </p>
<p>Symbol() 是构造函数</p>
<p>提出symbol的目的就是返回一个唯一值</p>
<p>Symbnol.for(‘key’)<br>全局注册</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">Symbol</span>.prototype.for = <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Safely getting the global registry</span></span><br><span class="line">  <span class="keyword">const</span> symbolRegistry = <span class="built_in">window</span>.symbolRegistry || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Checking if this symbol exists</span></span><br><span class="line">  <span class="keyword">if</span> (symbolRegisty.hasOwnProperty(key)) &#123;</span><br><span class="line">    <span class="keyword">return</span> symbolRegistry[key];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// It does not, creating a new one</span></span><br><span class="line">  <span class="keyword">const</span> newSymbol = <span class="built_in">Symbol</span>();</span><br><span class="line">  symbolRegistry[key] = newSymbol;</span><br><span class="line">  <span class="built_in">window</span>.symbolRegistry = symbolRegistry;</span><br><span class="line">  <span class="keyword">return</span> newSymbol;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>symbol绝大多数时候用来作为一个对象的属性<br>相对于一般属性优点在于不被枚举 例如 for..of<br>可以方便元编程和定义内部或者隐藏的对象方法</p>
<p>元编程的特色 例如可迭代对象 Symbol.iterator<br>有些对象可以转为原始类型 例如字符串 数字<br>那是因为有一个Symbol.toPrimitive函数来完成</p>
<p>ToPrimitive 算法在执行时，会被传递一个参数 hint，<br>表示这是一个什么类型的运算（也可以叫运算的期望值），<br>根据这个 hint 参数，ToPrimitive 算法来决定内部的执行逻辑。</p>
<p>hint 参数的取值只能是下列 3 者之一：</p>
<p>  string<br>  number<br>  default</p>
<p>转换算法</p>
<p>当对象发生到基本类型值的转换时，会按照下面的逻辑调用对象上的方法：</p>
<p>1. 如果存在，调用 obj<a href="hint">Symbol.toPrimitive</a>；</p>
<p>2. 否则，如果 hint 取值是 “string”：</p>
<pre><code>无论是否存在，调用 obj.toString() 和 obj.valueOf()
</code></pre><p>3.  否则（也就是 hint 取值是 “number” 或 “default” 的情况）：</p>
<pre><code>无论是否存在，调用 obj.valueOf() 和 obj.toString()
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> Person = &#123;</span><br><span class="line">  name: <span class="string">"John"</span>,</span><br><span class="line">  age: <span class="number">10</span>,</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`hint: <span class="subst">$&#123;hint&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(Person) <span class="comment">// hint: string</span></span><br><span class="line">+Person <span class="comment">// hint: number</span></span><br><span class="line">Person + <span class="number">500</span> <span class="comment">// hint: default</span></span><br></pre></td></tr></table></figure>
<p>Symbol.toPrimitive 和 toString/valueOf 方法</p>
<p>  并不要求 Symbol.toPrimitive 和 toString/valueOf 方法必须返回 hint 参数值所暗示的类型值</p>
<p>但要注意下面两点：</p>
<p>  Symbol.toPrimitive 和 toString 方法的返回值必须是基本类型值</p>
<p>  valueOf 方法除了可以返回基本类型值，也可以返回其他类型值</p>
<p>// Iteration symbols<br>Symbol.iterator<br>Symbol.asyncIterator</p>
<p>Symbol.asyncIterator 符号指定了一个对象的默认异步迭代器。如果一个对象设置了这个属性，它就是异步可迭代对象，可用于for await…of循环。</p>
<p>// RegEx symbols<br>Symbol.match<br>Symbol.matchAll<br>Symbol.replace<br>Symbol.search<br>Symbol.split</p>
<p>// Other symbols<br>Symbol.hasInstance</p>
<p>Symbol.hasInstance用于判断某对象是否为某构造器的实例。因此你可以用它自定义 instanceof 操作符在某个类上的行为</p>
<p>Symbol.hasInstance 属性的属性<br>writable        false<br>enumerable      false<br>configurable     false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyArray</span> </span>&#123;  </span><br><span class="line">  <span class="keyword">static</span> [<span class="built_in">Symbol</span>.hasInstance](instance) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>.isArray(instance);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([] <span class="keyword">instanceof</span> MyArray); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>Symbol.isConcatSpreadable</p>
<p>  内置的Symbol.isConcatSpreadable符号用于配置某对象作为Array.prototype.concat()方法的参数时是否展开其数组元素。</p>
<p>Symbol.unscopables</p>
<p>  Symbol.unscopables 指用于指定对象值，其对象自身和继承的从关联对象的 with 环境绑定中排除的属性名称</p>
<p>Symbol.species</p>
<p>  Symbol.species 是个函数值属性，其被构造函数用以创建派生对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Array1</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">get</span> [Symbol.species]() &#123; <span class="keyword">return</span> <span class="built_in">Array</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Symbol.toPrimitive</p>
<p>  是作为对象的函数值属性存在的，当一个对象转换为对应的原始值时，会调用此函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> object1 = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">    <span class="keyword">if</span> (hint == <span class="string">'number'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Symbol.toStringTag</p>
<p>  Symbol.toStringTag 是一个内置 symbol，它通常作为对象的属性键使用，对应的属性值应该为字符串类型<br>  这个字符串用来表示该对象的自定义类型标签，通常只有内置的 Object.prototype.toString() 方法会去<br>  读取这个标签并把它包含在自己的返回值里  </p>
<p>  Object.prototype.toString.call(‘foo’);     // “[object String]”<br>  Object.prototype.toString.call([1, 2]);    // “[object Array]”<br>  Object.prototype.toString.call(3);         // “[object Number]”<br>  Object.prototype.toString.call(true);      // “[object Boolean]”<br>  Object.prototype.toString.call(undefined); // “[object Undefined]”<br>  Object.prototype.toString.call(null);      // “[object Null]”<br>  Object.prototype.toString.call(new Map());       // “[object Map]”<br>  Object.prototype.toString.call(function* () {}); // “[object GeneratorFunction]”<br>  Object.prototype.toString.call(Promise.resolve()); // “[object Promise]”</p>
<p>自己创建的类不会有这份特殊待遇，toString() 找不到 toStringTag 属性时只好返回默认的 Object 标签：</p>
<p>class ValidatorClass {}</p>
<p>Object.prototype.toString.call(new ValidatorClass()); // “[object Object]”  </p>
<p>加上 toStringTag 属性，你的类也会有自定义的类型标签了：</p>
<p>class ValidatorClass {<br>  get <a href>Symbol.toStringTag</a> {<br>    return “Validator”;<br>  }<br>}</p>
<p>Object.prototype.toString.call(new ValidatorClass()); // “[object Validator]”</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/05/A-List-of-Interesting-Operators-in-JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/A-List-of-Interesting-Operators-in-JavaScript/" itemprop="url">A List of Interesting Operators in JavaScript</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-05T08:25:37+08:00">
                2020-03-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-Exclamation-Mark-—-Logical-NOT"><a href="#1-Exclamation-Mark-—-Logical-NOT" class="headerlink" title="1. Exclamation Mark (!)— Logical NOT"></a>1. Exclamation Mark (!)— Logical NOT</h2><p>If the value is true or truthy, then !value is false or falsy, and vice versa</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">!<span class="number">1</span> <span class="comment">// false</span></span><br><span class="line">!<span class="number">-1</span> <span class="comment">// false</span></span><br><span class="line">!<span class="number">0</span> <span class="comment">// true</span></span><br><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// false</span></span><br><span class="line">!&#123;&#125; <span class="comment">// false</span></span><br><span class="line">!<span class="string">''</span> <span class="comment">// true</span></span><br><span class="line">!<span class="literal">NaN</span> <span class="comment">// true</span></span><br><span class="line">!<span class="literal">null</span> <span class="comment">// true</span></span><br><span class="line">!<span class="literal">undefined</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="2-Double-Exclamation-Mark-—-Double-Logical-NOT"><a href="#2-Double-Exclamation-Mark-—-Double-Logical-NOT" class="headerlink" title="2. Double Exclamation Mark (!!) — Double Logical NOT"></a>2. Double Exclamation Mark (!!) — Double Logical NOT</h2><p> It’s the same as putting an extra exclamation mark(!) to a !value that is already converted to a Boolean value.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">!!<span class="literal">true</span> <span class="comment">// true</span></span><br><span class="line">!!&#123;&#125; <span class="comment">// true</span></span><br><span class="line">!!(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">false</span>)) <span class="comment">// true</span></span><br><span class="line">!!<span class="literal">false</span> <span class="comment">// false</span></span><br><span class="line">!!<span class="string">''</span> <span class="comment">// false</span></span><br><span class="line">!!<span class="built_in">Boolean</span>(<span class="literal">false</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="3-Double-Asterisks-—-Exponentiation"><a href="#3-Double-Asterisks-—-Exponentiation" class="headerlink" title="3. Double Asterisks (**) — Exponentiation"></a>3. Double Asterisks (**) — Exponentiation</h2><ul>
<li>same as Math.pow(x, y), which is equal to x^y</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2</span> ** <span class="number">3</span> === <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">3</span>) <span class="comment">// 8</span></span><br><span class="line">-(<span class="number">2</span> ** <span class="number">2</span>) === -<span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">2</span>) <span class="comment">// -4</span></span><br><span class="line"><span class="number">10</span> ** <span class="number">-1</span> === <span class="built_in">Math</span>.pow(<span class="number">10</span>, <span class="number">-1</span>) <span class="comment">// 0.1</span></span><br></pre></td></tr></table></figure>
<h2 id="4-Tilde-—-Bitwise-NOT"><a href="#4-Tilde-—-Bitwise-NOT" class="headerlink" title="4. Tilde(~) — Bitwise NOT"></a>4. Tilde(~) — Bitwise NOT</h2><p>The formula is actually dead simple.</p>
<p>If an integer is K, ~K becomes -(K + 1)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">~<span class="number">9</span> =&gt; -<span class="function">(<span class="params"><span class="number">9</span> + <span class="number">1</span></span>) =&gt;</span> <span class="number">-10</span></span><br><span class="line">~<span class="number">-10</span> =&gt; -<span class="function">(<span class="params"><span class="number">-10</span> + <span class="number">1</span></span>) =&gt;</span> <span class="number">9</span></span><br></pre></td></tr></table></figure>
<h2 id="5-Double-Tilde-—-Math-floor-amp-Math-trunc"><a href="#5-Double-Tilde-—-Math-floor-amp-Math-trunc" class="headerlink" title="5. Double Tilde(~~) — Math.floor &amp; Math.trunc"></a>5. Double Tilde(~~) — Math.floor &amp; Math.trunc</h2><p>正数 效果  等于  Math.floor</p>
<p>负数 效果  等于  Math.trunc</p>
<p>~~对于整数 速度 快于 Math.floor</p>
<h2 id="6-Double-Period-With-toString"><a href="#6-Double-Period-With-toString" class="headerlink" title="6. Double Period(..) With toString"></a>6. Double Period(..) With toString</h2><p>快速将十进制数 转为 二进制 八进制 十六进制数<br>一般用Number.toString(2,8,16)</p>
<p>本质是将一个数字型字面量转为Number对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">5.</span>.toString(<span class="number">2</span>) <span class="comment">// '101'</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="number">5</span>).toString(<span class="number">2</span>) === <span class="number">5.</span>.toString(<span class="number">2</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="IIFE-With-Operators"><a href="#IIFE-With-Operators" class="headerlink" title="IIFE With Operators"></a>IIFE With Operators</h2><p>Immediately Invoked Function Expression 自执行函数表达式</p>
<p>通用</p>
<p>(function() {<br>  // do your work<br>})();</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="comment">// do your work</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">-<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do your work</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">~<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// do your work</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">~~<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do your work</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do your work</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">!!<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do your work</span></span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<ul>
<li>工作原理</li>
</ul>
<p>any operators that run and evaluate an operand can run functions coming after<br>since functions also have to be run<br>and evaluated for their operators, such as ! or ~</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/05/add链式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/add链式/" itemprop="url">add链式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-05T08:08:02+08:00">
                2020-03-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="add-1-2-3"><a href="#add-1-2-3" class="headerlink" title="add(1)(2)(3)"></a>add(1)(2)(3)</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum = x;</span><br><span class="line">  <span class="keyword">let</span> tmp = <span class="function"><span class="keyword">function</span> (<span class="params">y</span>) </span>&#123;</span><br><span class="line">    sum += y;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tmp.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>`</code>javascript<br>function add(x) {<br>  let tmp = function (y) {<br>    return add(x + y);<br>  }</p>
<p>  tmp.toString = function () {<br>    return x<br>  }</p>
<p>  return tmp;<br>}<br><code>`</code>9</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/04/How-the-new-‘Top-Level-Await’-feature-works-in-JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/How-the-new-‘Top-Level-Await’-feature-works-in-JavaScript/" itemprop="url">How the new ‘Top Level Await’ feature works in JavaScript</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-04T16:12:30+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以前，为了使用await，代码需要放在一个标记为async的函数中。<br>这意味着你不能在任何函数符号之外使用await。顶级的wait使模块能够像异步函数一样工作  </p>
<p>模块是异步的，并且具有导入和导出，这些模块也在顶层表示。</p>
<p>实际的含义是，如果您想提供一个依赖于某些异步任务的模块来执行某项操作，那么您实际上没有好的选择。</p>
<p>顶级await可以解决此问题，并使开发人员可以在异步函数之外使用await关键字。</p>
<p>通过顶层等待，ECMAScript模块可以等待资源，从而导致其他导入资源的模块在开始评估其主体之前等待，</p>
<p>或者如果模块加载失败或用作加载第一个模块，也可以将其用作加载依赖项回退 资源下载。</p>
<p>ps</p>
<ol>
<li><p>顶层等待仅在顶层模块上起作用。 不支持经典脚本或非异步功能。</p>
</li>
<li><p>截至撰写本文时，ECMAScript第3阶段</p>
</li>
</ol>
<h2 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h2><p>在顶层等待的情况下，下一个代码将按您期望的方式在模块中工作</p>
<ol>
<li>Using a fallback if module loading fails</li>
</ol>
<p>以下示例尝试从first.com加载JavaScript模块，如果失败则返回至</p>
<p>//module.mjs</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">module</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>= <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'https://first.com/libs.com/module1'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>= <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'https://second.com/libs/module1'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.使用加载速度最快的资源</p>
<p>此处res变量通过首先完成的下载来初始化。</p>
<p>//module.mjs</p>
<p>const resPromises = [<br>    donwloadFromResource1Site,<br>    donwloadFromResource2Site<br> ];</p>
<p>const res = await Promise.any(resPromises);</p>
<ol start="3">
<li>Resource initialization</li>
</ol>
<p>顶级的await允许您在模块中等待承诺，就好像它们被包装在异步函数中一样。<br>这对于执行应用程序初始化非常有用</p>
<p>//module.mjs</p>
<p>import { dbConnector} from ‘./dbUtils.js’<br>//connect() return a promise</p>
<p>const connection = await dbConnector.connect();<br>export default function(){connection.list()}</p>
<ol start="4">
<li>Loading modules dynamically</li>
</ol>
<p>这允许模块使用运行时值来确定依赖项</p>
<p>//module.mjs</p>
<p>const params = new URLSearchParams(window.location.search);<br>const lang = params.get(‘lang’);<br>const messages = await import(<code>./messages-${lang}.mjs</code>)</p>
<ol start="5">
<li>Using await outside async functions in DevTools</li>
</ol>
<p>在使用async / await之前，尝试在async函数之外使用<br>await会导致：“ SyntaxError：await仅在async函数中有效”现在，<br>可以使用它而无需将其放在async函数中</p>
<p>这已在chrome 80和firefox 72.0.2 DevTools中进行了测试。<br>但是，此功能是非标准功能，无法在nodejs中使用。</p>
<p>const helloPromise = new Promise((resolve)=&gt;{<br>  setTimeout(()=&gt; resolve(‘Hello world!’), 5000);<br>})<br>const result =  await helloPromise;<br>console.log(result);</p>
<p>//5 seconds later…:</p>
<p>Implementations<br>V8 with flag: — — harmony-top-level-await<br>Webpack (experimental support in 5.0.0)<br>Parser support has been added to Babel (babel/plugin-syntax-top-level-await).//Hello world!</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/04/Phases-of-the-Node-JS-Event-Loop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/Phases-of-the-Node-JS-Event-Loop/" itemprop="url">Phases of the Node JS Event Loop</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-04T15:17:06+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="node-poll"><a href="#node-poll" class="headerlink" title="node  poll"></a>node  poll</h2><p>轮询阶段处理我们执行的所有输入/输出操作</p>
<p>您编写的所有同步JavaScript代码都将在事件循环的轮询阶段执行</p>
<p>当事件循环处于其迭代的轮询阶段时，将执行所有代码</p>
<p>轮询阶段处理的不仅仅是IO操作</p>
<h2 id="node-check"><a href="#node-check" class="headerlink" title="node  check"></a>node  check</h2><p>setImmediate</p>
<h2 id="node-close-callback"><a href="#node-close-callback" class="headerlink" title="node  close callback"></a>node  close callback</h2><h2 id="node-timer"><a href="#node-timer" class="headerlink" title="node  timer"></a>node  timer</h2><p>setTimeout</p>
<p>setTimeout和setImmediate之间的区别</p>
<p>在这一点上，您可能一直想知道没有第二个参数的setTimeout和setImmediate之间有什么区别。</p>
<p>答案：</p>
<p>setImmediate和setTimeout（延迟为0ms）都在下一个事件循环迭代之前运行代码。 但是，有一个要考虑的重点：</p>
<p>setImmediate的优先级高于setTimeout。</p>
<h2 id="node-pending-callbacks"><a href="#node-pending-callbacks" class="headerlink" title="node  pending callbacks"></a>node  pending callbacks</h2><h2 id="node-idle-prepare"><a href="#node-idle-prepare" class="headerlink" title="node idle prepare"></a>node idle prepare</h2><h2 id="process-nextTick"><a href="#process-nextTick" class="headerlink" title="process.nextTick"></a>process.nextTick</h2><p>在事件循环的每个阶段执行之后，并且在开始事件循环的下一阶段之前，将执行nextTickQueue，但正式地它不是事件循环的一部分</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/04/JavaScript-new-features-in-ES2019-ES10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/04/JavaScript-new-features-in-ES2019-ES10/" itemprop="url">JavaScript new features in ES2019(ES10)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-04T09:10:39+08:00">
                2020-03-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-Array-prototype-flat-depth"><a href="#1-Array-prototype-flat-depth" class="headerlink" title="1. Array.prototype.flat(depth)"></a>1. Array.prototype.flat(depth)</h2><ol>
<li>指定深度 拍平</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> array1 = [<span class="string">'a'</span>,<span class="string">'b'</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]];</span><br><span class="line"><span class="keyword">let</span> array2 = array1.flat();</span><br><span class="line"></span><br><span class="line"><span class="comment">//['a', 'b', 1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>过滤空元素</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> array1 = [<span class="string">'a'</span>, <span class="string">'b'</span>, , , , <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> array2 = array1.flat();</span><br><span class="line"><span class="comment">// ['a','b','c']</span></span><br></pre></td></tr></table></figure>
<h2 id="2-Array-prototype-flatMap"><a href="#2-Array-prototype-flatMap" class="headerlink" title="2. Array.prototype.flatMap"></a>2. Array.prototype.flatMap</h2><ol>
<li>自动拍平深度默认是1  用map方法遍历所有元素  返回一个新数组</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">arr1.map(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]); </span><br><span class="line"><span class="comment">// [[2], [4], [6], [8]]</span></span><br><span class="line"></span><br><span class="line">arr1.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]);</span><br><span class="line"><span class="comment">// [2, 4, 6, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// only one level is flattened</span></span><br><span class="line">arr1.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> [[x * <span class="number">2</span>]]);</span><br><span class="line"><span class="comment">// [[2], [4], [6], [8]]</span></span><br></pre></td></tr></table></figure>
<h2 id="3-Object-fromEntries"><a href="#3-Object-fromEntries" class="headerlink" title="3. Object.fromEntries()"></a>3. Object.fromEntries()</h2><ol>
<li>转为 key-value对 放到一个数组中 参数对象必须是可迭代的</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> entries = <span class="built_in">Object</span>.entries(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">// entries</span></span><br><span class="line">(<span class="number">3</span>) [<span class="built_in">Array</span>(<span class="number">2</span>), <span class="built_in">Array</span>(<span class="number">2</span>), <span class="built_in">Array</span>(<span class="number">2</span>)]</span><br><span class="line"><span class="number">0</span>: (<span class="number">2</span>) [<span class="string">"a"</span>, <span class="number">1</span>]</span><br><span class="line"><span class="number">1</span>: (<span class="number">2</span>) [<span class="string">"b"</span>, <span class="number">2</span>]</span><br><span class="line"><span class="number">2</span>: (<span class="number">2</span>) [<span class="string">"c"</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = <span class="built_in">Object</span>.fromEntries(entries)</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;a: 1, b: 2, c: 3&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="4-String-trimStart-amp-String-trimEnd"><a href="#4-String-trimStart-amp-String-trimEnd" class="headerlink" title="4. String.trimStart() &amp; String.trimEnd()"></a>4. String.trimStart() &amp; String.trimEnd()</h2><ol>
<li>去掉头部或尾部的空格</li>
</ol>
<h2 id="5-Optional-Catch-Binding"><a href="#5-Optional-Catch-Binding" class="headerlink" title="5. Optional Catch Binding"></a>5. Optional Catch Binding</h2><p>catch 本来需要提供error参数 现在不需要了</p>
<p>Without optional catch binding:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// we have error parameter to handle it</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>With optional catch binding:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="comment">// no binding or parameter to handle it</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-Function-“toString”-Revision"><a href="#6-Function-“toString”-Revision" class="headerlink" title="6. Function “toString” Revision"></a>6. Function “toString” Revision</h2><p>Now the toString method must return source text slice from the beginning of the first token to end of the<br>last token matched by the appropriate grammar</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> /* <span class="title">kk</span>*/ <span class="title">foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* cc */</span> &#125;</span><br><span class="line"><span class="comment">// before:</span></span><br><span class="line">foo.toString();</span><br><span class="line"><span class="comment">// "function foo() &#123;&#125;"</span></span><br><span class="line"><span class="comment">// Now:</span></span><br><span class="line">foo.toString();</span><br><span class="line"><span class="comment">//"function /* kk*/ foo() &#123; /* cc */ &#125;"</span></span><br></pre></td></tr></table></figure>
<h3 id="7-Array-Sort-Stability"><a href="#7-Array-Sort-Stability" class="headerlink" title="7.Array.Sort Stability"></a>7.Array.Sort Stability</h3><p>V8中数组排序使用的不稳定快排算法 如果数组的元素多余10个的时候</p>
<p>v8(chrome&gt;=70) 使用了 稳定 TimeSort 算法</p>
<h2 id="8-Symbol-description"><a href="#8-Symbol-description" class="headerlink" title="8. Symbol.description"></a>8. Symbol.description</h2><p>获得一个Symbol的描述</p>
<p>before</p>
<p>const symbol1 = Symbol(‘my symbol’);<br>console.log(symbol1.toString());//Symbol(my symbol)</p>
<p>Now:</p>
<p>const symbol1 = Symbol(‘my symbol’);<br>console.log(symbol1)<br>console.log(String(symbol1) === <code>Symbol(${&#39;my symbol&#39;})</code>);<br>console.log(symbol1.description);<br>console.log(String(symbol1))</p>
<p>// Symbol(my symbol)<br>// true<br>// my symbol<br>// Symbol(my symbol)</p>
<h2 id="9-私有类变量"><a href="#9-私有类变量" class="headerlink" title="9. 私有类变量"></a>9. 私有类变量</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  #born = 1980</span><br><span class="line">  age() &#123; console.log(2020 - this.#born) &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> person1 = <span class="keyword">new</span> Person()</span><br><span class="line">person1.age() <span class="comment">// 40</span></span><br><span class="line">console.log(person1.#age)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Uncaught SyntaxError: Private field '#age' must be declared in an     </span></span><br><span class="line"><span class="comment">//enclosing class</span></span><br></pre></td></tr></table></figure>
<h2 id="10-Promise-allSettled"><a href="#10-Promise-allSettled" class="headerlink" title="10. Promise.allSettled"></a>10. Promise.allSettled</h2><p>静态方法 all race allsettled</p>
<p>all race 只有一个rejected 就会终止  短回路</p>
<p>allsettled 不会因为任何一个 一定是等待所有 settled 后 </p>
<p>Promise.allSettled does not short-circuit added in ES2020</p>
<p>Promise.all short-circuits when an input value is rejected added in ES6</p>
<p>Promise.race short-circuits when an input value is settled added in ES6</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promiseOne = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span></span><br><span class="line">                       setTimeout(resolve, <span class="number">300</span>));</span><br><span class="line"><span class="keyword">const</span> promiseTwo = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span></span><br><span class="line">                       setTimeout(reject, <span class="number">300</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.allSettled([promiseOne, promiseTwo]).then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'data'</span>, data));</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([promiseOne, promiseTwo]).then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'data'</span>, data), error =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'error'</span>, error)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([promiseOne, promiseTwo]).then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'data'</span>, data), error =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'error'</span>, error)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="11-String-prototype-matchAll"><a href="#11-String-prototype-matchAll" class="headerlink" title="11. String.prototype.matchAll"></a>11. String.prototype.matchAll</h2><p>给定一个字符串和一个正则表达式，matchAll（）方法返回一个与正则表达式匹配字符串的所有结果的迭代器，包括捕获组</p>
<p>Syntax: str.matchAll(regexp)</p>
<p>regexp: A regular expression object</p>
<p>Return value: An iterator (which is not a restartable iterable)</p>
<p>Capture groups are ignored when using match() with the global /g flag</p>
<p>const regexp = /g(ro)(up(\d?))/g;<br>const groups = ‘group1group2group3’;<br>groups.match(regexp);<br>//(3) [“group1”, “group2”, “group3”]<br>//0: “group1”<br>//1: “group2”<br>//2: “group3”</p>
<p>Using matchAll, you can access capture groups</p>
<p>const regexp = /g(ro)(up(\d?))/g;<br>const someString = ‘group1group2group3’;<br>const array = […someString.matchAll(regexp)];<br>array<br>//(3) [Array(4), Array(4), Array(4)]<br>//0: (4) [“group1”, “ro”, “up1”, “1”, index: 0, input: //“group1group2group3”, groups: undefined]<br>//1: (4) [“group2”, “ro”, “up2”, “2”, index: 6, input: //“group1group2group3”, groups: undefined]<br>//2: (4) [“group3”, “ro”, “up3”, “3”, index: 12, input: //“group1group2group3”, groups: undefined]<br>//length: 3</p>
<h2 id="12-Optional-Chaining-Operator"><a href="#12-Optional-Chaining-Operator" class="headerlink" title="12. Optional Chaining Operator ?."></a>12. Optional Chaining Operator ?.</h2><p>对象 数组 函数调用</p>
<p>let consumption = car?.engine?.consumption</p>
<p>let car1 = array?.[1]</p>
<h2 id="13-Dynamic-Import"><a href="#13-Dynamic-Import" class="headerlink" title="13. Dynamic Import"></a>13. Dynamic Import</h2><p>动态import（）引入了一种类似于函数的新导入形式，与静态导入相比，它可以释放新功能，例如：我们可以与延迟加载一起使用</p>
<p>//greetingsModule.js<br>export hello () =&gt; console.log(“Hello World!”);</p>
<p>静态引入</p>
<p>//main.js<br>import * as greet from ‘./ greetingsModule.js’;<br>greet.hello();<br>//Hello World!</p>
<p>静态导入语法只能在文件的顶层使用</p>
<p>相反，使用动态导入，import（module）表达式将加载模块并返回一个promise</p>
<p>该promise将解析为包含其所有导出内容的模块对象</p>
<p>另外，您可以在代码中的任何位置调用它</p>
<p>…<br>if( 1 === 1){<br>import(’./greetingsModule.js’).then( (greet) =&gt; {<br>             greet.hello();<br>            // Hello World!<br>         });<br>}<br>…</p>
<p>Or you can use async/await:</p>
<p>…<br>async function load() {<br>    let greet = await import(’./greetingsModule.js’);<br>    greet.hello();<br>    // Hello!<br>  }<br>…</p>
<p>静态导入和动态导入()都很有用。</p>
<p>每个都有自己的用例</p>
<p>使用静态导入，例如初始依赖项</p>
<p>在其他情况下，考虑使用动态导入特性按需加载依赖项</p>
<h2 id="BigInt"><a href="#BigInt" class="headerlink" title="BigInt"></a>BigInt</h2><p>JavaScripts Number对固定范围的数字有严格的限制，并且不能正确操作大整数。 </p>
<p>BigInt的新功能解决了这个问题，这在处理大价值的不同领域可能是一个相当大的问题。</p>
<p>BigInt是任意长度的整数。 现在，这种类型的变量可以包含253个数字字符，并且不限于数字值</p>
<p>我们可以使用新的BigInt数据类型解决此问题。 在数字末尾添加字母“ n”</p>
<p>const myBigNumber = 9007199254740991n;<br>console.log(myBigNumber +1n);<br>//9007199254740992n  -&gt; Correct value!<br>console.log(myBigNumber +10n);<br>//9007199254741001n  -&gt; Correct value!<br>//Note:<br>console.log(myBigNumber +10);<br>//Error: you cannot mix BigInt and other types, use explicit //conversions.<br>//Correct way: You have to add the letter ‘n’ on the end of the //number</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/03/chrome-devtool-tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/chrome-devtool-tips/" itemprop="url">chrome devtool tips</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-03T09:03:18+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="console使用类css选择器"><a href="#console使用类css选择器" class="headerlink" title="console使用类css选择器"></a>console使用类css选择器</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'tagName'</span>) /$(<span class="string">'.class'</span>)/ $(<span class="string">'#id'</span>) 还是 $(<span class="string">'.class #id'</span>) 等类似的选择器</span><br><span class="line">都相当于原生JS的<span class="built_in">document</span>.querySelector(<span class="string">''</span>) 方法</span><br><span class="line">这个方法返回第一个匹配选择规则的DOM元素</span><br><span class="line"></span><br><span class="line">$$(<span class="string">'tagName'</span>) 或者 $$(<span class="string">'.className'</span>) 记得是两个$$符号来选择所有匹配规则的DOM元素</span><br><span class="line">选择返回的结果是一个数组，可以通过数组的方法来访问其中的单个元素</span><br><span class="line">都相当于原生JS的<span class="built_in">document</span>.querySelectorAll(<span class="string">''</span>) 方法</span><br></pre></td></tr></table></figure>
<h2 id="获取某个DOM元素绑定的事件"><a href="#获取某个DOM元素绑定的事件" class="headerlink" title="获取某个DOM元素绑定的事件"></a>获取某个DOM元素绑定的事件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getEventListeners($(<span class="string">'selector'</span>))方法以数组对象的格式返回某个元素绑定的所有事件</span><br><span class="line">你可以在控制台里展开对象查看详细的内容</span><br><span class="line"></span><br><span class="line">要是你需要选择其中的某个事件，可以通过下面的方法来访问：</span><br><span class="line"></span><br><span class="line">getEventListeners($(<span class="string">'selector'</span>)).eventName[<span class="number">0</span>].listener</span><br><span class="line">这里的 eventName 表示某种事件类型，例如：</span><br><span class="line"></span><br><span class="line">getEventListeners($(<span class="string">'#firstName'</span>)).click[<span class="number">0</span>].listener</span><br></pre></td></tr></table></figure>
<h2 id="获取监测事件"><a href="#获取监测事件" class="headerlink" title="获取监测事件"></a>获取监测事件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">monitorEvents($(<span class="string">'selector'</span>)) 会监测某个元素上绑定的所有事件</span><br><span class="line">一旦该元素的某个事件被触发就会在控制台里显示出来。</span><br><span class="line">monitorEvents($(<span class="string">'selector'</span>),<span class="string">'eventName'</span>) 可以监听某个元素上绑定的具体事件</span><br><span class="line">第二个参数代表事件类型的名称。例如 monitorEvents($(<span class="string">'#firstName'</span>),<span class="string">'click'</span>) </span><br><span class="line">只监测ID为firstName的元素上的click事件</span><br><span class="line"></span><br><span class="line">monitorEvents($(<span class="string">'selector'</span>),[<span class="string">'eventName1'</span>,<span class="string">'eventName3'</span>,….]) 同上</span><br><span class="line">可以同时检测具体指定的多个事件类型</span><br><span class="line"></span><br><span class="line">unmonitorEvents($(<span class="string">'selector'</span>)) 用来停止对某个元素的事件监测</span><br></pre></td></tr></table></figure>
<h2 id="通过控制台方法来检查元素"><a href="#通过控制台方法来检查元素" class="headerlink" title="通过控制台方法来检查元素"></a>通过控制台方法来检查元素</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inspect($(<span class="string">'selector'</span>)) 会检查所有匹配选择器的DOM元素，并返回所有选择器选择的DOM对象</span><br><span class="line">例如inspect($(<span class="string">'#firstName'</span>)) 选择所有ID是 firstName 的元素，inspect($(<span class="string">'a'</span>)[<span class="number">3</span>]) 检查并返回页面上第四个 p元素</span><br></pre></td></tr></table></figure>
<h2 id="列出某个元素的所有属性"><a href="#列出某个元素的所有属性" class="headerlink" title="列出某个元素的所有属性"></a>列出某个元素的所有属性</h2><p>你也可以通过控制台列出某个元素的所有属性<br>dir($(‘selector’)) 会返回匹配选择器的DOM元素的所有属性</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">killsos.ql@gmail.com</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">135</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">killsos.ql@gmail.com</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
