<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="keywords" content="javascript 前端">
<meta property="og:type" content="website">
<meta property="og:title" content="killsos">
<meta property="og:url" content="http://jsonload.com/page/6/index.html">
<meta property="og:site_name" content="killsos">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="killsos">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jsonload.com/page/6/">





  <title>killsos</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">killsos</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人情似水分高下 世事如云任卷舒</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/04/03/Cool-New-Features-Released-with-TypeScript-3-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/03/Cool-New-Features-Released-with-TypeScript-3-6/" itemprop="url">Cool New Features Released with TypeScript 3.6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-03T10:25:41+08:00">
                2020-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Stricter-Type-Check-for-Generators"><a href="#Stricter-Type-Check-for-Generators" class="headerlink" title="Stricter Type Check for Generators"></a>Stricter Type Check for Generators</h2><h2 id="More-Accurate-Array-Spread"><a href="#More-Accurate-Array-Spread" class="headerlink" title="More Accurate Array Spread"></a>More Accurate Array Spread</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[...Array(<span class="number">3</span>)]</span><br></pre></td></tr></table></figure>
<h2 id="Raise-Error-with-Bad-Promise-Code"><a href="#Raise-Error-with-Bad-Promise-Code" class="headerlink" title="Raise Error with Bad Promise Code"></a>Raise Error with Bad Promise Code</h2><h2 id="Unicode-Character-Identifiers"><a href="#Unicode-Character-Identifiers" class="headerlink" title="Unicode Character Identifiers"></a>Unicode Character Identifiers</h2><h2 id="get-and-set-Accessors-Are-Allowed-in-Declare-Statements"><a href="#get-and-set-Accessors-Are-Allowed-in-Declare-Statements" class="headerlink" title="get and set Accessors Are Allowed in Declare Statements"></a>get and set Accessors Are Allowed in Declare Statements</h2><h2 id="Merging-Class-and-Constructor-Function-Declare-Statements"><a href="#Merging-Class-and-Constructor-Function-Declare-Statements" class="headerlink" title="Merging Class and Constructor Function Declare Statements"></a>Merging Class and Constructor Function Declare Statements</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span> declare <span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name: string</span>): <span class="title">Person</span>;</span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="title">declare</span> <span class="title">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    name: string;</span><br><span class="line">    age: number;</span><br><span class="line">    <span class="keyword">constructor</span>(name: string, age: number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/04/01/Clean-Code-Applied-to-JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/01/Clean-Code-Applied-to-JavaScript/" itemprop="url">Clean Code Applied to JavaScript</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-01T10:13:41+08:00">
                2020-04-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-start"><a href="#1-start" class="headerlink" title="1. start"></a>1. start</h2><ol>
<li><p>Code smell and refactoring 代码风格与重构</p>
</li>
<li><p>technical debt 技术债务</p>
</li>
<li><p>可读性</p>
<p> 代码格式</p>
</li>
<li><p>develop in English</p>
</li>
<li><p>团队风格</p>
<p>   空格或Tab</p>
<p>   函数名称后是否空格</p>
<p>   分号</p>
<p>   编辑器 EditorConfig</p>
<p>   eslint</p>
<p>   代码格式工具 Prettier</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root = <span class="literal">true</span></span><br><span class="line">[*]</span><br><span class="line">end_of_line = lf</span><br><span class="line">insert_final_newline = <span class="literal">true</span></span><br><span class="line">[*.&#123;js,py&#125;]</span><br><span class="line">charset = utf<span class="number">-8</span></span><br><span class="line">[*.py]</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = <span class="number">4</span></span><br><span class="line">[Makefile]</span><br><span class="line">indent_style = tab</span><br><span class="line">[*.js]</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = <span class="number">2</span></span><br><span class="line">[&#123;package.json,.travis.yml&#125;]</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h2 id="2-变量"><a href="#2-变量" class="headerlink" title="2 变量"></a>2 变量</h2><ol>
<li><p>Use Intention Revealing Names  见名知意</p>
</li>
<li><p>Use Pronounceable Names</p>
</li>
<li><p>Don’t Use the Variable’s Type in the Name</p>
</li>
<li><p>Use the Same Vocabulary for the Same Variable’s Type</p>
</li>
<li><p>Don’t Add Unneeded Context</p>
</li>
<li><p>Don’t Use Magic Numbers and Strings</p>
</li>
</ol>
<h2 id="3-函数"><a href="#3-函数" class="headerlink" title="3 函数"></a>3 函数</h2><ol>
<li><p>尽量是纯函数 提高复用性</p>
</li>
<li><p>Use Default Arguments Instead of Short Circuiting or Conditionals<br>使用默认参数</p>
</li>
<li><p>Function Arguments (Two or Fewer, Ideally)<br>尽量减少函数参数 如果参数过多 可以对象传参</p>
</li>
<li><p>Avoid Side Effects — Global Variables<br>避免全局变量</p>
</li>
<li><p>Avoid Side Effects — Objects Mutables</p>
</li>
</ol>
<p>通过代码的不同部分使用同一对象修改数据时，可能会出现更多的副作用。  </p>
<p>使我们失去软件开发的许多优势（避免使用此功能）的主要副作用之一是对象的修改。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> addItemToCart = <span class="function">(<span class="params">cart, item</span>) =&gt;</span> &#123;</span><br><span class="line">  cart.push(&#123; item, <span class="attr">date</span>: <span class="built_in">Date</span>.now() &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对原有数据cart没有修改 没有副作用</span></span><br><span class="line"><span class="keyword">const</span> addItemToCart = <span class="function">(<span class="params">cart, item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> […cart, &#123;</span><br><span class="line">    item,</span><br><span class="line">    date: <span class="built_in">Date</span>.now(),</span><br><span class="line">  &#125;];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6. Functions Should Do One Thing 函数单一职责 降耦</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7. Functions Should Only Be One Level of Abstraction</span></span><br><span class="line"><span class="string">设计功能时，我们还必须满足的另一个要求是，每个功能只能有一个抽象级别</span></span><br></pre></td></tr></table></figure>
<p>function parseBetterJSAlternative(code) {<br>  const REGEXES = [<br>    // …<br>  ];</p>
<p> const statements = code.split(‘ ‘);<br> const tokens = [];<br> REGEXES.forEach((REGEX) =&gt; {<br>   statements.forEach((statement) =&gt; {<br>     // …<br>   });<br> });</p>
<p> const ast = [];<br> tokens.forEach((token) =&gt; {<br>   // lex…<br> });</p>
<p> ast.forEach((node) =&gt; {<br>   // parse…<br> });<br>}</p>
<p>// improve</p>
<p>const REGEXES = [ // …];</p>
<p>function tokenize(code) {<br>  const statements = code.split(‘ ‘);<br>  const tokens = [];<br>  REGEXES.forEach((REGEX) =&gt; {<br>    statements.forEach((statement) =&gt; {<br>      tokens.push( /<em> … </em>/ );<br>    });<br>  });<br> return tokens;<br>}</p>
<p>function lexer(tokens) {<br> const ast = [];<br> tokens.forEach((token) =&gt; ast.push( /<em> </em>/ ));<br> return ast;<br>}</p>
<p>function parseBetterJSAlternative(code) {<br> const tokens = tokenize(code);<br> const ast = lexer(tokens);<br> ast.forEach((node) =&gt; // parse…);<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">8. Favor Functional Programming</span><br><span class="line"></span><br><span class="line">纯函数优点</span><br><span class="line"></span><br><span class="line">1.纯函数更容易推论。  </span><br><span class="line"></span><br><span class="line">2.测试更加容易，纯函数非常适合基于属性的测试之类的技术。  </span><br><span class="line"></span><br><span class="line">3.调试更容易。  </span><br><span class="line"></span><br><span class="line">4.程序更安全。  </span><br><span class="line"></span><br><span class="line">5.程序是在较高级别上编写的，因此更易于理解。  </span><br><span class="line"></span><br><span class="line">6.功能签名更有意义。  </span><br><span class="line"></span><br><span class="line">7.并行/并行编程更容易。   </span><br><span class="line"></span><br><span class="line">9. Use Method Chaining 链式调用</span><br><span class="line"></span><br><span class="line">## Comments 注释</span><br><span class="line"></span><br><span class="line">1. Only Comment Things That Have Business Logic Complexity</span><br><span class="line"></span><br><span class="line">仅评论具有业务逻辑复杂性的事物</span><br><span class="line"></span><br><span class="line">2. Don’t Have Journal Comments</span><br><span class="line"></span><br><span class="line">3. Avoid Positional Markers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Exceptions</span><br><span class="line">异常是质量软件开发中必不可少的部分，因为我们将控制意外或未实施的情况</span><br><span class="line"></span><br><span class="line">1. Prefer Exceptions to Returning Error Codes</span><br><span class="line"></span><br><span class="line">  1. 不耦合的业务逻辑和错误控制。这是两个需要解决的不同问题，必须加以区分和区别对待。</span><br><span class="line"></span><br><span class="line">  2. 减少代码中的冗长，使其更容易阅读。</span><br><span class="line"></span><br><span class="line">  3. 错误代码的责任已经委托给编程语言，编程语言必须为我们服务，反之亦然</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">class Laptop &#123;</span><br><span class="line"> sendShutDown() &#123;</span><br><span class="line">   const deviceID = getID(DEVICE_LAPTOP);</span><br><span class="line">   if (deviceID !== DEVICE_STATUS.INVALID) &#123;</span><br><span class="line">     const laptop = DB.findOne(deviceID);</span><br><span class="line">     if (laptop.getStatus() !== DEVICE_SUSPENDED) &#123;</span><br><span class="line">       pauseDevice(deviceID);</span><br><span class="line">       clearDeviceWorkQueue(deviceID);</span><br><span class="line">       closeDevice(deviceID);</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">       logger.log(‘Device suspended. Unable to shut down’);</span><br><span class="line">     &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">     logger.log(‘Invalid handle for: ‘ + DEVICE_LAPTOP.toString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Clean</span><br><span class="line">/*</span><br><span class="line"> The code is better because the algorithm</span><br><span class="line"> and error handling, are now separated.</span><br><span class="line">*/</span><br><span class="line">class Laptop &#123;</span><br><span class="line">  sendShutDown() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      tryToShutDown();</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      logger.log(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  tryToShutDown() &#123;</span><br><span class="line">    const deviceID = getID(DEVICE_LAPTOP);</span><br><span class="line">    const laptop = DB.findOne(deviceID);</span><br><span class="line">    pauseDevice(deviceID);</span><br><span class="line">    clearDeviceWorkQueue(deviceID);</span><br><span class="line">    closeDevice(deviceID);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getID(deviceID) &#123;</span><br><span class="line">    throw new DeviceShutDownError(‘Invalid handle for: ‘ +   deviceID.toString());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Don’t Ignore Caught Errors</li>
</ol>
<p>2.1. Please don t do the ostrich technique</p>
<p>请不要做鸵鸟技术</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> functionThatMightThrow();</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> functionThatMightThrow();</span><br><span class="line">&#125; <span class="keyword">catch</span> (error)&#123;</span><br><span class="line"> <span class="built_in">console</span>.error(error);</span><br><span class="line"> notifyUserOfError(error);</span><br><span class="line"> reportErrorToService(error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Don’t Ignore Rejected Promises</li>
</ol>
<ol start="4">
<li>Exceptions Hierarchy</li>
</ol>
<ol start="5">
<li>Provide Context With Exceptions</li>
</ol>
<h2 id="Avoid-Conditional-Complexity-避免条件的复杂性"><a href="#Avoid-Conditional-Complexity-避免条件的复杂性" class="headerlink" title="Avoid Conditional Complexity 避免条件的复杂性"></a>Avoid Conditional Complexity 避免条件的复杂性</h2><ol>
<li>Don t Use Flags As Function Parameters</li>
</ol>
<p>不要使用标志作为函数参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Dirty</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">book</span>(<span class="params">customer, isPremium</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// …</span></span><br><span class="line"> <span class="keyword">if</span> (isPremium) &#123;</span><br><span class="line">   premiumLogic();</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   regularLogic();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Clean (Declarative way)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bookPremium</span> (<span class="params">customer</span>) </span>&#123;</span><br><span class="line"> premiumLogic();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bookRegular</span> (<span class="params">customer</span>) </span>&#123;</span><br><span class="line"> retularLogic();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Encapsulate Conditionals<br>封装条件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (platform.state === <span class="string">'fetching'</span> &amp;&amp; isEmpty(cart)) &#123;</span><br><span class="line"> <span class="comment">// …</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showLoading</span>(<span class="params">platform, cart</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> platform.state === <span class="string">'fetching'</span> &amp;&amp; isEmpty(cart);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (showLoading(platform, cart)) &#123;</span><br><span class="line"> <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Replace Nested Conditionals With Guard Clauses<br>不要使用else语句</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPayAmount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">let</span> result;</span><br><span class="line"> <span class="keyword">if</span> (isDead)&#123;</span><br><span class="line">   result = deadAmount();</span><br><span class="line"> &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (isSeparated)&#123;</span><br><span class="line">     result = separatedAmount();</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (isRetired)&#123;</span><br><span class="line">       result = retiredAmount();</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       result = normalPayAmount();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// improve</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPayAmount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (isDead) <span class="keyword">return</span> deadAmount();</span><br><span class="line"> <span class="keyword">if</span> (isSeparated) <span class="keyword">return</span> separatedAmount();</span><br><span class="line"> <span class="keyword">if</span> (isRetired) <span class="keyword">return</span> retiredAmount();</span><br><span class="line"> <span class="keyword">return</span> normalPayAmount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Null-Object Pattern<br>不断检查对象是否为空，并根据此检查是否显示默认操作。 该模式称为空对象模式  </li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"> sound() &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">'bark'</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="string">'dog'</span>, <span class="literal">null</span>].map(<span class="function">(<span class="params">animal</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">if</span>(animal !== <span class="literal">null</span>) &#123;</span><br><span class="line">     sound();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// improve</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"> sound() &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">'bark'</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NullAnimal</span> </span>&#123;</span><br><span class="line"> sound() &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAnimal</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> type === <span class="string">'dog'</span> ? <span class="keyword">new</span> Dog() : <span class="keyword">new</span> NullAnimal();</span><br><span class="line">&#125;</span><br><span class="line">[<span class="string">'dog'</span>, <span class="literal">null</span>].map(<span class="function">(<span class="params">animal</span>) =&gt;</span> getAnimal(animal).sound());</span><br><span class="line"><span class="comment">// Returns ["bark", null]</span></span><br></pre></td></tr></table></figure>
<h2 id="Remove-Conditionals-Using-Polymorphism"><a href="#Remove-Conditionals-Using-Polymorphism" class="headerlink" title="Remove Conditionals Using Polymorphism"></a>Remove Conditionals Using Polymorphism</h2><p>使用多态性替换条件语句</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Auto</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">Auto.prototype.getProperty = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">   <span class="keyword">case</span> BIKE:</span><br><span class="line">     <span class="keyword">return</span> getBaseProperty();</span><br><span class="line">   <span class="keyword">case</span> CAR:</span><br><span class="line">     <span class="keyword">return</span> getBaseProperty() - getLoadFactor();</span><br><span class="line">   <span class="keyword">case</span> BUS:</span><br><span class="line">     <span class="keyword">return</span> (isNailed) ? <span class="number">0</span> : getBaseProperty(voltage);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"Should be unreachable"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// improve</span></span><br><span class="line"></span><br><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Auto</span> </span>&#123;</span><br><span class="line"> abstract getProperty();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bike</span> <span class="keyword">extends</span> <span class="title">Auto</span> </span>&#123;</span><br><span class="line"> getProperty() &#123;</span><br><span class="line">   <span class="keyword">return</span> getBaseProperty();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">extends</span> <span class="title">Auto</span> </span>&#123;</span><br><span class="line"> getProperty() &#123;</span><br><span class="line">   <span class="keyword">return</span> getBaseProperty() - getLoadFactor();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bus</span> <span class="keyword">extends</span> <span class="title">Auto</span> </span>&#123;</span><br><span class="line"> getProperty() &#123;</span><br><span class="line">   <span class="keyword">return</span> (isNailed) ? <span class="number">0</span> : getBaseProperty(voltage);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Somewhere in client code</span></span><br><span class="line">speed = auto.getProperty();</span><br></pre></td></tr></table></figure>
<h2 id="Remove-Conditionals-Using-the-Strategy-Pattern-Composition-Command-Pattern"><a href="#Remove-Conditionals-Using-the-Strategy-Pattern-Composition-Command-Pattern" class="headerlink" title="Remove Conditionals Using the Strategy Pattern (Composition)/Command Pattern"></a>Remove Conditionals Using the Strategy Pattern (Composition)/Command Pattern</h2><p>使用策略模式（组合）/命令模式替换条件语句</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logMessage</span>(<span class="params">message = <span class="string">"CRITICAL::The system …"</span></span>)</span>&#123;</span><br><span class="line"> <span class="keyword">const</span> parts = message.split(<span class="string">"::"</span>);</span><br><span class="line"> <span class="keyword">const</span> level = parts[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">switch</span> (level) &#123;</span><br><span class="line"> <span class="keyword">case</span> <span class="string">'NOTICE'</span>:</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"Notice"</span>)</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"> <span class="keyword">case</span> <span class="string">'CRITICAL'</span>:</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"Critical"</span>);</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"> <span class="keyword">case</span> <span class="string">'CATASTROPHE'</span>:</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"Castastrophe"</span>);</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// improve</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> strategies = &#123;</span><br><span class="line"> criticalStrategy,</span><br><span class="line"> noticeStrategy,</span><br><span class="line"> catastropheStrategy,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logMessage</span>(<span class="params">message = <span class="string">"CRITICAL::The system …"</span></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">const</span> [level, messageLog] = message.split(<span class="string">"::"</span>);</span><br><span class="line"> <span class="keyword">const</span> strategy = <span class="string">`<span class="subst">$&#123;level.toLowerCase()&#125;</span>Strategy`</span>;</span><br><span class="line"> <span class="keyword">const</span> output = strategies[strategy](messageLog);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">criticalStrategy</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">"Critical: "</span> + param);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noticeStrategy</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">"Notice: "</span> + param);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">catastropheStrategy</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">"Catastrophe: "</span> + param);</span><br><span class="line">&#125;</span><br><span class="line">logMessage();</span><br><span class="line">logMessage(<span class="string">"CATASTROPHE:: A big Catastrophe"</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/27/What-is-a-Blob/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/27/What-is-a-Blob/" itemprop="url">What is a Blob?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-27T20:19:31+08:00">
                2020-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="What-is-a-Blob"><a href="#What-is-a-Blob" class="headerlink" title="What is a Blob?"></a>What is a Blob?</h2><p>Blob is  <strong>Binary Large Object</strong></p>
<p>Blob不是JavaScript的特殊性。 最初，创建Blob是为了在数据库管理系统中使用。<br>该类型是在1970年代创建的，用于存储太大的音频，图像或视频之类的大文件，无法存储在常规数据库字段中。<br>该术语实际上是指“二进制大对象”。</p>
<p>Blob接口的stream() 方法返回一个ReadableStream对象，读取它将返回包含在Blob中的数据。</p>
<p>在JavaScript中，Blob用于将文件表示为不可变的原始数据<br>在控制台中，我们在上一个示例中创建的Blob如下所示</p>
<p><img src="../images/blob1.png" alt="Blob in console">  </p>
<p>如您所见，Blob具有两个属性：size和type。 大小是数据的大小（以字节为单位）。<br>该类型是应该包含MIME类型的字符串。 创建Blob时我没有给出任何类型，但是我应该做这样的事情：</p>
<p><code>const blob = new Blob([doc.output()], { type: &#39;application/pdf&#39; });</code></p>
<p><img src="../images/blob2.png" alt="Blob in console">  </p>
<p>JavaScript Blobs提供了一些方法来访问它们的内容<br>One of them is the text method that returns a Promise resolving to the content of the Blob as text  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="keyword">async</span> event =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.target.id === <span class="string">'button'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> doc = <span class="keyword">new</span> jsPDF();</span><br><span class="line">    doc.text(<span class="string">'Hello world!'</span>);</span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([doc.output()], &#123; <span class="attr">type</span>: <span class="string">'application/pdf'</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> blobAsText = <span class="keyword">await</span> blob.text();</span><br><span class="line">    <span class="built_in">console</span>.log(blobAsText);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>还有两种其他方法可让您访问Blob的内容：  </p>
<ol>
<li><p>arrayBuffer，将一个Promise解析返回给ArrayBuffer   </p>
</li>
<li><p>将返回ReadableStream的流  </p>
</li>
</ol>
<h2 id="Manipulate-Blobs"><a href="#Manipulate-Blobs" class="headerlink" title="Manipulate Blobs"></a>Manipulate Blobs</h2><p>我们会通过HTTP请求接收文件。 如果使用fetch API，则需要在主体上使用blob方法从响应中读取Blob  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> download = <span class="function">(<span class="params">fileName, blob</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> element = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">  <span class="keyword">const</span> url = <span class="built_in">window</span>.URL.createObjectURL(blob);</span><br><span class="line">  element.href = url;</span><br><span class="line">  element.download = fileName;</span><br><span class="line">  element.target = <span class="string">'_blank'</span>;</span><br><span class="line">  element.click();</span><br><span class="line">  element.remove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="keyword">async</span> event =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.target.id === <span class="string">'button'</span>) &#123;</span><br><span class="line">    fetch(<span class="string">'https://whatever/doc.pdf'</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">response</span> =&gt;</span> response.blob())</span><br><span class="line">    .then(<span class="function"><span class="params">blob</span> =&gt;</span> &#123;</span><br><span class="line">      download(<span class="string">'test.pdf'</span>, blob);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>您还可以从另一个Blob创建一个Blob。您只能对原始Blob进行切片，也就是说只返回其字节的一部分。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, <span class="keyword">async</span> event =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.target.id === <span class="string">'button'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([<span class="string">'some text'</span>], &#123; <span class="attr">type</span>: <span class="string">'application/pdf'</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> slicedBlob = blob.slice(<span class="number">5</span>, <span class="number">9</span>);</span><br><span class="line">    <span class="keyword">const</span> blobAsText = <span class="keyword">await</span> blob.text();</span><br><span class="line">    <span class="keyword">const</span> slicedBlobAsText = <span class="keyword">await</span> slicedBlob.text();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Original Blob: <span class="subst">$&#123;blobAsText&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Sliced Blob: <span class="subst">$&#123;slicedBlobAsText&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>File 接口基于Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件</p>
<p>浏览器已经Streams API允许JavaScript以编程方式访问通过网络接收的数据流，并根据开发人员的需要对其进行处理。</p>
<p>Blob四个方法：</p>
<ol>
<li><p>arrayBuffer() 方法返回一个 Promise 对象，包含 blob 中的数据，并在 ArrayBuffer 中以二进制数据的形式呈现</p>
<p>var bufferPromise = blob.arrayBuffer();</p>
<p>blob.arrayBuffer().then(buffer =&gt; \/* 处理 ArrayBuffer 数据的代码……*\/);</p>
<p>var buffer = await blob.arrayBuffer();   </p>
</li>
<li><p>slice() 方法用于创建一个包含源 Blob的指定字节范围内的数据的新 Blob 对象</p>
<p>var blob = instanceOfBlob.slice([start [, end [, contentType]]]};</p>
</li>
</ol>
<ol start="3">
<li><p>text() 方法返回一个 Promise 对象，包含 blob 中的内容，使用 UTF-8 格式编码</p>
</li>
<li><p>stream() 方法返回一个ReadableStream对象，读取它将返回包含在Blob中的数据</p>
</li>
</ol>
<p>本地图片预览方法</p>
<ol>
<li><p>ie6 可以直接显示本本地路径的图片 如： <img src="file://c:/3.jpg">  ~~~网上都说ie7就不支持这种文件系统路径的url，但测试 xp ie8还是可以的</p>
</li>
<li><p>ie8+ alphaImageLoader滤镜方式加载本地路径的图片</p>
</li>
<li><p>chrome, firefox, 用dataUrl  或 createObjectURL方法实现</p>
<p>img.src = window.URL.createObjectURL(obj.files.item(0));</p>
</li>
</ol>
<p>window.URL.createObjectURL</p>
<p>创建一个新的对象URL,该对象URL可以代表某一个指定的File对象或Blob对象</p>
<p>URL.createObjectURL(file)可以得到当前文件的一个内存URL</p>
<p>FileReader.readAsDataURL(file)可以得到一段base64的字符串。<br>URL.createObjectURL(file)可以得到当前文件的一个内存URL。</p>
<p>当不再需要这些 URL 对象时，每个对象必须通过调用 URL.revokeObjectURL() 方法来释放。</p>
<p>FileReader.readAsDataURL(file)的返回值是转化后的超长base64字符串(长度与要解析的文件大小正相关)。<br>URL.createObjectURL(file)的返回值虽然是字符串，但是是一个url地址</p>
<p>FileReader.readAsDataURL(file)依照JS垃圾回收机制自动从内存中清理。<br>URL.createObjectURL(file)存在于当前doucment内，清除方式只有unload()事件或revokeObjectURL()手动清除</p>
<p>FileReader.readAsDataURL(file)通过回调的形式返回，异步执行。<br>URL.createObjectURL(file)直接返回，同步执行。</p>
<p>FileReader.readAsDataURL(file)当多个文件同时处理时，需要每一个文件对应一个新的FileReader对象<br>URL.createObjectURL(file)依次返回无影响。</p>
<p>URL.createObjectURL(file)得到本地内存容器的URL地址，方便预览，多次使用需要注意手动释放内存的问题，性能优秀。<br>FileReader.readAsDataURL(file)胜在直接转为base64格式，可以直接用于业务，无需二次转换格式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Base64 to Blob</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURLtoBlob</span>(<span class="params">dataurl</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = dataurl.split(<span class="string">','</span>), mime = arr[<span class="number">0</span>].match(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>],</span><br><span class="line">        bstr = atob(arr[<span class="number">1</span>]), n = bstr.length, u8arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(n);</span><br><span class="line">    <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">        u8arr[n] = bstr.charCodeAt(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Blob([u8arr], &#123; <span class="attr">type</span>: mime &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">video.addEventListener(<span class="string">'loadeddata'</span>, consoleString.bind(video, <span class="string">'loadeddata'</span>)) <span class="comment">// 当前帧加载完毕</span></span><br><span class="line">video.addEventListener(<span class="string">'loadedmetadata'</span>, consoleString.bind(video, <span class="string">'loadedmetadata'</span>)) <span class="comment">// 视频元数据加载完毕</span></span><br><span class="line">video.addEventListener(<span class="string">'canplay'</span>, consoleString.bind(video, <span class="string">'canplay'</span>)) <span class="comment">// 视频缓冲能够开始播放</span></span><br><span class="line">video.addEventListener(<span class="string">'timeupdate'</span>, consoleString.bind(video, <span class="string">'timeupdate'</span>)) <span class="comment">// 播放位置发生改变时</span></span><br><span class="line">video.addEventListener(<span class="string">'play'</span>, consoleString.bind(video, <span class="string">'play'</span>)) <span class="comment">// 开始播放时</span></span><br><span class="line">video.addEventListener(<span class="string">'waiting'</span>, consoleString.bind(video, <span class="string">'waiting'</span>)) <span class="comment">// 要播放下一帧而需要缓冲时</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">consoleString</span>(<span class="params">string</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(string)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Blob-a-创建"><a href="#Blob-a-创建" class="headerlink" title="Blob a 创建"></a>Blob a 创建</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadFile</span>(<span class="params">fileName, content, blobOptions</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// blobOptions = &#123;</span></span><br><span class="line">        <span class="comment">//     type: 'text/csv',</span></span><br><span class="line">        <span class="comment">//     endings: 'native' // or transparent</span></span><br><span class="line">        <span class="comment">// &#125;;</span></span><br><span class="line">        <span class="keyword">let</span> blobOptions = blobOptions || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([content], blobOptions);</span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">        a.innerHTML = fileName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定生成的文件名</span></span><br><span class="line">        a.download = fileName;</span><br><span class="line">        a.href = URL.createObjectURL(blob);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(a);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> evt = <span class="built_in">document</span>.createEvent(<span class="string">"MouseEvents"</span>);</span><br><span class="line">        evt.initEvent(<span class="string">"click"</span>, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        a.dispatchEvent(evt);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span>  blob = <span class="keyword">new</span> Blob( array, options );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">array 是一个由<span class="built_in">ArrayBuffer</span>, ArrayBufferView, Blob, DOMString 等对象构成的 <span class="built_in">Array</span>   </span><br><span class="line">或者其他类似对象的混合体，它将会被放进 Blob   </span><br><span class="line">DOMStrings会被编码为UTF<span class="number">-8</span>   </span><br><span class="line"></span><br><span class="line">options 是一个可选的BlobPropertyBag字典，它可能会指定如下两个属性：</span><br><span class="line"></span><br><span class="line">type，默认值为 <span class="string">""</span>，它代表了将会被放入到blob中的数组内容的MIME类型     </span><br><span class="line"></span><br><span class="line">endings，默认值为<span class="string">"transparent"</span>，用于指定包含行结束符\n的字符串如何被写入   </span><br><span class="line"></span><br><span class="line">它是以下两个值中的一个： <span class="string">"native"</span>，代表行结束符会被更改为适合宿主操作系统文件系统的换行符   </span><br><span class="line">或者 <span class="string">"transparent"</span>，代表会保持blob中保存的结束符不变</span><br></pre></td></tr></table></figure>
<p>Blob 对象表示一个不可变、原始数据的类文件对象。Blob 表示的不一定是JavaScript原生格式的数据。  </p>
<p>File 接口基于Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件   </p>
<p>File 对象是来自用户在一个 <input> 元素上选择文件后返回的 FileList 对象,<br>也可以是来自由拖放操作生成的 DataTransfer 对象，<br>或者来自 HTMLCanvasElement 上的 mozGetAsFile() API   </p>
<p>File 对象是特殊类型的 Blob，且可以用在任意的 Blob 类型的 context 中。<br>比如说， FileReader, URL.createObjectURL(), createImageBitmap(),<br>及 XMLHttpRequest.send() 都能处理 Blob 和 File。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>Blob 基于二进制数据格式</p>
</li>
<li><p>file 基于Blob的子类型</p>
</li>
<li><p>创建图片预览</p>
<p> fileReader 异步</p>
<p> window.URL.createObjectURL 同步  在内存中</p>
<p> window.URL.createObjectURL() 和 window.URL.revokeObjectURL() 方法的支持。   </p>
<p> 这使得你可以创建用于引用任何数据的简单URL字符串，  </p>
<p> 也可以引用一个包括用户电脑上的本地文件的DOM File对象。  </p>
<p> window.URL.createObjectURL() 来创建</p>
<p> window.URL.revokeObjectURL() 来释放</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/27/Do-you-know-why-this-x-is-Undefined-when-x-is-declared-with-Const-or-Let/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/27/Do-you-know-why-this-x-is-Undefined-when-x-is-declared-with-Const-or-Let/" itemprop="url">Do you know why this.x is Undefined when x is declared with Const or Let?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-27T16:28:49+08:00">
                2020-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="question"><a href="#question" class="headerlink" title="question"></a>question</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line">f(); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>根据文档，对于所有执行上下文，有三个组件-代码评估状态，函数和领域。 我们将研究第三个组件Realm  </p>
<p>A Realm is a kind of a world that associated ECMAScript resources live.   </p>
<p>And the realm of the running execution is called the current Realm.  </p>
<p> Why this is a matter? When you execute JavaScript code,   </p>
<p> it creates a global execution context whose current Realm is the global Realm.   </p>
<p> In this realm, an object called globalEnv is created and envolved, which contains a Lexical Environment.</p>
<p> 领域是一种与ECMAScript资源相关联的世界。 运行执行的领域称为当前领域。   </p>
<p> 为什么这是问题？ 当您执行JavaScript代码时，它将创建一个全局执行上下文，其当前领域是全局领域。   </p>
<p> 在此领域中，将创建并旋转一个名为globalEnv的对象，其中包含一个词法环境。</p>
<h2 id="Global-Lexical-Environment"><a href="#Global-Lexical-Environment" class="headerlink" title="Global Lexical Environment"></a>Global Lexical Environment</h2><p> Every lexical environment has an environment record, which contains your variables and keeps tracking them.     </p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> globalLexicalEnvironment = &#123;</span><br><span class="line">  environmentRecord: &#123;</span><br><span class="line">    name: name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">The lexical environment created <span class="keyword">in</span> the Realm <span class="keyword">of</span> the global execution context contains thewindow object.</span><br></pre></td></tr></table></figure>
<p> 生成全局执行上下文时，将创建其环境记录，并将其视为所有ECMAScript元素共享的最外部作用域。   </p>
<p> 全球环境记录中存在一个领域，换句话说，它是最外部的范围。   </p>
<p> 并且此环境记录提供了内置变量或函数的绑定。 这是这些内置物品的列表。  </p>
<p>Infinity<br>NaN<br>undefined<br>eval<br>Array<br>Boolean</p>
<p>….</p>
<p>对于浏览器JavaScript，将这些属性分配给的对象称为window。   </p>
<p>这种关系可以表示如下，但是，这当然不是JavaScript的工作方式</p>
<p>var window = {<br>  Infinity: …,<br>  NaN: …,<br>  undefined: …,<br>  eval: …,<br>  Array: …,<br>  Boolean: …,<br>};<br>var globalExecutionContext = {<br>  environmentRecords: {<br>    window: window<br>  }<br>};</p>
<h2 id="Var-vs-Const-amp-Let"><a href="#Var-vs-Const-amp-Let" class="headerlink" title="Var vs Const &amp; Let"></a>Var vs Const &amp; Let</h2><p>那么为什么var变量成为window属性 而let和const声明的属性则不是呢？</p>
<p>在将事物声明并分配给全局环境记录中涉及的名为window的对象时，将向全局环境记录中添加另一个声明。 称为TopLevelVarDeclaredNames。  </p>
<p>它定义了JavaScript如何在顶级范围内处理var变量。 根据规范，程序开头是一个空数组  </p>
<p>事实是，没有TopLevelLetDeclaredNames或TopLevelConstDeclaredNames。 意思是，const和let变量不会添加到全局对象window。   </p>
<h2 id="那我无法永远访问它们吗？"><a href="#那我无法永远访问它们吗？" class="headerlink" title="那我无法永远访问它们吗？"></a>那我无法永远访问它们吗？</h2><p>解决办法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.x = x;</span><br><span class="line">print(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/27/this-keyword-in-JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/27/this-keyword-in-JavaScript/" itemprop="url">this keyword in JavaScript</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-27T15:53:02+08:00">
                2020-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="what-is-this-keyword"><a href="#what-is-this-keyword" class="headerlink" title="what is this keyword"></a>what is this keyword</h2><p>首先，您应该知道“ this”是什么以及它在JavaScript中的作用。<br>JavaScript中存在一个称为“执行上下文”的区域，该区域是JavaScript首次运行代码或调用函数时创建的。<br>如果连续调用5个函数，则将创建6个执行上下文-全局执行上下文，以及其他5个函数执行上下文。<br>每个执行上下文都包含一个名为ThisBinding的值，该值与“ this”关键字有关</p>
<p>那又是什么呢？ 在JavaScript中，“ this”是一个特殊的关键字，无论您当前的函数在哪里，<br>都可以使用它直接在当前作用域中访问某个对象。<br>认情况下，它引用全局对象。 在Node.Js中，它将是全局的global；在浏览器中，它将是window。  </p>
<p>但更重要的是要记住，“ this”所指出的内容取决于哪个上下文调用包含“ this”的函数。</p>
<h2 id="how-use-this"><a href="#how-use-this" class="headerlink" title="how use this"></a>how use this</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">x</span>: <span class="number">2</span> &#125;;</span><br><span class="line">obj.foo = foo;</span><br><span class="line"></span><br><span class="line">obj.foo(); <span class="comment">// 2</span></span><br><span class="line">foo(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>即使“ this”是由调用函数的上下文决定的，但“ this”并不总是遵循此规则</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">x</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);  </span><br><span class="line">  &#125;</span><br><span class="line">  bar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.foo = foo;</span><br><span class="line">obj.foo();</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h2 id="How-to-avoid-this-flaw"><a href="#How-to-avoid-this-flaw" class="headerlink" title="How to avoid this flaw?"></a>How to avoid this flaw?</h2><ol>
<li><p>Function.prototype.bind</p>
</li>
<li><p>Function.prototype.call and Function.prototype.apply</p>
</li>
<li><p>that = this  _this = this</p>
</li>
<li><p>arrow function  this取决于声明的地方</p>
</li>
</ol>
<p>An arrow function does not have its own this<br>The this value of the enclosing lexical scope is used<br>arrow functions follow the normal variable lookup rules  </p>
<h2 id="this-in-a-constructor-function"><a href="#this-in-a-constructor-function" class="headerlink" title="this in a constructor function"></a>this in a constructor function</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/27/Execution-Context-Lexical-Environment-and-Closures-in-JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/27/Execution-Context-Lexical-Environment-and-Closures-in-JavaScript/" itemprop="url">Execution Context, Lexical Environment, and Closures in JavaScript</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-27T11:17:26+08:00">
                2020-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="执行上下文-Execution-Context"><a href="#执行上下文-Execution-Context" class="headerlink" title="执行上下文 Execution Context"></a>执行上下文 Execution Context</h2><p>什么是执行上下文？ 每当您编写一些代码时，您的代码都在一个空间中执行—该空间称为“执行上下文”   </p>
<p>在JavaScript中，每当调用一个函数时，都会在当前运行的执行上下文上创建一个新的执行上下文。   </p>
<p>新创建的一个存储在堆栈中，用于当前函数的执行上下文。</p>
<p>堆栈的栈底是全局执行上下文</p>
<p>堆栈是有最大限制 可能见到这种错误 Maxium call stack size exceeded</p>
<h2 id="A-Lexical-Environment-词法环境"><a href="#A-Lexical-Environment-词法环境" class="headerlink" title="A Lexical Environment 词法环境"></a>A Lexical Environment 词法环境</h2><p>一个执行上下文包括: 词法环境  变量环境  this</p>
<p><img src="../images/ex1.png" alt="执行上下文"></p>
<p>What LexicalEnvironment does is to keep track of variables, function names and associated values  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br><span class="line"></span><br><span class="line"><span class="comment">// When foo is called, a new execution environment</span></span><br><span class="line"><span class="comment">// might look like this below</span></span><br><span class="line">execution_environment: &#123;</span><br><span class="line">  LexicalEnvironment: &#123;</span><br><span class="line">    a: <span class="number">10</span>,</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ThisBinding: ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行上下文包含三部分 词法环境LexicalEnvironment 也包含几个部分<br>其中 EnvironmentRecord  和 外部outer lexical environment 可以认为是作用域  </p>
<p>声明变量或函数时，它们实际上存储在其环境记录中   </p>
<p>链接属性值基本上意味着链接属于环境记录的属性的值  </p>
<p>A reference to the outer lexical environment is also created when LexicalEnvironment is created. It directly links to the parent LexicalEnvironment, and JavaScript uses this value when it can’t find a property in the current LexicalEnvironment. If it still can’t find it in the parent LexicalEnvironment, then it, again, goes up to the parent LexicalEnvironment. This process doesn’t stop until it finds what it’s looking for or until nothing is connected to the LexicalEnvironment. The global LexicalEnvironment doesn’t have a parent’s LexicalEnvironment. So, when JavaScript tries to look for something in the global LexicalEnvironment, a Reference Error occurs.</p>
<p>一句话总结作用域链</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">2</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> z = <span class="number">3</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(z);</span><br><span class="line">      <span class="built_in">console</span>.log(y);</span><br><span class="line">      <span class="built_in">console</span>.log(x);</span><br><span class="line">      <span class="built_in">console</span>.log(w);</span><br><span class="line">    &#125;</span><br><span class="line">    baz();</span><br><span class="line">  &#125;</span><br><span class="line">  bar();</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// Reference Error: w is not defined</span></span><br></pre></td></tr></table></figure>
<p>remember:</p>
<p>the outer environment, connecting to the parent’s environment,  </p>
<p>is determined when the function is declared, not when it’s invoked</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">2</span>;</span><br><span class="line">  bar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">解释上面的话</span><br></pre></td></tr></table></figure>
<h2 id="ThisBinding"><a href="#ThisBinding" class="headerlink" title="ThisBinding"></a>ThisBinding</h2><p>The reference inside the execution context, ThisBinding,   </p>
<p>determines how the function is called.</p>
<h2 id="执行上下文种类"><a href="#执行上下文种类" class="headerlink" title="执行上下文种类"></a>执行上下文种类</h2><ol>
<li><p>全局执行上下文  </p>
<p> 全局包含几个对象 其中之一就是window对象</p>
<p>   window对象属性有 document setTimeout</p>
</li>
<li><p>函数执行上下文</p>
</li>
</ol>
<p>全局执行上下文 和  函数执行上下文 有一个共同点是  </p>
<p>运行的时候分为两个阶段： 创建 和  执行</p>
<p>在创建阶段 变量和函数被声明  </p>
<p>但是变量默认被赋值undefined 而函数直接分配了 — 这就是传说中 变量和函数预解析</p>
<p>这也就是说 如果一个变量和函数同名 console.log出来的是函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(x) <span class="comment">// function x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'function x'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x () <span class="comment">// TypeError: x is not a function</span></span><br></pre></td></tr></table></figure>
<p>调用一个函数 会自动生成一个函数执行上下文 并且放到调用栈<br>并且首先进入创建阶段 函数执行上下文的LexicalEnvironment包含所有的变量<br>并且还有一个特殊的变量arguments — 形参<br>函数执行完 这个函数执行上下文就从调用栈被移除  </p>
<h2 id="Closures-闭包"><a href="#Closures-闭包" class="headerlink" title="Closures 闭包"></a>Closures 闭包</h2><p>I explained that LexicalEnvironment also has an outer environment that refers to the parent’s LexicalEnvironment.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">z</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y + z;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = foo(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<ol>
<li><p>闭包定义</p>
<p>函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起构成闭包（closure）。</p>
<p>也就是说，闭包可以让你从内部函数访问外部函数作用域。  </p>
<p>在 JavaScript 中，每当函数被创建，就会在函数生成时生成闭包。</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/27/Functional-Programming-and-the-Pipe-Function-in-JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/27/Functional-Programming-and-the-Pipe-Function-in-JavaScript/" itemprop="url">Functional Programming and the Pipe Function in JavaScript</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-27T10:18:38+08:00">
                2020-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Functional-Programming-and-the-Pipe-Function"><a href="#Functional-Programming-and-the-Pipe-Function" class="headerlink" title="Functional Programming and the Pipe Function"></a>Functional Programming and the Pipe Function</h2><h2 id="1-Pipe-Function-管道编程"><a href="#1-Pipe-Function-管道编程" class="headerlink" title="1. Pipe Function 管道编程"></a>1. Pipe Function 管道编程</h2><ul>
<li>核心 reduce 箭头函数</li>
</ul>
<p>管道的目的是成为资源从A到B的隧道。除了作为资源通过的空间之外，它对资源没有任何作用。  </p>
<p>JavaScript中管道功能的想法来自现实世界中的管道</p>
<p>参考于Unix中管道</p>
<p>管道原理参考 <a href="https://whatis.techtarget.com/definition/pipe" target="_blank" rel="noopener">https://whatis.techtarget.com/definition/pipe</a></p>
<p>In computer programming, especially in UNIX operating systems, a pipe is a technique for passing information from one program process to another. Unlike other forms of interprocess communication (IPC), a pipe is one-way communication only. Basically, a pipe passes a parameter such as the output of one process to another process which accepts it as input. The system temporarily holds the piped information until it is read by the receiving process.</p>
<p>Using a UNIX shell (the UNIX interactive command interface), a pipe is specified in a command line as a simple vertical bar (|) between two command sequences. The output or result of the first command sequence is used as the input to the second command sequence. The pipe system call is used in a similar way within a program.</p>
<p>For two-way communication between processes, two pipes can be set up, one for each direction. A limitation of pipes for interprocess communication is that the processes using pipes must have a common parent process (that is, share a common open or initiation process and exist as the result of a fork system call from a parent process)</p>
<p>A pipe is fixed in size and is usually at least 4,096 bytes.</p>
<p>在计算机编程中，尤其是在UNIX操作系统中，管道是一种用于将信息从一个程序进程传递到另一个程序进程的技术。 与其他形式的进程间通信（IPC）不同，管道仅是单向通信。 基本上，管道将一个过程的输出之类的参数传递给另一个接受该过程作为输入的过程。 系统暂时保留管道信息，直到接收过程将其读取为止。</p>
<p>使用UNIX Shell（UNIX交互式命令界面），在命令行中将管道指定为两个命令序列之间的简单竖线（|）。 第一命令序列的输出或结果用作第二命令序列的输入。 管道系统调用以类似的方式在程序中使用。</p>
<p>对于过程之间的双向通信，可以设置两条管道，每个方向一条。 用于进程间通信的管道的局限性在于，使用管道的进程必须具有一个公共的父进程（也就是说，共享一个公共的打开或初始化进程，并且由于来自父进程的fork系统调用而存在）</p>
<p>管道的大小是固定的，通常至少为4,096字节</p>
<h2 id="Pure-Functions-纯函数"><a href="#Pure-Functions-纯函数" class="headerlink" title="Pure Functions 纯函数"></a>Pure Functions 纯函数</h2><ol>
<li><p>Returns the same output with the same input.</p>
</li>
<li><p>Doesn’t change any values out of its function scope.</p>
</li>
</ol>
<p>为什么纯函数对管道很重要？ 如前所述，管道将给定值传递给下一个管道。<br>但是，如果函数可以返回不同的值，则管道中的下一个函数将无法确保结果稳定   </p>
<h2 id="如何写管道"><a href="#如何写管道" class="headerlink" title="如何写管道"></a>如何写管道</h2><ul>
<li>核心通过Array的reduce方法 reduce的作用是遍历一个数组并得出一个紧凑的结果</li>
</ul>
<h2 id="Step-1-Put-all-of-the-functions-that-we-want-to-enqueue-into-reduce"><a href="#Step-1-Put-all-of-the-functions-that-we-want-to-enqueue-into-reduce" class="headerlink" title="Step 1. Put all of the functions that we want to enqueue into reduce"></a>Step 1. Put all of the functions that we want to enqueue into reduce</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> pipe = <span class="function">(<span class="params">funcs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">为了更好的可读性，我们更改参数的名称</span><br><span class="line"></span><br><span class="line">funcs.reduce(<span class="function">(<span class="params">res, func</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="2-Step-2-Fill-the-body-part"><a href="#2-Step-2-Fill-the-body-part" class="headerlink" title="2. Step 2. Fill the body part"></a>2. Step 2. Fill the body part</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">funcs.reduce(<span class="function">(<span class="params">res, func</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> func(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Step-3-Set-the-InitialValue"><a href="#Step-3-Set-the-InitialValue" class="headerlink" title="Step 3. Set the InitialValue"></a>Step 3. Set the InitialValue</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> pipe = <span class="function">(<span class="params">funcs, v</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">res, func</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> func(res);</span><br><span class="line">  &#125;, v);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">实际上存在一个问题，因为管道仅采用数组。 因此，您不能在下面运行这样的管道功能</span><br><span class="line"></span><br><span class="line">pipe(addFive, <span class="number">5</span>);</span><br><span class="line"><span class="comment">//   ~~~</span></span><br><span class="line"><span class="comment">// Uncaught TypeEror: funcs.reduce is not a function</span></span><br></pre></td></tr></table></figure>
<h2 id="Step-4-Generalization"><a href="#Step-4-Generalization" class="headerlink" title="Step 4. Generalization"></a>Step 4. Generalization</h2><p>如果管道也可以有一个单独的功能，似乎会更好。此时，我将使用rest参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> pipe = <span class="function">(<span class="params">v, ...funcs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">res, func</span>) =&gt;</span> func(res), v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pipe = <span class="function">(<span class="params">...funcs</span>) =&gt;</span> v =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">res, func</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> func(res);</span><br><span class="line">  &#125;, v);</span><br><span class="line">&#125;;</span><br><span class="line">pipe(add)(<span class="number">5</span>) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<h2 id="The-Pipeline-Operator-gt"><a href="#The-Pipeline-Operator-gt" class="headerlink" title="The Pipeline Operator  |&gt;"></a>The Pipeline Operator  |&gt;</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doubleSay</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str + <span class="string">", "</span> + str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">capitalize</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str[<span class="number">0</span>].toUpperCase() + str.substring(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exclaim</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str + <span class="string">'!'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = exclaim(capitalize(doubleSay(<span class="string">"hello"</span>)));</span><br><span class="line">result <span class="comment">//=&gt; "Hello, hello!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = <span class="string">"hello"</span></span><br><span class="line">  |&gt; doubleSay</span><br><span class="line">  |&gt; capitalize</span><br><span class="line">  |&gt; exclaim;</span><br><span class="line"></span><br><span class="line">result <span class="comment">//=&gt; "Hello, hello!"</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/27/text-decoration波浪线/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/27/text-decoration波浪线/" itemprop="url">text-decoration波浪线</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-27T09:53:05+08:00">
                2020-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="text-decoration"><a href="#text-decoration" class="headerlink" title="text-decoration"></a>text-decoration</h2><ol>
<li><p>text-decoration-color</p>
</li>
<li><p>text-decoration-line</p>
</li>
</ol>
<p>underline  overline  line-through  blink</p>
<ol start="3">
<li><p>text-decoration-style</p>
<p> solid    画一条实线<br> double   画一条双实线<br> dotted   画一条点划线<br> dashed   画一条虚线。<br> wavy     画一条波</p>
</li>
<li><p>text-decoration-thickness</p>
</li>
</ol>
<p>设置元素中文本所使用的装饰线如 line-through, underline, or overline 的厚度或者宽度</p>
<p>text-decoration-thickness  属性用来设置元素中文本所使用的装饰线如 line-through, underline, or overline 的厚度或者宽度</p>
<h2 id="利用与实现"><a href="#利用与实现" class="headerlink" title="利用与实现"></a>利用与实现</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wavy &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    height: <span class="number">.5</span>em;</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">    letter-spacing: <span class="number">100</span>vw;</span><br><span class="line">    padding-top: <span class="number">.5</span>em;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">wavy::before &#123;</span><br><span class="line">    content: <span class="string">"\2000\2000"</span>;</span><br><span class="line">    <span class="comment">/* IE浏览器实线代替 */</span></span><br><span class="line">    text-decoration: overline;</span><br><span class="line">    <span class="comment">/* 现代浏览器 */</span></span><br><span class="line">    text-decoration: overline wavy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>伪元素生成两个空格，使用letter-spacing属性控制两个空格占据的宽度足够宽，space<br>这样空格字符的装饰线的尺寸一定可以充满整个容器，<br>此时只要设置装饰线的类型是波浪线，<br>宽度100%自适应的波浪线效果就实现了 注意点 safari 不支持 </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/13/JavaScript-Clean-Code-—-Vertical-Formatting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/13/JavaScript-Clean-Code-—-Vertical-Formatting/" itemprop="url">JavaScript Clean Code — Vertical Formatting</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-13T16:44:30+08:00">
                2020-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-Blank-Lines"><a href="#1-Blank-Lines" class="headerlink" title="1 Blank Lines"></a>1 Blank Lines</h2><p>class Foo {metho1(){}metho2(){}}<br>class Bar {metho1(){}metho2(){}}</p>
<p>class Foo {<br>  method1() {}<br>  method2() {}<br>}</p>
<p>class Bar {<br>  method1() {}<br>  method2() {}<br>}</p>
<h2 id="2-Vertical-Density-垂直密度"><a href="#2-Vertical-Density-垂直密度" class="headerlink" title="2 Vertical Density 垂直密度"></a>2 Vertical Density 垂直密度</h2><p>代码在垂直方向上不应太密集  始终在代码组之间留一些空间</p>
<p>我们可以将变量声明分组在一起，而不能在其自己的组中包含空白行和类</p>
<p>let x = 1;<br>let y = 2;<br>class Foo {<br>  method1() {}<br>  method2() {}<br>}<br>class Bar {<br>  method1() {}<br>  method2() {}<br>}</p>
<h2 id="3-Vertical-Distance-垂直距离"><a href="#3-Vertical-Distance-垂直距离" class="headerlink" title="3 Vertical Distance 垂直距离"></a>3 Vertical Distance 垂直距离</h2><p>从一个函数跳到下一个函数，不停地在页面上上下滚动来阅读我们的代码，这是令人沮丧的。  </p>
<p>它让每个人都困惑。而且，在大量的文件中寻找某个东西的原始定义也很令人沮丧。  </p>
<p>为了防止这种情况发生，相关的概念应该保持紧密联系。  </p>
<h2 id="4-Variable-Declarations"><a href="#4-Variable-Declarations" class="headerlink" title="4 Variable Declarations"></a>4 Variable Declarations</h2><p>变量声明应尽可能接近其用法，以便可以快速找到它们的用法，而无需滚动或跳过不同的文件。</p>
<p>循环控制变量应在loop语句中声明，以便读者立即知道在循环中使用了它。</p>
<h2 id="5-Instance-Variables"><a href="#5-Instance-Variables" class="headerlink" title="5 Instance Variables"></a>5 Instance Variables</h2><p>实例变量应该在类的顶部声明，以便我们知道可以立即找到它们。</p>
<p>我们可以将它们放入构造函数中，以便我们知道它们在那里供我们使用或更改</p>
<p>class Point { // good<br>  constructor(x, y) {<br>    this.x = x;<br>    this.y = y;<br>  }<br>  getPoint() {}<br>  setPoint() {}<br>}</p>
<p>class Point { // bad<br>  getPoint() {}<br>  setPoint() {}<br>  constructor(x, y) {<br>    this.x = x;<br>    this.y = y;<br>  }<br>}</p>
<h2 id="6-Dependent-Functions"><a href="#6-Dependent-Functions" class="headerlink" title="6 Dependent Functions"></a>6 Dependent Functions</h2><p>依赖于每个函数的函数应该紧密靠近，这样我们就不必滚动文件来查找被调用函数的原始定义。</p>
<p>For example, if we have a chain of calls like the following, we should keep them together:<br>class Foo {<br>  foo() {<br>    this.bar();<br>  }<br>  bar() {<br>    this.baz();<br>  }<br>  baz() {}<br>}</p>
<h2 id="7-Related-Code"><a href="#7-Related-Code" class="headerlink" title="7 Related Code"></a>7 Related Code</h2><p>相关代码应该彼此靠近，这样我们就不必滚动查找代码中的相关概念。</p>
<p>它们可能没有直接的依赖关系，但是它们之间的联系非常紧密，因此我们需要一起找到它们。  </p>
<p>class Assert {<br>  assertTrue() {}<br>  assertFalse() {}<br>  assertNotUndefined() {}<br>}</p>
<h2 id="8-Vertical-Ordering"><a href="#8-Vertical-Ordering" class="headerlink" title="8 Vertical Ordering"></a>8 Vertical Ordering</h2><p>所调用的函数应在进行调用的函数之下。 这会创建一个从高到低的不错的流程。</p>
<p>高层概念很重要，因此应将其放在最顶层，然后才能查看较低层的帮助器功能。</p>
<p>class Foo {<br>  foo() {<br>    this.bar();<br>  }<br>  bar() {<br>    this.baz();<br>  }<br>  baz() {}<br>}</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jsonload.com/2020/03/13/函数与箭头函数箭区别’/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="killsos.ql@gmail.com">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="killsos">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/13/函数与箭头函数箭区别’/" itemprop="url">函数与箭头函数箭区别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-13T16:33:20+08:00">
                2020-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-this"><a href="#1-this" class="headerlink" title="1. this"></a>1. this</h2><h2 id="2-arguments"><a href="#2-arguments" class="headerlink" title="2. arguments"></a>2. arguments</h2><p>正常函数有 箭头没有</p>
<h2 id="3-bind"><a href="#3-bind" class="headerlink" title="3 bind"></a>3 bind</h2><p>正常函数有 箭头没有</p>
<p>箭头没有local thisBinding</p>
<h2 id="4-Constructor"><a href="#4-Constructor" class="headerlink" title="4 Constructor"></a>4 Constructor</h2><p>正常函数可以作为构造器 箭头不可以</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">killsos.ql@gmail.com</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">130</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">killsos.ql@gmail.com</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
